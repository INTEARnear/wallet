import{f as O,k as D,m as j,n as v,o as G,t as k,u as B,v as H,w as o,x as A}from"./chunk-N2WXLAZF.js";import{a as e}from"./chunk-HXA2I3EV.js";import{i as _,k as g,o as h}from"./chunk-JY5TIRRF.js";_();h();g();_();h();g();_();h();g();_();h();g();var U={address:/^0x(?:[A-Fa-f0-9]{40})$/u,transactionHash:/^0x(?:[A-Fa-f0-9]{64})$/u,signedMessage:/^0x(?:[a-fA-F0-9]{62,})$/u};_();h();g();var E={set(c,t){R.isClient&&localStorage.setItem(`${o.STORAGE_KEY}${c}`,t)},get(c){return R.isClient?localStorage.getItem(`${o.STORAGE_KEY}${c}`):null},delete(c,t){R.isClient&&(t?localStorage.removeItem(c):localStorage.removeItem(`${o.STORAGE_KEY}${c}`))}};var f=30*1e3,R={checkIfAllowedToTriggerEmail(){let c=E.get(o.LAST_EMAIL_LOGIN_TIME);if(c){let t=Date.now()-Number(c);if(t<f){let r=Math.ceil((f-t)/1e3);throw new Error(`Please try again after ${r} seconds`)}}},getTimeToNextEmailLogin(){let c=E.get(o.LAST_EMAIL_LOGIN_TIME);if(c){let t=Date.now()-Number(c);if(t<f)return Math.ceil((f-t)/1e3)}return 0},checkIfRequestExists(c){return A.NOT_SAFE_RPC_METHODS.includes(c.method)||A.SAFE_RPC_METHODS.includes(c.method)},getResponseType(c){return typeof c=="string"&&(c?.match(U.transactionHash)||c?.match(U.signedMessage))?o.RPC_RESPONSE_TYPE_TX:o.RPC_RESPONSE_TYPE_OBJECT},checkIfRequestIsSafe(c){return A.SAFE_RPC_METHODS.includes(c.method)},isClient:typeof window<"u"};_();h();g();var p=e.object({message:e.string()});function a(c){return e.literal(o[c])}var x=e.object({serializedMessage:e.string().optional(),accountAddress:e.string(),chainId:e.string(),notBefore:e.string().optional(),domain:e.string(),uri:e.string(),version:e.string(),nonce:e.string(),statement:e.string().optional(),resources:e.array(e.string()).optional(),requestId:e.string().optional(),issuedAt:e.string().optional(),expirationTime:e.string().optional()}),Ot=e.object({accessList:e.array(e.string()),blockHash:e.string().nullable(),blockNumber:e.string().nullable(),chainId:e.string().or(e.number()),from:e.string(),gas:e.string(),hash:e.string(),input:e.string().nullable(),maxFeePerGas:e.string(),maxPriorityFeePerGas:e.string(),nonce:e.string(),r:e.string(),s:e.string(),to:e.string(),transactionIndex:e.string().nullable(),type:e.string(),v:e.string(),value:e.string()}),V=e.object({chainId:e.string().or(e.number()),rpcUrl:e.optional(e.string())}),$=e.object({email:e.string().email()}),z=e.object({otp:e.string()}),Q=e.object({uri:e.string(),preferredAccountType:e.optional(e.string()),chainId:e.optional(e.string().or(e.number())),siwxMessage:e.optional(x),rpcUrl:e.optional(e.string())}),J=e.object({chainId:e.optional(e.string().or(e.number())),preferredAccountType:e.optional(e.string()),socialUri:e.optional(e.string()),siwxMessage:e.optional(x),rpcUrl:e.optional(e.string())}),X=e.object({provider:e.enum(["google","github","apple","facebook","x","discord"])}),Z=e.object({email:e.string().email()}),ee=e.object({otp:e.string()}),te=e.object({otp:e.string()}),re=e.object({themeMode:e.optional(e.enum(["light","dark"])),themeVariables:e.optional(e.record(e.string(),e.string().or(e.number()))),w3mThemeVariables:e.optional(e.record(e.string(),e.string()))}),oe=e.object({metadata:e.object({name:e.string(),description:e.string(),url:e.string(),icons:e.array(e.string())}).optional(),sdkVersion:e.string().optional(),sdkType:e.string().optional(),projectId:e.string()}),ae=e.object({type:e.string()}),ne=e.object({action:e.enum(["VERIFY_DEVICE","VERIFY_OTP","CONNECT"])}),se=e.object({url:e.string()}),ie=e.object({userName:e.string()}),ce=e.object({email:e.string().optional().nullable(),address:e.string(),chainId:e.string().or(e.number()),accounts:e.array(e.object({address:e.string(),type:e.enum([A.ACCOUNT_TYPES.EOA,A.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),userName:e.string().optional().nullable(),preferredAccountType:e.optional(e.string()),signature:e.string().optional(),message:e.string().optional(),siwxMessage:e.optional(x)}),pe=e.object({action:e.enum(["VERIFY_PRIMARY_OTP","VERIFY_SECONDARY_OTP"])}),le=e.object({email:e.string().email().optional().nullable(),address:e.string(),chainId:e.string().or(e.number()),smartAccountDeployed:e.optional(e.boolean()),accounts:e.array(e.object({address:e.string(),type:e.enum([A.ACCOUNT_TYPES.EOA,A.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),preferredAccountType:e.optional(e.string()),signature:e.string().optional(),message:e.string().optional(),siwxMessage:e.optional(x)}),Ee=e.object({uri:e.string()}),me=e.object({isConnected:e.boolean()}),de=e.object({chainId:e.string().or(e.number())}),_e=e.object({chainId:e.string().or(e.number())}),ge=e.object({newEmail:e.string().email()}),he=e.object({smartAccountEnabledNetworks:e.array(e.number())}),Ut=e.object({address:e.string(),isDeployed:e.boolean()}),Re=e.object({version:e.string().optional()}),ye=e.object({type:e.string(),address:e.string()}),Ae=e.any(),Ce=e.object({method:e.literal("eth_accounts")}),ue=e.object({method:e.literal("eth_blockNumber")}),Se=e.object({method:e.literal("eth_call"),params:e.array(e.any())}),Te=e.object({method:e.literal("eth_chainId")}),Pe=e.object({method:e.literal("eth_estimateGas"),params:e.array(e.any())}),we=e.object({method:e.literal("eth_feeHistory"),params:e.array(e.any())}),Ne=e.object({method:e.literal("eth_gasPrice")}),fe=e.object({method:e.literal("eth_getAccount"),params:e.array(e.any())}),xe=e.object({method:e.literal("eth_getBalance"),params:e.array(e.any())}),Ie=e.object({method:e.literal("eth_getBlockByHash"),params:e.array(e.any())}),be=e.object({method:e.literal("eth_getBlockByNumber"),params:e.array(e.any())}),Fe=e.object({method:e.literal("eth_getBlockReceipts"),params:e.array(e.any())}),Oe=e.object({method:e.literal("eth_getBlockTransactionCountByHash"),params:e.array(e.any())}),Ue=e.object({method:e.literal("eth_getBlockTransactionCountByNumber"),params:e.array(e.any())}),Le=e.object({method:e.literal("eth_getCode"),params:e.array(e.any())}),Me=e.object({method:e.literal("eth_getFilterChanges"),params:e.array(e.any())}),De=e.object({method:e.literal("eth_getFilterLogs"),params:e.array(e.any())}),je=e.object({method:e.literal("eth_getLogs"),params:e.array(e.any())}),ve=e.object({method:e.literal("eth_getProof"),params:e.array(e.any())}),Ge=e.object({method:e.literal("eth_getStorageAt"),params:e.array(e.any())}),ke=e.object({method:e.literal("eth_getTransactionByBlockHashAndIndex"),params:e.array(e.any())}),Be=e.object({method:e.literal("eth_getTransactionByBlockNumberAndIndex"),params:e.array(e.any())}),He=e.object({method:e.literal("eth_getTransactionByHash"),params:e.array(e.any())}),We=e.object({method:e.literal("eth_getTransactionCount"),params:e.array(e.any())}),Ye=e.object({method:e.literal("eth_getTransactionReceipt"),params:e.array(e.any())}),qe=e.object({method:e.literal("eth_getUncleCountByBlockHash"),params:e.array(e.any())}),Ke=e.object({method:e.literal("eth_getUncleCountByBlockNumber"),params:e.array(e.any())}),Ve=e.object({method:e.literal("eth_maxPriorityFeePerGas")}),$e=e.object({method:e.literal("eth_newBlockFilter")}),ze=e.object({method:e.literal("eth_newFilter"),params:e.array(e.any())}),Qe=e.object({method:e.literal("eth_newPendingTransactionFilter")}),Je=e.object({method:e.literal("eth_sendRawTransaction"),params:e.array(e.any())}),Xe=e.object({method:e.literal("eth_syncing"),params:e.array(e.any())}),Ze=e.object({method:e.literal("eth_uninstallFilter"),params:e.array(e.any())}),W=e.object({method:e.literal("personal_sign"),params:e.array(e.any())}),et=e.object({method:e.literal("eth_signTypedData_v4"),params:e.array(e.any())}),tt=e.object({method:e.literal("eth_sendTransaction"),params:e.array(e.any())}),rt=e.object({method:e.literal("solana_signMessage"),params:e.object({message:e.string(),pubkey:e.string()})}),ot=e.object({method:e.literal("solana_signTransaction"),params:e.object({transaction:e.string()})}),at=e.object({method:e.literal("solana_signAllTransactions"),params:e.object({transactions:e.array(e.string())})}),nt=e.object({method:e.literal("solana_signAndSendTransaction"),params:e.object({transaction:e.string(),options:e.object({skipPreflight:e.boolean().optional(),preflightCommitment:e.enum(["processed","confirmed","finalized","recent","single","singleGossip","root","max"]).optional(),maxRetries:e.number().optional(),minContextSlot:e.number().optional()}).optional()})}),st=e.object({method:e.literal("wallet_sendCalls"),params:e.array(e.object({chainId:e.string().or(e.number()).optional(),from:e.string().optional(),version:e.string().optional(),capabilities:e.any().optional(),calls:e.array(e.object({to:e.string().startsWith("0x"),data:e.string().startsWith("0x").optional(),value:e.string().optional()}))}))}),it=e.object({method:e.literal("wallet_getCallsStatus"),params:e.array(e.string())}),ct=e.object({method:e.literal("wallet_getCapabilities"),params:e.array(e.string().or(e.number()).optional()).optional()}),pt=e.object({method:e.literal("wallet_grantPermissions"),params:e.array(e.any())}),lt=e.object({method:e.literal("wallet_revokePermissions"),params:e.any()}),Et=e.object({method:e.literal("wallet_getAssets"),params:e.any()}),Y=e.object({token:e.string()}),n=e.object({id:e.string().optional()}),I={appEvent:n.extend({type:a("APP_SWITCH_NETWORK"),payload:V}).or(n.extend({type:a("APP_CONNECT_EMAIL"),payload:$})).or(n.extend({type:a("APP_CONNECT_DEVICE")})).or(n.extend({type:a("APP_CONNECT_OTP"),payload:z})).or(n.extend({type:a("APP_CONNECT_SOCIAL"),payload:Q})).or(n.extend({type:a("APP_GET_FARCASTER_URI")})).or(n.extend({type:a("APP_CONNECT_FARCASTER")})).or(n.extend({type:a("APP_GET_USER"),payload:e.optional(J)})).or(n.extend({type:a("APP_GET_SOCIAL_REDIRECT_URI"),payload:X})).or(n.extend({type:a("APP_SIGN_OUT")})).or(n.extend({type:a("APP_IS_CONNECTED"),payload:e.optional(Y)})).or(n.extend({type:a("APP_GET_CHAIN_ID")})).or(n.extend({type:a("APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS")})).or(n.extend({type:a("APP_INIT_SMART_ACCOUNT")})).or(n.extend({type:a("APP_SET_PREFERRED_ACCOUNT"),payload:ae})).or(n.extend({type:a("APP_RPC_REQUEST"),payload:W.or(Et).or(Ce).or(ue).or(Se).or(Te).or(Pe).or(we).or(Ne).or(fe).or(xe).or(Ie).or(be).or(Fe).or(Oe).or(Ue).or(Le).or(Me).or(De).or(je).or(ve).or(Ge).or(ke).or(Be).or(He).or(We).or(Ye).or(qe).or(Ke).or(Ve).or($e).or(ze).or(Qe).or(Je).or(Xe).or(Ze).or(W).or(et).or(tt).or(rt).or(ot).or(at).or(nt).or(it).or(st).or(ct).or(pt).or(lt).and(e.object({chainId:e.string().or(e.number()).optional(),chainNamespace:e.enum(["eip155","solana","polkadot","bip122","cosmos"]).optional(),rpcUrl:e.string().optional()}))})).or(n.extend({type:a("APP_UPDATE_EMAIL"),payload:Z})).or(n.extend({type:a("APP_UPDATE_EMAIL_PRIMARY_OTP"),payload:ee})).or(n.extend({type:a("APP_UPDATE_EMAIL_SECONDARY_OTP"),payload:te})).or(n.extend({type:a("APP_SYNC_THEME"),payload:re})).or(n.extend({type:a("APP_SYNC_DAPP_DATA"),payload:oe})).or(n.extend({type:a("APP_RELOAD")})).or(n.extend({type:a("APP_RPC_ABORT")})),frameEvent:n.extend({type:a("FRAME_SWITCH_NETWORK_ERROR"),payload:p}).or(n.extend({type:a("FRAME_SWITCH_NETWORK_SUCCESS"),payload:_e})).or(n.extend({type:a("FRAME_CONNECT_EMAIL_SUCCESS"),payload:ne})).or(n.extend({type:a("FRAME_CONNECT_EMAIL_ERROR"),payload:p})).or(n.extend({type:a("FRAME_GET_FARCASTER_URI_SUCCESS"),payload:se})).or(n.extend({type:a("FRAME_GET_FARCASTER_URI_ERROR"),payload:p})).or(n.extend({type:a("FRAME_CONNECT_FARCASTER_SUCCESS"),payload:ie})).or(n.extend({type:a("FRAME_CONNECT_FARCASTER_ERROR"),payload:p})).or(n.extend({type:a("FRAME_CONNECT_OTP_ERROR"),payload:p})).or(n.extend({type:a("FRAME_CONNECT_OTP_SUCCESS")})).or(n.extend({type:a("FRAME_CONNECT_DEVICE_ERROR"),payload:p})).or(n.extend({type:a("FRAME_CONNECT_DEVICE_SUCCESS")})).or(n.extend({type:a("FRAME_CONNECT_SOCIAL_SUCCESS"),payload:ce})).or(n.extend({type:a("FRAME_CONNECT_SOCIAL_ERROR"),payload:p})).or(n.extend({type:a("FRAME_GET_USER_ERROR"),payload:p})).or(n.extend({type:a("FRAME_GET_USER_SUCCESS"),payload:le})).or(n.extend({type:a("FRAME_GET_SOCIAL_REDIRECT_URI_ERROR"),payload:p})).or(n.extend({type:a("FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS"),payload:Ee})).or(n.extend({type:a("FRAME_SIGN_OUT_ERROR"),payload:p})).or(n.extend({type:a("FRAME_SIGN_OUT_SUCCESS")})).or(n.extend({type:a("FRAME_IS_CONNECTED_ERROR"),payload:p})).or(n.extend({type:a("FRAME_IS_CONNECTED_SUCCESS"),payload:me})).or(n.extend({type:a("FRAME_GET_CHAIN_ID_ERROR"),payload:p})).or(n.extend({type:a("FRAME_GET_CHAIN_ID_SUCCESS"),payload:de})).or(n.extend({type:a("FRAME_RPC_REQUEST_ERROR"),payload:p})).or(n.extend({type:a("FRAME_RPC_REQUEST_SUCCESS"),payload:Ae})).or(n.extend({type:a("FRAME_SESSION_UPDATE"),payload:Y})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_ERROR"),payload:p})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_SUCCESS"),payload:pe})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR"),payload:p})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS")})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR"),payload:p})).or(n.extend({type:a("FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS"),payload:ge})).or(n.extend({type:a("FRAME_SYNC_THEME_ERROR"),payload:p})).or(n.extend({type:a("FRAME_SYNC_THEME_SUCCESS")})).or(n.extend({type:a("FRAME_SYNC_DAPP_DATA_ERROR"),payload:p})).or(n.extend({type:a("FRAME_SYNC_DAPP_DATA_SUCCESS")})).or(n.extend({type:a("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS"),payload:he})).or(n.extend({type:a("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR"),payload:p})).or(n.extend({type:a("FRAME_INIT_SMART_ACCOUNT_ERROR"),payload:p})).or(n.extend({type:a("FRAME_SET_PREFERRED_ACCOUNT_SUCCESS"),payload:ye})).or(n.extend({type:a("FRAME_SET_PREFERRED_ACCOUNT_ERROR"),payload:p})).or(n.extend({type:a("FRAME_READY"),payload:Re})).or(n.extend({type:a("FRAME_RELOAD_ERROR"),payload:p})).or(n.extend({type:a("FRAME_RELOAD_SUCCESS")}))};function L(c,t={}){return typeof t?.type=="string"&&t?.type?.includes(c)}function mt({projectId:c,chainId:t,version:r,enableLogger:s,rpcUrl:m=O.BLOCKCHAIN_API_RPC_URL}){let l=new URL(k);return l.searchParams.set("projectId",c),l.searchParams.set("chainId",String(t)),l.searchParams.set("version",r),l.searchParams.set("enableLogger",String(s)),l.searchParams.set("rpcUrl",m),l.toString()}var b=class{constructor({projectId:t,isAppClient:r=!1,chainId:s="eip155:1",enableLogger:m=!0,rpcUrl:l=O.BLOCKCHAIN_API_RPC_URL}){if(this.iframe=null,this.iframeIsReady=!1,this.initFrame=()=>{let i=document.getElementById("w3m-iframe");this.iframe&&!i&&document.body.appendChild(this.iframe)},this.events={registerFrameEventHandler:(i,d,y)=>{function u({data:S}){if(!L(o.FRAME_EVENT_KEY,S))return;let T=I.frameEvent.safeParse(S);if(!T.success){console.warn("W3mFrame: invalid frame event",T.error.message);return}T.data?.id===i&&(d(T.data),window.removeEventListener("message",u))}R.isClient&&(window.addEventListener("message",u),y.addEventListener("abort",()=>{window.removeEventListener("message",u)}))},onFrameEvent:i=>{R.isClient&&window.addEventListener("message",({data:d})=>{if(!L(o.FRAME_EVENT_KEY,d))return;let y=I.frameEvent.safeParse(d);y.success?i(y.data):console.warn("W3mFrame: invalid frame event",y.error.message)})},onAppEvent:i=>{R.isClient&&window.addEventListener("message",({data:d})=>{if(!L(o.APP_EVENT_KEY,d))return;let y=I.appEvent.safeParse(d);y.success||console.warn("W3mFrame: invalid app event",y.error.message),i(d)})},postAppEvent:i=>{if(R.isClient){if(!this.iframe?.contentWindow)throw new Error("W3mFrame: iframe is not set");this.iframe.contentWindow.postMessage(i,"*")}},postFrameEvent:i=>{if(R.isClient){if(!parent)throw new Error("W3mFrame: parent is not set");parent.postMessage(i,"*")}}},this.projectId=t,this.frameLoadPromise=new Promise((i,d)=>{this.frameLoadPromiseResolver={resolve:i,reject:d}}),this.rpcUrl=l,r&&(this.frameLoadPromise=new Promise((i,d)=>{this.frameLoadPromiseResolver={resolve:i,reject:d}}),R.isClient)){let i=document.createElement("iframe");i.id="w3m-iframe",i.src=mt({projectId:t,chainId:s,version:H,enableLogger:m,rpcUrl:this.rpcUrl}),i.name="w3m-secure-iframe",i.style.position="fixed",i.style.zIndex="999999",i.style.display="none",i.style.border="none",i.style.animationDelay="0s, 50ms",i.style.borderBottomLeftRadius="clamp(0px, var(--wui-border-radius-l), 44px)",i.style.borderBottomRightRadius="clamp(0px, var(--wui-border-radius-l), 44px)",this.iframe=i,this.iframe.onerror=()=>{this.frameLoadPromiseResolver?.reject("Unable to load email login dependency")},this.events.onFrameEvent(d=>{d.type==="@w3m-frame/READY"&&(this.iframeIsReady=!0,this.frameLoadPromiseResolver?.resolve(void 0))})}}get networks(){let t=["eip155:1","eip155:5","eip155:11155111","eip155:10","eip155:420","eip155:42161","eip155:421613","eip155:137","eip155:80001","eip155:42220","eip155:1313161554","eip155:1313161555","eip155:56","eip155:97","eip155:43114","eip155:43113","eip155:324","eip155:280","eip155:100","eip155:8453","eip155:84531","eip155:84532","eip155:7777777","eip155:999","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1"].map(r=>({[r]:{rpcUrl:`${this.rpcUrl}/v1/?chainId=${r}&projectId=${this.projectId}`,chainId:r}}));return Object.assign({},...t)}};_();h();g();_();h();g();var F=class{constructor(t){let r=j({level:B}),{logger:s,chunkLoggerController:m}=G({opts:r});this.logger=v(s,this.constructor.name),this.chunkLoggerController=m,typeof window<"u"&&this.chunkLoggerController?.downloadLogsBlobInBrowser&&(window.downloadAppKitLogsBlob||(window.downloadAppKitLogsBlob={}),window.downloadAppKitLogsBlob.sdk=()=>{this.chunkLoggerController?.downloadLogsBlobInBrowser&&this.chunkLoggerController.downloadLogsBlobInBrowser({projectId:t})})}};var M=class{constructor({projectId:t,chainId:r,enableLogger:s=!0,onTimeout:m,abortController:l,getActiveCaipNetwork:i}){this.openRpcRequests=[],this.isInitialized=!1,s&&(this.w3mLogger=new F(t)),this.abortController=l,this.getActiveCaipNetwork=i;let d=this.getRpcUrl(r);this.w3mFrame=new b({projectId:t,isAppClient:!0,chainId:r,enableLogger:s,rpcUrl:d}),this.onTimeout=m,this.getLoginEmailUsed()&&this.createFrame()}async createFrame(){this.w3mFrame.initFrame(),this.initPromise=new Promise(t=>{this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_READY&&setTimeout(()=>{t()},500)})}),await this.initPromise,this.isInitialized=!0,this.initPromise=void 0}async init(){if(!this.isInitialized){if(this.initPromise){await this.initPromise;return}await this.createFrame()}}getLoginEmailUsed(){return!!E.get(o.EMAIL_LOGIN_USED_KEY)}getEmail(){return E.get(o.EMAIL)}getUsername(){return E.get(o.SOCIAL_USERNAME)}async reload(){try{await this.appEvent({type:o.APP_RELOAD})}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error reloading iframe"),t}}async connectEmail(t){try{R.checkIfAllowedToTriggerEmail(),await this.init();let r=await this.appEvent({type:o.APP_CONNECT_EMAIL,payload:t});return this.setNewLastEmailLoginTime(),r}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error connecting email"),r}}async connectDevice(){try{return this.appEvent({type:o.APP_CONNECT_DEVICE})}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error connecting device"),t}}async connectOtp(t){try{return this.appEvent({type:o.APP_CONNECT_OTP,payload:t})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error connecting otp"),r}}async isConnected(){try{if(!this.getLoginEmailUsed())return{isConnected:!1};let t=await this.appEvent({type:o.APP_IS_CONNECTED});return t?.isConnected||this.deleteAuthLoginCache(),t}catch(t){throw this.deleteAuthLoginCache(),this.w3mLogger?.logger.error({error:t},"Error checking connection"),t}}async getChainId(){try{let t=await this.appEvent({type:o.APP_GET_CHAIN_ID});return this.setLastUsedChainId(t.chainId),t}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error getting chain id"),t}}async getSocialRedirectUri(t){try{return await this.init(),this.appEvent({type:o.APP_GET_SOCIAL_REDIRECT_URI,payload:t})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error getting social redirect uri"),r}}async updateEmail(t){try{let r=await this.appEvent({type:o.APP_UPDATE_EMAIL,payload:t});return this.setNewLastEmailLoginTime(),r}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error updating email"),r}}async updateEmailPrimaryOtp(t){try{return this.appEvent({type:o.APP_UPDATE_EMAIL_PRIMARY_OTP,payload:t})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error updating email primary otp"),r}}async updateEmailSecondaryOtp(t){try{let r=await this.appEvent({type:o.APP_UPDATE_EMAIL_SECONDARY_OTP,payload:t});return this.setLoginSuccess(r.newEmail),r}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error updating email secondary otp"),r}}async syncTheme(t){try{return this.appEvent({type:o.APP_SYNC_THEME,payload:t})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error syncing theme"),r}}async syncDappData(t){try{return this.appEvent({type:o.APP_SYNC_DAPP_DATA,payload:t})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error syncing dapp data"),r}}async getSmartAccountEnabledNetworks(){try{let t=await this.appEvent({type:o.APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS});return this.persistSmartAccountEnabledNetworks(t.smartAccountEnabledNetworks),t}catch(t){throw this.persistSmartAccountEnabledNetworks([]),this.w3mLogger?.logger.error({error:t},"Error getting smart account enabled networks"),t}}async setPreferredAccount(t){try{return this.appEvent({type:o.APP_SET_PREFERRED_ACCOUNT,payload:{type:t}})}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error setting preferred account"),r}}async connect(t){if(t?.socialUri)try{await this.init();let r=this.getRpcUrl(t.chainId),s=await this.appEvent({type:o.APP_CONNECT_SOCIAL,payload:{uri:t.socialUri,preferredAccountType:t.preferredAccountType,chainId:t.chainId,siwxMessage:t.siwxMessage,rpcUrl:r}});return s.userName&&this.setSocialLoginSuccess(s.userName),this.setLoginSuccess(s.email),this.setLastUsedChainId(s.chainId),this.user=s,s}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error connecting social"),r}else try{let r=t?.chainId||this.getLastUsedChainId()||1,s=await this.getUser({chainId:r,preferredAccountType:t?.preferredAccountType,siwxMessage:t?.siwxMessage,rpcUrl:this.getRpcUrl(r)});return this.setLoginSuccess(s.email),this.setLastUsedChainId(s.chainId),this.user=s,s}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error connecting"),r}}async getUser(t){try{await this.init();let r=t?.chainId||this.getLastUsedChainId()||1,s=await this.appEvent({type:o.APP_GET_USER,payload:{...t,chainId:r}});return this.user=s,s}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error connecting"),r}}async connectSocial({uri:t,chainId:r,preferredAccountType:s}){try{await this.init();let m=this.getRpcUrl(r),l=await this.appEvent({type:o.APP_CONNECT_SOCIAL,payload:{uri:t,chainId:r,rpcUrl:m,preferredAccountType:s}});return l.userName&&this.setSocialLoginSuccess(l.userName),l}catch(m){throw this.w3mLogger?.logger.error({error:m},"Error connecting social"),m}}async getFarcasterUri(){try{return await this.init(),await this.appEvent({type:o.APP_GET_FARCASTER_URI})}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error getting farcaster uri"),t}}async connectFarcaster(){try{let t=await this.appEvent({type:o.APP_CONNECT_FARCASTER});return t.userName&&this.setSocialLoginSuccess(t.userName),t}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error connecting farcaster"),t}}async switchNetwork({chainId:t}){try{let r=this.getRpcUrl(t),s=await this.appEvent({type:o.APP_SWITCH_NETWORK,payload:{chainId:t,rpcUrl:r}});return this.setLastUsedChainId(s.chainId),s}catch(r){throw this.w3mLogger?.logger.error({error:r},"Error switching network"),r}}async disconnect(){try{return this.deleteAuthLoginCache(),await new Promise(async r=>{let s=setTimeout(()=>{r()},3e3);await this.appEvent({type:o.APP_SIGN_OUT}),clearTimeout(s),r()})}catch(t){throw this.w3mLogger?.logger.error({error:t},"Error disconnecting"),t}}async request(t){let r=t;try{if(A.GET_CHAIN_ID===t.method)return this.getLastUsedChainId();let s=t.chainNamespace||"eip155",m=this.getActiveCaipNetwork(s)?.id;r.chainNamespace=s,r.chainId=m,r.rpcUrl=this.getRpcUrl(m),this.rpcRequestHandler?.(t);let l=await this.appEvent({type:o.APP_RPC_REQUEST,payload:r});return this.rpcSuccessHandler?.(l,r),l}catch(s){throw this.rpcErrorHandler?.(s,r),this.w3mLogger?.logger.error({error:s},"Error requesting"),s}}onRpcRequest(t){this.rpcRequestHandler=t}onRpcSuccess(t){this.rpcSuccessHandler=t}onRpcError(t){this.rpcErrorHandler=t}onIsConnected(t){this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_IS_CONNECTED_SUCCESS&&r.payload.isConnected&&t()})}onNotConnected(t){this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_IS_CONNECTED_ERROR&&t(),r.type===o.FRAME_IS_CONNECTED_SUCCESS&&!r.payload.isConnected&&t()})}onConnect(t){this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_GET_USER_SUCCESS&&t(r.payload)})}onSocialConnected(t){this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_CONNECT_SOCIAL_SUCCESS&&t(r.payload)})}async getCapabilities(){try{return await this.request({method:"wallet_getCapabilities"})||{}}catch{return{}}}onSetPreferredAccount(t){this.w3mFrame.events.onFrameEvent(r=>{r.type===o.FRAME_SET_PREFERRED_ACCOUNT_SUCCESS?t(r.payload):r.type===o.FRAME_SET_PREFERRED_ACCOUNT_ERROR&&t({type:A.ACCOUNT_TYPES.EOA})})}getAvailableChainIds(){return Object.keys(this.w3mFrame.networks)}async rejectRpcRequests(){try{await Promise.all(this.openRpcRequests.map(async({abortController:t,method:r})=>{A.SAFE_RPC_METHODS.includes(r)||t.abort(),await this.appEvent({type:o.APP_RPC_ABORT})})),this.openRpcRequests=[]}catch(t){this.w3mLogger?.logger.error({error:t},"Error aborting RPC request")}}async appEvent(t){let r,s;function m(y){return y.replace("@w3m-app/","")}let l=[o.APP_SYNC_DAPP_DATA,o.APP_SYNC_THEME,o.APP_SET_PREFERRED_ACCOUNT],i=m(t.type);return!this.w3mFrame.iframeIsReady&&!l.includes(t.type)&&(s=setTimeout(()=>{this.onTimeout?.("iframe_load_failed"),this.abortController.abort()},2e4)),await this.w3mFrame.frameLoadPromise,clearTimeout(s),[o.APP_CONNECT_EMAIL,o.APP_CONNECT_DEVICE,o.APP_CONNECT_OTP,o.APP_CONNECT_SOCIAL,o.APP_GET_SOCIAL_REDIRECT_URI].map(m).includes(i)&&(r=setTimeout(()=>{this.onTimeout?.("iframe_request_timeout"),this.abortController.abort()},12e4)),new Promise((y,u)=>{let S=Math.random().toString(36).substring(7);this.w3mLogger?.logger.info?.({event:t,id:S},"Sending app event"),this.w3mFrame.events.postAppEvent({...t,id:S});let T=new AbortController;if(i==="RPC_REQUEST"){let C=t;this.openRpcRequests=[...this.openRpcRequests,{...C.payload,abortController:T}]}T.signal.addEventListener("abort",()=>{i==="RPC_REQUEST"?u(new Error("Request was aborted")):i!=="GET_FARCASTER_URI"&&u(new Error("Something went wrong"))});function q(C,K){C.id===S&&(K?.logger.info?.({framEvent:C,id:S},"Received frame response"),C.type===`@w3m-frame/${i}_SUCCESS`?(r&&clearTimeout(r),s&&clearTimeout(s),"payload"in C&&y(C.payload),y(void 0)):C.type===`@w3m-frame/${i}_ERROR`&&(r&&clearTimeout(r),s&&clearTimeout(s),"payload"in C&&u(new Error(C.payload?.message||"An error occurred")),u(new Error("An error occurred"))))}this.w3mFrame.events.registerFrameEventHandler(S,C=>q(C,this.w3mLogger),this.abortController.signal)})}setNewLastEmailLoginTime(){E.set(o.LAST_EMAIL_LOGIN_TIME,Date.now().toString())}setSocialLoginSuccess(t){E.set(o.SOCIAL_USERNAME,t)}setLoginSuccess(t){t&&E.set(o.EMAIL,t),E.set(o.EMAIL_LOGIN_USED_KEY,"true"),E.delete(o.LAST_EMAIL_LOGIN_TIME)}deleteAuthLoginCache(){E.delete(o.EMAIL_LOGIN_USED_KEY),E.delete(o.EMAIL),E.delete(o.LAST_USED_CHAIN_KEY),E.delete(o.SOCIAL_USERNAME)}setLastUsedChainId(t){t&&E.set(o.LAST_USED_CHAIN_KEY,String(t))}getLastUsedChainId(){let t=E.get(o.LAST_USED_CHAIN_KEY)??void 0,r=Number(t);return isNaN(r)?t:r}persistSmartAccountEnabledNetworks(t){E.set(o.SMART_ACCOUNT_ENABLED_NETWORKS,t.join(","))}getRpcUrl(t){let r=t===void 0?void 0:"eip155";return typeof t=="string"&&(t.includes(":")?r=D.parseCaipNetworkId(t)?.chainNamespace:Number.isInteger(Number(t))?r="eip155":r="solana"),this.getActiveCaipNetwork(r)?.rpcUrls.default.http?.[0]}};export{R as a,M as b};
