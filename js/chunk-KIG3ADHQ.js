import{a as xt,b as qt,c as Rr,d as fr,e as ze,f as Re,g as gu,h as bu,i as kt,j as er,k as Dt,l as gr,m as Nr,n as Ln,o as vu,p as Os,q as Cs,r as yt,s as lt,t as Fr,u as Ge,v as rt}from"./chunk-JK5MJGFP.js";import{a as dr,b as We,d as Tr}from"./chunk-H6T4G3YK.js";import{a as Fn,b as Un,c as mu,d as Bn,e as yu,f as wu}from"./chunk-JBYAY2RL.js";import{b as kf,c as et,d as tt,f as Qt,g as wi,h as E,i as k,j as I,k as B,n as _}from"./chunk-KGCAX4NX.js";var Rs={};tt(Rs,{__assign:()=>kn,__asyncDelegator:()=>hg,__asyncGenerator:()=>ug,__asyncValues:()=>lg,__await:()=>Ts,__awaiter:()=>sg,__classPrivateFieldGet:()=>gg,__classPrivateFieldSet:()=>mg,__createBinding:()=>ng,__decorate:()=>eg,__exportStar:()=>og,__extends:()=>Zf,__generator:()=>ig,__importDefault:()=>fg,__importStar:()=>dg,__makeTemplateObject:()=>pg,__metadata:()=>rg,__param:()=>tg,__read:()=>Du,__rest:()=>Qf,__spread:()=>ag,__spreadArrays:()=>cg,__values:()=>jn});function Zf(r,e){qn(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Qf(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t}function eg(r,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,s);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(i<3?o(n):i>3?o(e,t,n):o(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n}function tg(r,e){return function(t,s){e(t,s,r)}}function rg(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function sg(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(h){try{u(s.next(h))}catch(l){o(l)}}function c(h){try{u(s.throw(h))}catch(l){o(l)}}function u(h){h.done?n(h.value):i(h.value).then(a,c)}u((s=s.apply(r,e||[])).next())})}function ig(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return c([u,h])}}function c(u){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,i&&(n=u[0]&2?i.return:u[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,u[1])).done)return n;switch(i=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],i=0}finally{s=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function ng(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}function og(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function jn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Du(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var s=t.call(r),i,n=[],o;try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)n.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return n}function ag(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Du(arguments[e]));return r}function cg(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var s=Array(r),i=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,i++)s[i]=n[o];return s}function Ts(r){return this instanceof Ts?(this.v=r,this):new Ts(r)}function ug(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(r,e||[]),i,n=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(p){s[p]&&(i[p]=function(f){return new Promise(function(d,m){n.push([p,f,d,m])>1||a(p,f)})})}function a(p,f){try{c(s[p](f))}catch(d){l(n[0][3],d)}}function c(p){p.value instanceof Ts?Promise.resolve(p.value.v).then(u,h):l(n[0][2],p)}function u(p){a("next",p)}function h(p){a("throw",p)}function l(p,f){p(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function hg(r){var e,t;return e={},s("next"),s("throw",function(i){throw i}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(i,n){e[i]=r[i]?function(o){return(t=!t)?{value:Ts(r[i](o)),done:i==="return"}:n?n(o):o}:n}}function lg(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof jn=="function"?jn(r):r[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),i(a,c,o.done,o.value)})}}function i(n,o,a,c){Promise.resolve(c).then(function(u){n({value:u,done:a})},o)}}function pg(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function dg(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function fg(r){return r&&r.__esModule?r:{default:r}}function gg(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function mg(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}var qn,kn,Ns=kf(()=>{E();_();I();qn=function(r,e){return qn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)s.hasOwnProperty(i)&&(t[i]=s[i])},qn(r,e)};kn=function(){return kn=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},kn.apply(this,arguments)}});var Pu=et(bi=>{"use strict";E();_();I();Object.defineProperty(bi,"__esModule",{value:!0});bi.delay=void 0;function yg(r){return new Promise(e=>{setTimeout(()=>{e(!0)},r)})}bi.delay=yg});var Au=et(Ur=>{"use strict";E();_();I();Object.defineProperty(Ur,"__esModule",{value:!0});Ur.ONE_THOUSAND=Ur.ONE_HUNDRED=void 0;Ur.ONE_HUNDRED=100;Ur.ONE_THOUSAND=1e3});var Ou=et(M=>{"use strict";E();_();I();Object.defineProperty(M,"__esModule",{value:!0});M.ONE_YEAR=M.FOUR_WEEKS=M.THREE_WEEKS=M.TWO_WEEKS=M.ONE_WEEK=M.THIRTY_DAYS=M.SEVEN_DAYS=M.FIVE_DAYS=M.THREE_DAYS=M.ONE_DAY=M.TWENTY_FOUR_HOURS=M.TWELVE_HOURS=M.SIX_HOURS=M.THREE_HOURS=M.ONE_HOUR=M.SIXTY_MINUTES=M.THIRTY_MINUTES=M.TEN_MINUTES=M.FIVE_MINUTES=M.ONE_MINUTE=M.SIXTY_SECONDS=M.THIRTY_SECONDS=M.TEN_SECONDS=M.FIVE_SECONDS=M.ONE_SECOND=void 0;M.ONE_SECOND=1;M.FIVE_SECONDS=5;M.TEN_SECONDS=10;M.THIRTY_SECONDS=30;M.SIXTY_SECONDS=60;M.ONE_MINUTE=M.SIXTY_SECONDS;M.FIVE_MINUTES=M.ONE_MINUTE*5;M.TEN_MINUTES=M.ONE_MINUTE*10;M.THIRTY_MINUTES=M.ONE_MINUTE*30;M.SIXTY_MINUTES=M.ONE_MINUTE*60;M.ONE_HOUR=M.SIXTY_MINUTES;M.THREE_HOURS=M.ONE_HOUR*3;M.SIX_HOURS=M.ONE_HOUR*6;M.TWELVE_HOURS=M.ONE_HOUR*12;M.TWENTY_FOUR_HOURS=M.ONE_HOUR*24;M.ONE_DAY=M.TWENTY_FOUR_HOURS;M.THREE_DAYS=M.ONE_DAY*3;M.FIVE_DAYS=M.ONE_DAY*5;M.SEVEN_DAYS=M.ONE_DAY*7;M.THIRTY_DAYS=M.ONE_DAY*30;M.ONE_WEEK=M.SEVEN_DAYS;M.TWO_WEEKS=M.ONE_WEEK*2;M.THREE_WEEKS=M.ONE_WEEK*3;M.FOUR_WEEKS=M.ONE_WEEK*4;M.ONE_YEAR=M.ONE_DAY*365});var Mn=et(vi=>{"use strict";E();_();I();Object.defineProperty(vi,"__esModule",{value:!0});var Cu=(Ns(),wi(Rs));Cu.__exportStar(Au(),vi);Cu.__exportStar(Ou(),vi)});var Ru=et(Br=>{"use strict";E();_();I();Object.defineProperty(Br,"__esModule",{value:!0});Br.fromMiliseconds=Br.toMiliseconds=void 0;var Tu=Mn();function wg(r){return r*Tu.ONE_THOUSAND}Br.toMiliseconds=wg;function bg(r){return Math.floor(r/Tu.ONE_THOUSAND)}Br.fromMiliseconds=bg});var Fu=et(Ei=>{"use strict";E();_();I();Object.defineProperty(Ei,"__esModule",{value:!0});var Nu=(Ns(),wi(Rs));Nu.__exportStar(Pu(),Ei);Nu.__exportStar(Ru(),Ei)});var Uu=et(Fs=>{"use strict";E();_();I();Object.defineProperty(Fs,"__esModule",{value:!0});Fs.Watch=void 0;var Ii=class{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let t=this.get(e);if(typeof t.elapsed<"u")throw new Error(`Watch already stopped for label: ${e}`);let s=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:s})}get(e){let t=this.timestamps.get(e);if(typeof t>"u")throw new Error(`No timestamp found for label: ${e}`);return t}elapsed(e){let t=this.get(e);return t.elapsed||Date.now()-t.started}};Fs.Watch=Ii;Fs.default=Ii});var Bu=et(_i=>{"use strict";E();_();I();Object.defineProperty(_i,"__esModule",{value:!0});_i.IWatch=void 0;var $n=class{};_i.IWatch=$n});var Lu=et(Vn=>{"use strict";E();_();I();Object.defineProperty(Vn,"__esModule",{value:!0});var vg=(Ns(),wi(Rs));vg.__exportStar(Bu(),Vn)});var qr=et(Lr=>{"use strict";E();_();I();Object.defineProperty(Lr,"__esModule",{value:!0});var Si=(Ns(),wi(Rs));Si.__exportStar(Fu(),Lr);Si.__exportStar(Uu(),Lr);Si.__exportStar(Lu(),Lr);Si.__exportStar(Mn(),Lr)});var xi=et(de=>{"use strict";E();_();I();Object.defineProperty(de,"__esModule",{value:!0});de.getLocalStorage=de.getLocalStorageOrThrow=de.getCrypto=de.getCryptoOrThrow=de.getLocation=de.getLocationOrThrow=de.getNavigator=de.getNavigatorOrThrow=de.getDocument=de.getDocumentOrThrow=de.getFromWindowOrThrow=de.getFromWindow=void 0;function mr(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}de.getFromWindow=mr;function kr(r){let e=mr(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}de.getFromWindowOrThrow=kr;function Eg(){return kr("document")}de.getDocumentOrThrow=Eg;function Ig(){return mr("document")}de.getDocument=Ig;function _g(){return kr("navigator")}de.getNavigatorOrThrow=_g;function Sg(){return mr("navigator")}de.getNavigator=Sg;function xg(){return kr("location")}de.getLocationOrThrow=xg;function Dg(){return mr("location")}de.getLocation=Dg;function Pg(){return kr("crypto")}de.getCryptoOrThrow=Pg;function Ag(){return mr("crypto")}de.getCrypto=Ag;function Og(){return kr("localStorage")}de.getLocalStorageOrThrow=Og;function Cg(){return mr("localStorage")}de.getLocalStorage=Cg});var ku=et(Di=>{"use strict";E();_();I();Object.defineProperty(Di,"__esModule",{value:!0});Di.getWindowMetadata=void 0;var qu=xi();function Tg(){let r,e;try{r=qu.getDocumentOrThrow(),e=qu.getLocationOrThrow()}catch{return null}function t(){let l=r.getElementsByTagName("link"),p=[];for(let f=0;f<l.length;f++){let d=l[f],m=d.getAttribute("rel");if(m&&m.toLowerCase().indexOf("icon")>-1){let g=d.getAttribute("href");if(g)if(g.toLowerCase().indexOf("https:")===-1&&g.toLowerCase().indexOf("http:")===-1&&g.indexOf("//")!==0){let w=e.protocol+"//"+e.host;if(g.indexOf("/")===0)w+=g;else{let y=e.pathname.split("/");y.pop();let b=y.join("/");w+=b+"/"+g}p.push(w)}else if(g.indexOf("//")===0){let w=e.protocol+g;p.push(w)}else p.push(g)}}return p}function s(...l){let p=r.getElementsByTagName("meta");for(let f=0;f<p.length;f++){let d=p[f],m=["itemprop","property","name"].map(g=>d.getAttribute(g)).filter(g=>g?l.includes(g):!1);if(m.length&&m){let g=d.getAttribute("content");if(g)return g}}return""}function i(){let l=s("name","og:site_name","og:title","twitter:title");return l||(l=r.title),l}function n(){return s("description","og:description","twitter:description","keywords")}let o=i(),a=n(),c=e.origin,u=t();return{description:a,url:c,icons:u,name:o}}Di.getWindowMetadata=Tg});var dd=et((AC,pd)=>{"use strict";E();_();I();pd.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});E();_();I();E();_();I();var Eu=function(r,e,t){if(t||arguments.length===2)for(var s=0,i=e.length,n;s<i;s++)(n||!(s in e))&&(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return r.concat(n||Array.prototype.slice.call(e))},jf=function(){function r(e,t,s){this.name=e,this.version=t,this.os=s,this.type="browser"}return r}();var Mf=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=k.platform}return r}();var $f=function(){function r(e,t,s,i){this.name=e,this.version=t,this.os=s,this.bot=i,this.type="bot-device"}return r}();var Vf=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var zf=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var Hf=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Kf=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Iu=3,Wf=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Hf]],_u=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xu(r){return r?Su(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new zf:typeof navigator<"u"?Su(navigator.userAgent):Jf()}function Gf(r){return r!==""&&Wf.reduce(function(e,t){var s=t[0],i=t[1];if(e)return e;var n=i.exec(r);return!!n&&[s,n]},!1)}function Su(r){var e=Gf(r);if(!e)return null;var t=e[0],s=e[1];if(t==="searchbot")return new Vf;var i=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);i?i.length<Iu&&(i=Eu(Eu([],i,!0),Xf(Iu-i.length),!0)):i=[];var n=i.join("."),o=Yf(r),a=Kf.exec(r);return a&&a[1]?new $f(t,n,o,a[1]):new jf(t,n,o)}function Yf(r){for(var e=0,t=_u.length;e<t;e++){var s=_u[e],i=s[0],n=s[1],o=n.exec(r);if(o)return i}return null}function Jf(){var r=typeof k<"u"&&k.version;return r?new Mf(k.version.slice(1)):null}function Xf(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var Wt=Qt(qr()),Gt=Qt(xi()),Ul=Qt(ku());E();_();I();E();_();I();E();_();I();function ju(r){let e=yu(`0x${r.substring(4)}`).substring(26);return wu(`0x${e}`)}E();_();I();async function $u({hash:r,signature:e}){let t=Fn(r)?r:Bn(r),{secp256k1:s}=await import("./secp256k1-MDLULLHF.js");return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){let{r:u,s:h,v:l,yParity:p}=e,f=Number(p??l),d=Mu(f);return new s.Signature(Un(u),Un(h)).addRecoveryBit(d)}let o=Fn(e)?e:Bn(e),a=mu(`0x${o.slice(130)}`),c=Mu(a);return s.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Mu(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function zn({hash:r,signature:e}){return ju(await $u({hash:r,signature:e}))}E();_();I();E();_();I();function Rg(r){if(r.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<r.length;u++){let h=r.charAt(u),l=h.charCodeAt(0);if(e[l]!==255)throw new TypeError(h+" is ambiguous");e[l]=u}let t=r.length,s=r.charAt(0),i=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let h=0,l=0,p=0,f=u.length;for(;p!==f&&u[p]===0;)p++,h++;let d=(f-p)*n+1>>>0,m=new Uint8Array(d);for(;p!==f;){let y=u[p],b=0;for(let S=d-1;(y!==0||b<l)&&S!==-1;S--,b++)y+=256*m[S]>>>0,m[S]=y%t>>>0,y=y/t>>>0;if(y!==0)throw new Error("Non-zero carry");l=b,p++}let g=d-l;for(;g!==d&&m[g]===0;)g++;let w=s.repeat(h);for(;g<d;++g)w+=r.charAt(m[g]);return w}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let h=0,l=0,p=0;for(;u[h]===s;)l++,h++;let f=(u.length-h)*i+1>>>0,d=new Uint8Array(f);for(;h<u.length;){let y=u.charCodeAt(h);if(y>255)return;let b=e[y];if(b===255)return;let S=0;for(let T=f-1;(b!==0||S<p)&&T!==-1;T--,S++)b+=t*d[T]>>>0,d[T]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");p=S,h++}let m=f-p;for(;m!==f&&d[m]===0;)m++;let g=new Uint8Array(l+(f-m)),w=l;for(;m!==f;)g[w++]=d[m++];return g}function c(u){let h=a(u);if(h)return h;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Vu=Rg;var Ng="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",zu=Vu(Ng);E();_();I();var uh=Qt(qr());function Fg(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function hh(r,...e){if(!Fg(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Hu(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Ug(r,e){hh(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}var jr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Hn=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function Bg(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function lh(r){return typeof r=="string"&&(r=Bg(r)),hh(r),r}var Qn=class{clone(){return this._cloneInto()}};function Lg(r){let e=s=>r().update(lh(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ph(r=32){if(jr&&typeof jr.getRandomValues=="function")return jr.getRandomValues(new Uint8Array(r));if(jr&&typeof jr.randomBytes=="function")return jr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function qg(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);let i=BigInt(32),n=BigInt(4294967295),o=Number(t>>i&n),a=Number(t&n),c=s?4:0,u=s?0:4;r.setUint32(e+c,o,s),r.setUint32(e+u,a,s)}var eo=class extends Qn{constructor(e,t,s,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hn(this.buffer)}update(e){Hu(this);let{view:t,buffer:s,blockLen:i}=this;e=lh(e);let n=e.length;for(let o=0;o<n;){let a=Math.min(i-this.pos,n-o);if(a===i){let c=Hn(e);for(;i<=n-o;o+=i)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hu(this),Ug(e,this),this.finished=!0;let{buffer:t,view:s,blockLen:i,isLE:n}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(s,0),o=0);for(let l=o;l<i;l++)t[l]=0;qg(s,i-8,BigInt(this.length*8),n),this.process(s,0);let a=Hn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:s,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%t&&e.buffer.set(s),e}},Pi=BigInt(2**32-1),to=BigInt(32);function dh(r,e=!1){return e?{h:Number(r&Pi),l:Number(r>>to&Pi)}:{h:Number(r>>to&Pi)|0,l:Number(r&Pi)|0}}function kg(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let i=0;i<r.length;i++){let{h:n,l:o}=dh(r[i],e);[t[i],s[i]]=[n,o]}return[t,s]}var jg=(r,e)=>BigInt(r>>>0)<<to|BigInt(e>>>0),Mg=(r,e,t)=>r>>>t,$g=(r,e,t)=>r<<32-t|e>>>t,Vg=(r,e,t)=>r>>>t|e<<32-t,zg=(r,e,t)=>r<<32-t|e>>>t,Hg=(r,e,t)=>r<<64-t|e>>>t-32,Kg=(r,e,t)=>r>>>t-32|e<<64-t,Wg=(r,e)=>e,Gg=(r,e)=>r,Yg=(r,e,t)=>r<<t|e>>>32-t,Jg=(r,e,t)=>e<<t|r>>>32-t,Xg=(r,e,t)=>e<<t-32|r>>>64-t,Zg=(r,e,t)=>r<<t-32|e>>>64-t;function Qg(r,e,t,s){let i=(e>>>0)+(s>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}var em=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),tm=(r,e,t,s)=>e+t+s+(r/2**32|0)|0,rm=(r,e,t,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0),sm=(r,e,t,s,i)=>e+t+s+i+(r/2**32|0)|0,im=(r,e,t,s,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(i>>>0),nm=(r,e,t,s,i,n)=>e+t+s+i+n+(r/2**32|0)|0,X={fromBig:dh,split:kg,toBig:jg,shrSH:Mg,shrSL:$g,rotrSH:Vg,rotrSL:zg,rotrBH:Hg,rotrBL:Kg,rotr32H:Wg,rotr32L:Gg,rotlSH:Yg,rotlSL:Jg,rotlBH:Xg,rotlBL:Zg,add:Qg,add3L:em,add3H:tm,add4L:rm,add4H:sm,add5H:nm,add5L:im},[om,am]=X.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),tr=new Uint32Array(80),rr=new Uint32Array(80),ro=class extends eo{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:s,Bl:i,Ch:n,Cl:o,Dh:a,Dl:c,Eh:u,El:h,Fh:l,Fl:p,Gh:f,Gl:d,Hh:m,Hl:g}=this;return[e,t,s,i,n,o,a,c,u,h,l,p,f,d,m,g]}set(e,t,s,i,n,o,a,c,u,h,l,p,f,d,m,g){this.Ah=e|0,this.Al=t|0,this.Bh=s|0,this.Bl=i|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=p|0,this.Gh=f|0,this.Gl=d|0,this.Hh=m|0,this.Hl=g|0}process(e,t){for(let b=0;b<16;b++,t+=4)tr[b]=e.getUint32(t),rr[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){let S=tr[b-15]|0,T=rr[b-15]|0,O=X.rotrSH(S,T,1)^X.rotrSH(S,T,8)^X.shrSH(S,T,7),A=X.rotrSL(S,T,1)^X.rotrSL(S,T,8)^X.shrSL(S,T,7),R=tr[b-2]|0,D=rr[b-2]|0,K=X.rotrSH(R,D,19)^X.rotrBH(R,D,61)^X.shrSH(R,D,6),j=X.rotrSL(R,D,19)^X.rotrBL(R,D,61)^X.shrSL(R,D,6),z=X.add4L(A,j,rr[b-7],rr[b-16]),W=X.add4H(z,O,K,tr[b-7],tr[b-16]);tr[b]=W|0,rr[b]=z|0}let{Ah:s,Al:i,Bh:n,Bl:o,Ch:a,Cl:c,Dh:u,Dl:h,Eh:l,El:p,Fh:f,Fl:d,Gh:m,Gl:g,Hh:w,Hl:y}=this;for(let b=0;b<80;b++){let S=X.rotrSH(l,p,14)^X.rotrSH(l,p,18)^X.rotrBH(l,p,41),T=X.rotrSL(l,p,14)^X.rotrSL(l,p,18)^X.rotrBL(l,p,41),O=l&f^~l&m,A=p&d^~p&g,R=X.add5L(y,T,A,am[b],rr[b]),D=X.add5H(R,w,S,O,om[b],tr[b]),K=R|0,j=X.rotrSH(s,i,28)^X.rotrBH(s,i,34)^X.rotrBH(s,i,39),z=X.rotrSL(s,i,28)^X.rotrBL(s,i,34)^X.rotrBL(s,i,39),W=s&n^s&a^n&a,F=i&o^i&c^o&c;w=m|0,y=g|0,m=f|0,g=d|0,f=l|0,d=p|0,{h:l,l:p}=X.add(u|0,h|0,D|0,K|0),u=a|0,h=c|0,a=n|0,c=o|0,n=s|0,o=i|0;let x=X.add3L(K,z,F);s=X.add3H(x,D,j,W),i=x|0}({h:s,l:i}=X.add(this.Ah|0,this.Al|0,s|0,i|0)),{h:n,l:o}=X.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=X.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:h}=X.add(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:p}=X.add(this.Eh|0,this.El|0,l|0,p|0),{h:f,l:d}=X.add(this.Fh|0,this.Fl|0,f|0,d|0),{h:m,l:g}=X.add(this.Gh|0,this.Gl|0,m|0,g|0),{h:w,l:y}=X.add(this.Hh|0,this.Hl|0,w|0,y|0),this.set(s,i,n,o,a,c,u,h,l,p,f,d,m,g,w,y)}roundClean(){tr.fill(0),rr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},cm=Lg(()=>new ro);var fo=BigInt(0),fh=BigInt(1),um=BigInt(2);function go(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function mo(r){if(!go(r))throw new Error("Uint8Array expected")}function Kn(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}var hm=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function yo(r){mo(r);let e="";for(let t=0;t<r.length;t++)e+=hm[r[t]];return e}function gh(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?fo:BigInt("0x"+r)}var jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ku(r){if(r>=jt._0&&r<=jt._9)return r-jt._0;if(r>=jt.A&&r<=jt.F)return r-(jt.A-10);if(r>=jt.a&&r<=jt.f)return r-(jt.a-10)}function mh(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(t);for(let i=0,n=0;i<t;i++,n+=2){let o=Ku(r.charCodeAt(n)),a=Ku(r.charCodeAt(n+1));if(o===void 0||a===void 0){let c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}s[i]=o*16+a}return s}function lm(r){return gh(yo(r))}function Ci(r){return mo(r),gh(yo(Uint8Array.from(r).reverse()))}function yh(r,e){return mh(r.toString(16).padStart(e*2,"0"))}function so(r,e){return yh(r,e).reverse()}function Mt(r,e,t){let s;if(typeof e=="string")try{s=mh(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(go(e))s=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let i=s.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return s}function Wu(...r){let e=0;for(let s=0;s<r.length;s++){let i=r[s];mo(i),e+=i.length}let t=new Uint8Array(e);for(let s=0,i=0;s<r.length;s++){let n=r[s];t.set(n,i),i+=n.length}return t}var Wn=r=>typeof r=="bigint"&&fo<=r;function pm(r,e,t){return Wn(r)&&Wn(e)&&Wn(t)&&e<=r&&r<t}function Us(r,e,t,s){if(!pm(e,t,s))throw new Error("expected valid "+r+": "+t+" <= n < "+s+", got "+e)}function dm(r){let e;for(e=0;r>fo;r>>=fh,e+=1);return e}var fm=r=>(um<<BigInt(r-1))-fh,gm={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||go(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function wo(r,e,t={}){let s=(i,n,o)=>{let a=gm[n];if(typeof a!="function")throw new Error("invalid validator function");let c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(let[i,n]of Object.entries(e))s(i,n,!1);for(let[i,n]of Object.entries(t))s(i,n,!0);return r}function Gu(r){let e=new WeakMap;return(t,...s)=>{let i=e.get(t);if(i!==void 0)return i;let n=r(t,...s);return e.set(t,n),n}}var De=BigInt(0),we=BigInt(1),yr=BigInt(2),mm=BigInt(3),io=BigInt(4),Yu=BigInt(5),Ju=BigInt(8);function Ie(r,e){let t=r%e;return t>=De?t:e+t}function ym(r,e,t){if(e<De)throw new Error("invalid exponent, negatives unsupported");if(t<=De)throw new Error("invalid modulus");if(t===we)return De;let s=we;for(;e>De;)e&we&&(s=s*r%t),r=r*r%t,e>>=we;return s}function Pt(r,e,t){let s=r;for(;e-- >De;)s*=s,s%=t;return s}function Xu(r,e){if(r===De)throw new Error("invert: expected non-zero number");if(e<=De)throw new Error("invert: expected positive modulus, got "+e);let t=Ie(r,e),s=e,i=De,n=we;for(;t!==De;){let o=s/t,a=s%t,c=i-n*o;s=t,t=a,i=n,n=c}if(s!==we)throw new Error("invert: does not exist");return Ie(i,e)}function wm(r){let e=(r-we)/yr,t,s,i;for(t=r-we,s=0;t%yr===De;t/=yr,s++);for(i=yr;i<r&&ym(i,e,r)!==r-we;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){let o=(r+we)/io;return function(a,c){let u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}let n=(t+we)/yr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=s,u=o.pow(o.mul(o.ONE,i),t),h=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let p=1;for(let d=o.sqr(l);p<c&&!o.eql(d,o.ONE);p++)d=o.sqr(d);let f=o.pow(u,we<<BigInt(c-p-1));u=o.sqr(f),h=o.mul(h,f),l=o.mul(l,u),c=p}return h}}function bm(r){if(r%io===mm){let e=(r+we)/io;return function(t,s){let i=t.pow(s,e);if(!t.eql(t.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%Ju===Yu){let e=(r-Yu)/Ju;return function(t,s){let i=t.mul(s,yr),n=t.pow(i,e),o=t.mul(s,n),a=t.mul(t.mul(o,yr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),s))throw new Error("Cannot find square root");return c}}return wm(r)}var vm=(r,e)=>(Ie(r,e)&we)===we,Em=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Im(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Em.reduce((s,i)=>(s[i]="function",s),e);return wo(r,t)}function _m(r,e,t){if(t<De)throw new Error("invalid exponent, negatives unsupported");if(t===De)return r.ONE;if(t===we)return e;let s=r.ONE,i=e;for(;t>De;)t&we&&(s=r.mul(s,i)),i=r.sqr(i),t>>=we;return s}function Sm(r,e){let t=new Array(e.length),s=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),i=r.inv(s);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),i),t}function wh(r,e){let t=e!==void 0?e:r.toString(2).length,s=Math.ceil(t/8);return{nBitLength:t,nByteLength:s}}function bh(r,e,t=!1,s={}){if(r<=De)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:i,nByteLength:n}=wh(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:n,MASK:fm(i),ZERO:De,ONE:we,create:c=>Ie(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return De<=c&&c<r},is0:c=>c===De,isOdd:c=>(c&we)===we,neg:c=>Ie(-c,r),eql:(c,u)=>c===u,sqr:c=>Ie(c*c,r),add:(c,u)=>Ie(c+u,r),sub:(c,u)=>Ie(c-u,r),mul:(c,u)=>Ie(c*u,r),pow:(c,u)=>_m(a,c,u),div:(c,u)=>Ie(c*Xu(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Xu(c,r),sqrt:s.sqrt||(c=>(o||(o=bm(r)),o(a,c))),invertBatch:c=>Sm(a,c),cmov:(c,u,h)=>h?u:c,toBytes:c=>t?so(c,n):yh(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Ci(c):lm(c)}});return Object.freeze(a)}var Zu=BigInt(0),Ai=BigInt(1);function Gn(r,e){let t=e.negate();return r?t:e}function vh(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Yn(r,e){vh(r,e);let t=Math.ceil(e/r)+1,s=2**(r-1);return{windows:t,windowSize:s}}function xm(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,s)=>{if(!(t instanceof e))throw new Error("invalid point at index "+s)})}function Dm(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,s)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+s)})}var Jn=new WeakMap,Eh=new WeakMap;function Xn(r){return Eh.get(r)||1}function Pm(r,e){return{constTimeNegate:Gn,hasPrecomputes(t){return Xn(t)!==1},unsafeLadder(t,s,i=r.ZERO){let n=t;for(;s>Zu;)s&Ai&&(i=i.add(n)),n=n.double(),s>>=Ai;return i},precomputeWindow(t,s){let{windows:i,windowSize:n}=Yn(s,e),o=[],a=t,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,s,i){let{windows:n,windowSize:o}=Yn(t,e),a=r.ZERO,c=r.BASE,u=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let p=0;p<n;p++){let f=p*o,d=Number(i&u);i>>=l,d>o&&(d-=h,i+=Ai);let m=f,g=f+Math.abs(d)-1,w=p%2!==0,y=d<0;d===0?c=c.add(Gn(w,s[m])):a=a.add(Gn(y,s[g]))}return{p:a,f:c}},wNAFUnsafe(t,s,i,n=r.ZERO){let{windows:o,windowSize:a}=Yn(t,e),c=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let l=0;l<o;l++){let p=l*a;if(i===Zu)break;let f=Number(i&c);if(i>>=h,f>a&&(f-=u,i+=Ai),f===0)continue;let d=s[p+Math.abs(f)-1];f<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(t,s,i){let n=Jn.get(s);return n||(n=this.precomputeWindow(s,t),t!==1&&Jn.set(s,i(n))),n},wNAFCached(t,s,i){let n=Xn(t);return this.wNAF(n,this.getPrecomputes(n,t,i),s)},wNAFCachedUnsafe(t,s,i,n){let o=Xn(t);return o===1?this.unsafeLadder(t,s,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),s,n)},setWindowSize(t,s){vh(s,e),Eh.set(t,s),Jn.delete(t)}}}function Am(r,e,t,s){if(xm(t,r),Dm(s,e),t.length!==s.length)throw new Error("arrays of points and scalars must have equal length");let i=r.ZERO,n=dm(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o,h=i;for(let l=u;l>=0;l-=o){c.fill(i);for(let f=0;f<s.length;f++){let d=s[f],m=Number(d>>BigInt(l)&BigInt(a));c[m]=c[m].add(t[f])}let p=i;for(let f=c.length-1,d=i;f>0;f--)d=d.add(c[f]),p=p.add(d);if(h=h.add(p),l!==0)for(let f=0;f<o;f++)h=h.double()}return h}function Om(r){return Im(r.Fp),wo(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...wh(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var wt=BigInt(0),Ye=BigInt(1),Oi=BigInt(2),Cm=BigInt(8),Tm={zip215:!0};function Rm(r){let e=Om(r);return wo(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Nm(r){let e=Rm(r),{Fp:t,n:s,prehash:i,hash:n,randomBytes:o,nByteLength:a,h:c}=e,u=Oi<<BigInt(a*8)-Ye,h=t.create,l=bh(e.n,e.nBitLength),p=e.uvRatio||((x,v)=>{try{return{isValid:!0,value:t.sqrt(x*t.inv(v))}}catch{return{isValid:!1,value:wt}}}),f=e.adjustScalarBytes||(x=>x),d=e.domain||((x,v,C)=>{if(Kn("phflag",C),v.length||C)throw new Error("Contexts/pre-hash are not supported");return x});function m(x,v){Us("coordinate "+x,v,wt,u)}function g(x){if(!(x instanceof b))throw new Error("ExtendedPoint expected")}let w=Gu((x,v)=>{let{ex:C,ey:N,ez:P}=x,q=x.is0();v==null&&(v=q?Cm:t.inv(P));let $=h(C*v),H=h(N*v),Y=h(P*v);if(q)return{x:wt,y:Ye};if(Y!==Ye)throw new Error("invZ was invalid");return{x:$,y:H}}),y=Gu(x=>{let{a:v,d:C}=e;if(x.is0())throw new Error("bad point: ZERO");let{ex:N,ey:P,ez:q,et:$}=x,H=h(N*N),Y=h(P*P),J=h(q*q),Z=h(J*J),re=h(H*v),pe=h(J*h(re+Y)),ue=h(Z+h(C*h(H*Y)));if(pe!==ue)throw new Error("bad point: equation left != right (1)");let se=h(N*P),ke=h(q*$);if(se!==ke)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(v,C,N,P){this.ex=v,this.ey=C,this.ez=N,this.et=P,m("x",v),m("y",C),m("z",N),m("t",P),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof b)throw new Error("extended point not allowed");let{x:C,y:N}=v||{};return m("x",C),m("y",N),new b(C,N,Ye,h(C*N))}static normalizeZ(v){let C=t.invertBatch(v.map(N=>N.ez));return v.map((N,P)=>N.toAffine(C[P])).map(b.fromAffine)}static msm(v,C){return Am(b,l,v,C)}_setWindowSize(v){O.setWindowSize(this,v)}assertValidity(){y(this)}equals(v){g(v);let{ex:C,ey:N,ez:P}=this,{ex:q,ey:$,ez:H}=v,Y=h(C*H),J=h(q*P),Z=h(N*H),re=h($*P);return Y===J&&Z===re}is0(){return this.equals(b.ZERO)}negate(){return new b(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){let{a:v}=e,{ex:C,ey:N,ez:P}=this,q=h(C*C),$=h(N*N),H=h(Oi*h(P*P)),Y=h(v*q),J=C+N,Z=h(h(J*J)-q-$),re=Y+$,pe=re-H,ue=Y-$,se=h(Z*pe),ke=h(re*ue),Te=h(Z*ue),Ve=h(pe*re);return new b(se,ke,Ve,Te)}add(v){g(v);let{a:C,d:N}=e,{ex:P,ey:q,ez:$,et:H}=this,{ex:Y,ey:J,ez:Z,et:re}=v;if(C===BigInt(-1)){let cu=h((q-P)*(J+Y)),uu=h((q+P)*(J-Y)),Nn=h(uu-cu);if(Nn===wt)return this.double();let hu=h($*Oi*re),lu=h(H*Oi*Z),pu=lu+hu,du=uu+cu,fu=lu-hu,Uf=h(pu*Nn),Bf=h(du*fu),Lf=h(pu*fu),qf=h(Nn*du);return new b(Uf,Bf,qf,Lf)}let pe=h(P*Y),ue=h(q*J),se=h(H*N*re),ke=h($*Z),Te=h((P+q)*(Y+J)-pe-ue),Ve=ke-se,ht=ke+se,Lt=h(ue-C*pe),Cr=h(Te*Ve),Rf=h(ht*Lt),Nf=h(Te*Lt),Ff=h(Ve*ht);return new b(Cr,Rf,Ff,Nf)}subtract(v){return this.add(v.negate())}wNAF(v){return O.wNAFCached(this,v,b.normalizeZ)}multiply(v){let C=v;Us("scalar",C,Ye,s);let{p:N,f:P}=this.wNAF(C);return b.normalizeZ([N,P])[0]}multiplyUnsafe(v,C=b.ZERO){let N=v;return Us("scalar",N,wt,s),N===wt?T:this.is0()||N===Ye?this:O.wNAFCachedUnsafe(this,N,b.normalizeZ,C)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,s).is0()}toAffine(v){return w(this,v)}clearCofactor(){let{h:v}=e;return v===Ye?this:this.multiplyUnsafe(v)}static fromHex(v,C=!1){let{d:N,a:P}=e,q=t.BYTES;v=Mt("pointHex",v,q),Kn("zip215",C);let $=v.slice(),H=v[q-1];$[q-1]=H&-129;let Y=Ci($),J=C?u:t.ORDER;Us("pointHex.y",Y,wt,J);let Z=h(Y*Y),re=h(Z-Ye),pe=h(N*Z-P),{isValid:ue,value:se}=p(re,pe);if(!ue)throw new Error("Point.fromHex: invalid y coordinate");let ke=(se&Ye)===Ye,Te=(H&128)!==0;if(!C&&se===wt&&Te)throw new Error("Point.fromHex: x=0 and x_0=1");return Te!==ke&&(se=h(-se)),b.fromAffine({x:se,y:Y})}static fromPrivateKey(v){return D(v).point}toRawBytes(){let{x:v,y:C}=this.toAffine(),N=so(C,t.BYTES);return N[N.length-1]|=v&Ye?128:0,N}toHex(){return yo(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Ye,h(e.Gx*e.Gy)),b.ZERO=new b(wt,Ye,Ye,wt);let{BASE:S,ZERO:T}=b,O=Pm(b,a*8);function A(x){return Ie(x,s)}function R(x){return A(Ci(x))}function D(x){let v=t.BYTES;x=Mt("private key",x,v);let C=Mt("hashed private key",n(x),2*v),N=f(C.slice(0,v)),P=C.slice(v,2*v),q=R(N),$=S.multiply(q),H=$.toRawBytes();return{head:N,prefix:P,scalar:q,point:$,pointBytes:H}}function K(x){return D(x).pointBytes}function j(x=new Uint8Array,...v){let C=Wu(...v);return R(n(d(C,Mt("context",x),!!i)))}function z(x,v,C={}){x=Mt("message",x),i&&(x=i(x));let{prefix:N,scalar:P,pointBytes:q}=D(v),$=j(C.context,N,x),H=S.multiply($).toRawBytes(),Y=j(C.context,H,q,x),J=A($+Y*P);Us("signature.s",J,wt,s);let Z=Wu(H,so(J,t.BYTES));return Mt("result",Z,t.BYTES*2)}let W=Tm;function F(x,v,C,N=W){let{context:P,zip215:q}=N,$=t.BYTES;x=Mt("signature",x,2*$),v=Mt("message",v),C=Mt("publicKey",C,$),q!==void 0&&Kn("zip215",q),i&&(v=i(v));let H=Ci(x.slice($,2*$)),Y,J,Z;try{Y=b.fromHex(C,q),J=b.fromHex(x.slice(0,$),q),Z=S.multiplyUnsafe(H)}catch{return!1}if(!q&&Y.isSmallOrder())return!1;let re=j(P,J.toRawBytes(),Y.toRawBytes(),v);return J.add(Y.multiplyUnsafe(re)).subtract(Z).clearCofactor().equals(b.ZERO)}return S._setWindowSize(8),{CURVE:e,getPublicKey:K,sign:z,verify:F,ExtendedPoint:b,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>o(t.BYTES),precompute(x=8,v=b.BASE){return v._setWindowSize(x),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);var bo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Qu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);var Fm=BigInt(1),eh=BigInt(2);BigInt(3);var Um=BigInt(5),Bm=BigInt(8);function Lm(r){let e=BigInt(10),t=BigInt(20),s=BigInt(40),i=BigInt(80),n=bo,o=r*r%n*r%n,a=Pt(o,eh,n)*o%n,c=Pt(a,Fm,n)*r%n,u=Pt(c,Um,n)*c%n,h=Pt(u,e,n)*u%n,l=Pt(h,t,n)*h%n,p=Pt(l,s,n)*l%n,f=Pt(p,i,n)*p%n,d=Pt(f,i,n)*p%n,m=Pt(d,e,n)*u%n;return{pow_p_5_8:Pt(m,eh,n)*r%n,b2:o}}function qm(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function km(r,e){let t=bo,s=Ie(e*e*e,t),i=Ie(s*s*e,t),n=Lm(r*i).pow_p_5_8,o=Ie(r*s*n,t),a=Ie(e*o*o,t),c=o,u=Ie(o*Qu,t),h=a===r,l=a===Ie(-r,t),p=a===Ie(-r*Qu,t);return h&&(o=c),(l||p)&&(o=u),vm(o,t)&&(o=Ie(-o,t)),{isValid:h||l,value:o}}var jm=bh(bo,void 0,!0),Mm={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:jm,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Bm,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:cm,randomBytes:ph,adjustScalarBytes:qm,uvRatio:km},Ih=Nm(Mm),$m="EdDSA",Vm="JWT",Ti=".",Ni="base64url",_h="utf8",Sh="utf8",zm=":",Hm="did",Km="key",th="base58btc",Wm="z",Gm="K36";var Ym=32;function vo(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function xh(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?vo(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Dh(r,e){e||(e=r.reduce((i,n)=>i+n.length,0));let t=xh(e),s=0;for(let i of r)t.set(i,s),s+=i.length;return vo(t)}function Jm(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var i=0;i<r.length;i++){var n=r.charAt(i),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,w=0,y=d.length;w!==y&&d[w]===0;)w++,m++;for(var b=(y-w)*h+1>>>0,S=new Uint8Array(b);w!==y;){for(var T=d[w],O=0,A=b-1;(T!==0||O<g)&&A!==-1;A--,O++)T+=256*S[A]>>>0,S[A]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");g=O,w++}for(var R=b-g;R!==b&&S[R]===0;)R++;for(var D=c.repeat(m);R<b;++R)D+=r.charAt(S[R]);return D}function p(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,w=0;d[m]===c;)g++,m++;for(var y=(d.length-m)*u+1>>>0,b=new Uint8Array(y);d[m];){var S=t[d.charCodeAt(m)];if(S===255)return;for(var T=0,O=y-1;(S!==0||T<w)&&O!==-1;O--,T++)S+=a*b[O]>>>0,b[O]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=T,m++}if(d[m]!==" "){for(var A=y-w;A!==y&&b[A]===0;)A++;for(var R=new Uint8Array(g+(y-A)),D=g;A!==y;)R[D++]=b[A++];return R}}}function f(d){var m=p(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:f}}var Xm=Jm,Zm=Xm,Ph=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Qm=r=>new TextEncoder().encode(r),ey=r=>new TextDecoder().decode(r),no=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},oo=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ah(this,e)}},ao=class{constructor(e){this.decoders=e}or(e){return Ah(this,e)}decode(e){let t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Ah=(r,e)=>new ao({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),co=class{constructor(e,t,s,i){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=i,this.encoder=new no(e,t,s),this.decoder=new oo(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Fi=({name:r,prefix:e,encode:t,decode:s})=>new co(r,e,t,s),Bs=({prefix:r,name:e,alphabet:t})=>{let{encode:s,decode:i}=Zm(t,e);return Fi({prefix:r,name:e,encode:s,decode:n=>Ph(i(n))})},ty=(r,e,t,s)=>{let i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;let o=new Uint8Array(n*t/8|0),a=0,c=0,u=0;for(let h=0;h<n;++h){let l=i[r[h]];if(l===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},ry=(r,e,t)=>{let s=e[e.length-1]==="=",i=(1<<t)-1,n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[i&a>>o];if(o&&(n+=e[i&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},Ne=({name:r,prefix:e,bitsPerChar:t,alphabet:s})=>Fi({prefix:e,name:r,encode(i){return ry(i,s,t)},decode(i){return ty(i,s,t,r)}}),sy=Fi({prefix:"\0",name:"identity",encode:r=>ey(r),decode:r=>Qm(r)}),iy=Object.freeze({__proto__:null,identity:sy}),ny=Ne({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),oy=Object.freeze({__proto__:null,base2:ny}),ay=Ne({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),cy=Object.freeze({__proto__:null,base8:ay}),uy=Bs({prefix:"9",name:"base10",alphabet:"0123456789"}),hy=Object.freeze({__proto__:null,base10:uy}),ly=Ne({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),py=Ne({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),dy=Object.freeze({__proto__:null,base16:ly,base16upper:py}),fy=Ne({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gy=Ne({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),my=Ne({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yy=Ne({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wy=Ne({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),by=Ne({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),vy=Ne({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ey=Ne({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Iy=Ne({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),_y=Object.freeze({__proto__:null,base32:fy,base32upper:gy,base32pad:my,base32padupper:yy,base32hex:wy,base32hexupper:by,base32hexpad:vy,base32hexpadupper:Ey,base32z:Iy}),Sy=Bs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xy=Bs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Dy=Object.freeze({__proto__:null,base36:Sy,base36upper:xy}),Py=Bs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ay=Bs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Oy=Object.freeze({__proto__:null,base58btc:Py,base58flickr:Ay}),Cy=Ne({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ty=Ne({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ry=Ne({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ny=Ne({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Fy=Object.freeze({__proto__:null,base64:Cy,base64pad:Ty,base64url:Ry,base64urlpad:Ny}),Oh=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Uy=Oh.reduce((r,e,t)=>(r[t]=e,r),[]),By=Oh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ly(r){return r.reduce((e,t)=>(e+=Uy[t],e),"")}function qy(r){let e=[];for(let t of r){let s=By[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}var ky=Fi({prefix:"\u{1F680}",name:"base256emoji",encode:Ly,decode:qy}),jy=Object.freeze({__proto__:null,base256emoji:ky}),My=Ch,rh=128,$y=127,Vy=~$y,zy=Math.pow(2,31);function Ch(r,e,t){e=e||[],t=t||0;for(var s=t;r>=zy;)e[t++]=r&255|rh,r/=128;for(;r&Vy;)e[t++]=r&255|rh,r>>>=7;return e[t]=r|0,Ch.bytes=t-s+1,e}var Hy=uo,Ky=128,sh=127;function uo(r,s){var t=0,s=s||0,i=0,n=s,o,a=r.length;do{if(n>=a)throw uo.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=i<28?(o&sh)<<i:(o&sh)*Math.pow(2,i),i+=7}while(o>=Ky);return uo.bytes=n-s,t}var Wy=Math.pow(2,7),Gy=Math.pow(2,14),Yy=Math.pow(2,21),Jy=Math.pow(2,28),Xy=Math.pow(2,35),Zy=Math.pow(2,42),Qy=Math.pow(2,49),ew=Math.pow(2,56),tw=Math.pow(2,63),rw=function(r){return r<Wy?1:r<Gy?2:r<Yy?3:r<Jy?4:r<Xy?5:r<Zy?6:r<Qy?7:r<ew?8:r<tw?9:10},sw={encode:My,decode:Hy,encodingLength:rw},Th=sw,ih=(r,e,t=0)=>(Th.encode(r,e,t),e),nh=r=>Th.encodingLength(r),ho=(r,e)=>{let t=e.byteLength,s=nh(r),i=s+nh(t),n=new Uint8Array(i+t);return ih(r,n,0),ih(t,n,s),n.set(e,i),new lo(r,t,e,n)},lo=class{constructor(e,t,s,i){this.code=e,this.size=t,this.digest=s,this.bytes=i}},Rh=({name:r,code:e,encode:t})=>new po(r,e,t),po=class{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?ho(this.code,t):t.then(s=>ho(this.code,s))}else throw Error("Unknown type, must be binary type")}},Nh=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),iw=Rh({name:"sha2-256",code:18,encode:Nh("SHA-256")}),nw=Rh({name:"sha2-512",code:19,encode:Nh("SHA-512")}),ow=Object.freeze({__proto__:null,sha256:iw,sha512:nw}),Fh=0,aw="identity",Uh=Ph,cw=r=>ho(Fh,Uh(r)),uw={code:Fh,name:aw,encode:Uh,digest:cw},hw=Object.freeze({__proto__:null,identity:uw});new TextEncoder,new TextDecoder;var oh={...iy,...oy,...cy,...hy,...dy,..._y,...Dy,...Oy,...Fy,...jy};({...ow,...hw});function Bh(r,e,t,s){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:s}}}var ah=Bh("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Zn=Bh("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=xh(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Lh={utf8:ah,"utf-8":ah,hex:oh.base16,latin1:Zn,ascii:Zn,binary:Zn,...oh};function Ui(r,e="utf8"){let t=Lh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Mr(r,e="utf8"){let t=Lh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?vo(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function ch(r){return xt(Ui(Mr(r,Ni),_h))}function Ri(r){return Ui(Mr(qt(r),_h),Ni)}function Eo(r){let e=Mr(Gm,th),t=Wm+Ui(Dh([e,r]),th);return[Hm,Km,t].join(zm)}function lw(r){return Ui(r,Ni)}function pw(r){return Mr(r,Ni)}function dw(r){return Mr([Ri(r.header),Ri(r.payload)].join(Ti),Sh)}function fw(r){return[Ri(r.header),Ri(r.payload),lw(r.signature)].join(Ti)}function Ls(r){let e=r.split(Ti),t=ch(e[0]),s=ch(e[1]),i=pw(e[2]),n=Mr(e.slice(0,2).join(Ti),Sh);return{header:t,payload:s,signature:i,data:n}}function Io(r=ph(Ym)){let e=Ih.getPublicKey(r);return{secretKey:Dh([r,e]),publicKey:e}}async function qh(r,e,t,s,i=(0,uh.fromMiliseconds)(Date.now())){let n={alg:$m,typ:Vm},o=Eo(s.publicKey),a=i+t,c={iss:o,sub:r,aud:e,iat:i,exp:a},u=dw({header:n,payload:c}),h=Ih.sign(u,s.secretKey.slice(0,32));return fw({header:n,payload:c,signature:h})}E();_();I();E();_();I();E();_();I();E();_();I();function qs(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function wr(r,e){e||(e=r.reduce((i,n)=>i+n.length,0));let t=qs(e),s=0;for(let i of r)t.set(i,s),s+=i.length;return t}E();_();I();E();_();I();E();_();I();E();_();I();var Po={};tt(Po,{identity:()=>Ew});E();_();I();E();_();I();E();_();I();function mw(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var i=0;i<r.length;i++){var n=r.charAt(i),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,w=0,y=d.length;w!==y&&d[w]===0;)w++,m++;for(var b=(y-w)*h+1>>>0,S=new Uint8Array(b);w!==y;){for(var T=d[w],O=0,A=b-1;(T!==0||O<g)&&A!==-1;A--,O++)T+=256*S[A]>>>0,S[A]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");g=O,w++}for(var R=b-g;R!==b&&S[R]===0;)R++;for(var D=c.repeat(m);R<b;++R)D+=r.charAt(S[R]);return D}function p(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,w=0;d[m]===c;)g++,m++;for(var y=(d.length-m)*u+1>>>0,b=new Uint8Array(y);d[m];){var S=t[d.charCodeAt(m)];if(S===255)return;for(var T=0,O=y-1;(S!==0||T<w)&&O!==-1;O--,T++)S+=a*b[O]>>>0,b[O]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=T,m++}if(d[m]!==" "){for(var A=y-w;A!==y&&b[A]===0;)A++;for(var R=new Uint8Array(g+(y-A)),D=g;A!==y;)R[D++]=b[A++];return R}}}function f(d){var m=p(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:f}}var yw=mw,ww=yw,kh=ww;E();_();I();var GP=new Uint8Array(0);var jh=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},$t=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Mh=r=>new TextEncoder().encode(r),$h=r=>new TextDecoder().decode(r);var _o=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},So=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zh(this,e)}},xo=class{constructor(e){this.decoders=e}or(e){return zh(this,e)}decode(e){let t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},zh=(r,e)=>new xo({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),Do=class{constructor(e,t,s,i){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=i,this.encoder=new _o(e,t,s),this.decoder=new So(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},$r=({name:r,prefix:e,encode:t,decode:s})=>new Do(r,e,t,s),sr=({prefix:r,name:e,alphabet:t})=>{let{encode:s,decode:i}=kh(t,e);return $r({prefix:r,name:e,encode:s,decode:n=>$t(i(n))})},bw=(r,e,t,s)=>{let i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;let o=new Uint8Array(n*t/8|0),a=0,c=0,u=0;for(let h=0;h<n;++h){let l=i[r[h]];if(l===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},vw=(r,e,t)=>{let s=e[e.length-1]==="=",i=(1<<t)-1,n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[i&a>>o];if(o&&(n+=e[i&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},me=({name:r,prefix:e,bitsPerChar:t,alphabet:s})=>$r({prefix:e,name:r,encode(i){return vw(i,s,t)},decode(i){return bw(i,s,t,r)}});var Ew=$r({prefix:"\0",name:"identity",encode:r=>$h(r),decode:r=>Mh(r)});var Ao={};tt(Ao,{base2:()=>Iw});E();_();I();var Iw=me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Oo={};tt(Oo,{base8:()=>_w});E();_();I();var _w=me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Co={};tt(Co,{base10:()=>Sw});E();_();I();var Sw=sr({prefix:"9",name:"base10",alphabet:"0123456789"});var To={};tt(To,{base16:()=>xw,base16upper:()=>Dw});E();_();I();var xw=me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Dw=me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ro={};tt(Ro,{base32:()=>Vr,base32hex:()=>Cw,base32hexpad:()=>Rw,base32hexpadupper:()=>Nw,base32hexupper:()=>Tw,base32pad:()=>Aw,base32padupper:()=>Ow,base32upper:()=>Pw,base32z:()=>Fw});E();_();I();var Vr=me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pw=me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Aw=me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ow=me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Cw=me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Tw=me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Rw=me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Nw=me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fw=me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var No={};tt(No,{base36:()=>Uw,base36upper:()=>Bw});E();_();I();var Uw=sr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bw=sr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Fo={};tt(Fo,{base58btc:()=>At,base58flickr:()=>Lw});E();_();I();var At=sr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lw=sr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Uo={};tt(Uo,{base64:()=>qw,base64pad:()=>kw,base64url:()=>jw,base64urlpad:()=>Mw});E();_();I();var qw=me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),kw=me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),jw=me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Mw=me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Bo={};tt(Bo,{base256emoji:()=>Kw});E();_();I();var Hh=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),$w=Hh.reduce((r,e,t)=>(r[t]=e,r),[]),Vw=Hh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function zw(r){return r.reduce((e,t)=>(e+=$w[t],e),"")}function Hw(r){let e=[];for(let t of r){let s=Vw[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}var Kw=$r({prefix:"\u{1F680}",name:"base256emoji",encode:zw,decode:Hw});var jo={};tt(jo,{sha256:()=>lb,sha512:()=>pb});E();_();I();E();_();I();E();_();I();E();_();I();E();_();I();var Ww=Gh,Kh=128,Gw=127,Yw=~Gw,Jw=Math.pow(2,31);function Gh(r,e,t){e=e||[],t=t||0;for(var s=t;r>=Jw;)e[t++]=r&255|Kh,r/=128;for(;r&Yw;)e[t++]=r&255|Kh,r>>>=7;return e[t]=r|0,Gh.bytes=t-s+1,e}var Xw=Lo,Zw=128,Wh=127;function Lo(r,s){var t=0,s=s||0,i=0,n=s,o,a=r.length;do{if(n>=a)throw Lo.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=i<28?(o&Wh)<<i:(o&Wh)*Math.pow(2,i),i+=7}while(o>=Zw);return Lo.bytes=n-s,t}var Qw=Math.pow(2,7),eb=Math.pow(2,14),tb=Math.pow(2,21),rb=Math.pow(2,28),sb=Math.pow(2,35),ib=Math.pow(2,42),nb=Math.pow(2,49),ob=Math.pow(2,56),ab=Math.pow(2,63),cb=function(r){return r<Qw?1:r<eb?2:r<tb?3:r<rb?4:r<sb?5:r<ib?6:r<nb?7:r<ob?8:r<ab?9:10},ub={encode:Ww,decode:Xw,encodingLength:cb},hb=ub,ks=hb;var js=(r,e=0)=>[ks.decode(r,e),ks.decode.bytes],zr=(r,e,t=0)=>(ks.encode(r,e,t),e),Hr=r=>ks.encodingLength(r);var br=(r,e)=>{let t=e.byteLength,s=Hr(r),i=s+Hr(t),n=new Uint8Array(i+t);return zr(r,n,0),zr(t,n,s),n.set(e,i),new Kr(r,t,e,n)},Yh=r=>{let e=$t(r),[t,s]=js(e),[i,n]=js(e.subarray(s)),o=e.subarray(s+n);if(o.byteLength!==i)throw new Error("Incorrect length");return new Kr(t,i,o,e)},Jh=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&jh(r.bytes,e.bytes),Kr=class{constructor(e,t,s,i){this.code=e,this.size=t,this.digest=s,this.bytes=i}};var ko=({name:r,code:e,encode:t})=>new qo(r,e,t),qo=class{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?br(this.code,t):t.then(s=>br(this.code,s))}else throw Error("Unknown type, must be binary type")}};var Zh=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),lb=ko({name:"sha2-256",code:18,encode:Zh("SHA-256")}),pb=ko({name:"sha2-512",code:19,encode:Zh("SHA-512")});var Mo={};tt(Mo,{identity:()=>gb});E();_();I();var Qh=0,db="identity",el=$t,fb=r=>br(Qh,el(r)),gb={code:Qh,name:db,encode:el,digest:fb};E();_();I();E();_();I();var wO=new TextEncoder,bO=new TextDecoder;E();_();I();E();_();I();var ki=class r{constructor(e,t,s,i){this.code=t,this.version=e,this.multihash=s,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:qi,byteLength:qi,code:Li,version:Li,multihash:Li,bytes:Li,_baseCache:qi,asCID:qi})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==$s)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Eb)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,s=br(e,t);return r.createV1(this.code,s)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Jh(this.multihash,e.multihash)}toString(e){let{bytes:t,version:s,_baseCache:i}=this;switch(s){case 0:return bb(t,i,e||At.encoder);default:return vb(t,i,e||Vr.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return _b(/^0\.0/,Sb),!!(e&&(e[rl]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof r)return e;if(e!=null&&e.asCID===e){let{version:t,code:s,multihash:i,bytes:n}=e;return new r(t,s,i,n||tl(t,s,i.bytes))}else if(e!=null&&e[rl]===!0){let{version:t,multihash:s,code:i}=e,n=Yh(s);return r.create(t,i,n)}else return null}static create(e,t,s){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==$s)throw new Error(`Version 0 CID must use dag-pb (code: ${$s}) block encoding`);return new r(e,t,s,s.bytes)}case 1:{let i=tl(e,t,s.bytes);return new r(e,t,s,i)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,$s,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,s]=r.decodeFirst(e);if(s.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),s=t.size-t.multihashSize,i=$t(e.subarray(s,s+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let n=i.subarray(t.multihashSize-t.digestSize),o=new Kr(t.multihashCode,t.digestSize,n,i);return[t.version===0?r.createV0(o):r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,s=()=>{let[l,p]=js(e.subarray(t));return t+=p,l},i=s(),n=$s;if(i===18?(i=0,t=0):i===1&&(n=s()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=s(),c=s(),u=t+c,h=u-o;return{version:i,codec:n,multihashCode:a,digestSize:c,multihashSize:h,size:u}}static parse(e,t){let[s,i]=wb(e,t),n=r.decode(i);return n._baseCache.set(s,e),n}},wb=(r,e)=>{switch(r[0]){case"Q":{let t=e||At;return[At.prefix,t.decode(`${At.prefix}${r}`)]}case At.prefix:{let t=e||At;return[At.prefix,t.decode(r)]}case Vr.prefix:{let t=e||Vr;return[Vr.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},bb=(r,e,t)=>{let{prefix:s}=t;if(s!==At.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(s);if(i==null){let n=t.encode(r).slice(1);return e.set(s,n),n}else return i},vb=(r,e,t)=>{let{prefix:s}=t,i=e.get(s);if(i==null){let n=t.encode(r);return e.set(s,n),n}else return i},$s=112,Eb=18,tl=(r,e,t)=>{let s=Hr(r),i=s+Hr(e),n=new Uint8Array(i+t.byteLength);return zr(r,n,0),zr(e,n,s),n.set(t,i),n},rl=Symbol.for("@ipld/js-cid/CID"),Li={writable:!1,configurable:!1,enumerable:!0},qi={writable:!1,enumerable:!1,configurable:!1},Ib="0.0.0-dev",_b=(r,e)=>{if(r.test(Ib))console.warn(e);else throw new Error(e)},Sb=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var $o={...Po,...Ao,...Oo,...Co,...To,...Ro,...No,...Fo,...Uo,...Bo},BO={...jo,...Mo};function il(r,e,t,s){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:s}}}var sl=il("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Vo=il("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=qs(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),xb={utf8:sl,"utf-8":sl,hex:$o.base16,latin1:Vo,ascii:Vo,binary:Vo,...$o},ji=xb;function Je(r,e="utf8"){let t=ji[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}E();_();I();function Fe(r,e="utf8"){let t=ji[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}E();_();I();E();_();I();var nl={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Db=":";function ur(r){let[e,t]=r.split(Db);return{namespace:e,reference:t}}function T2(r,e=[]){let t=[];return Object.keys(r).forEach(s=>{if(e.length&&!e.includes(s))return;let i=r[s];t.push(...i.accounts)}),t}function Bl(r,e){return r.includes(":")?[r]:e.chains||[]}var Pb=Object.defineProperty,Ab=Object.defineProperties,Ob=Object.getOwnPropertyDescriptors,ol=Object.getOwnPropertySymbols,Cb=Object.prototype.hasOwnProperty,Tb=Object.prototype.propertyIsEnumerable,al=(r,e,t)=>e in r?Pb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cl=(r,e)=>{for(var t in e||(e={}))Cb.call(e,t)&&al(r,t,e[t]);if(ol)for(var t of ol(e))Tb.call(e,t)&&al(r,t,e[t]);return r},Rb=(r,e)=>Ab(r,Ob(e)),Nb="ReactNative",Ze={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var Fb="js";function Js(){return typeof k<"u"&&typeof k.versions<"u"&&typeof k.versions.node<"u"}function Yt(){return!(0,Gt.getDocument)()&&!!(0,Gt.getNavigator)()&&navigator.product===Nb}function Ll(){return Yt()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="android"}function ql(){return Yt()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="ios"}function ss(){return!Js()&&!!(0,Gt.getNavigator)()&&!!(0,Gt.getDocument)()}function Xs(){return Yt()?Ze.reactNative:Js()?Ze.node:ss()?Ze.browser:Ze.unknown}function fa(){var r;try{return Yt()&&typeof globalThis<"u"&&typeof globalThis?.Application<"u"?(r=globalThis.Application)==null?void 0:r.applicationId:void 0}catch{return}}function Ub(r,e){let t=new URLSearchParams(r);for(let s of Object.keys(e).sort())if(e.hasOwnProperty(s)){let i=e[s];i!==void 0&&t.set(s,i)}return t.toString()}function kl(r){var e,t;let s=ga();try{return r!=null&&r.url&&s.url&&r.url!==s.url&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${s.url}. This is probably unintended and can lead to issues.`),r.url=s.url),(e=r?.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(i=>i!=="")),Rb(cl(cl({},s),r),{url:r?.url||s.url,name:r?.name||s.name,description:r?.description||s.description,icons:(t=r?.icons)!=null&&t.length&&r.icons.length>0?r.icons:s.icons})}catch(i){return console.warn("Error populating app metadata",i),r||s}}function ga(){return(0,Ul.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function Bb(){if(Xs()===Ze.reactNative&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"){let{OS:t,Version:s}=globalThis.Platform;return[t,s].join("-")}let r=xu();if(r===null)return"unknown";let e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Lb(){var r;let e=Xs();return e===Ze.browser?[e,((r=(0,Gt.getLocation)())==null?void 0:r.host)||"unknown"].join(":"):e}function ma(r,e,t){let s=Bb(),i=Lb();return[[r,e].join("-"),[Fb,t].join("-"),s,i].join("/")}function jl({protocol:r,version:e,relayUrl:t,sdkVersion:s,auth:i,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){let u=t.split("?"),h=ma(r,e,s),l={auth:i,ua:h,projectId:n,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},p=Ub(u[1]||"",l);return u[0]+"?"+p}function Er(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Ki(r){return Object.fromEntries(r.entries())}function Wi(r){return new Map(Object.entries(r))}function Jt(r=Wt.FIVE_MINUTES,e){let t=(0,Wt.toMiliseconds)(r||Wt.FIVE_MINUTES),s,i,n,o;return{resolve:a=>{n&&s&&(clearTimeout(n),s(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{let u=new Error(e);o=Promise.reject(u),c(u)},t),s=a,i=c})}}function Xt(r,e,t){return new Promise(async(s,i)=>{let n=setTimeout(()=>i(new Error(t)),e);try{let o=await r;s(o)}catch(o){i(o)}clearTimeout(n)})}function Ml(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function $l(r){return Ml("topic",r)}function Vl(r){return Ml("id",r)}function Gi(r){let[e,t]=r.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")s.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return s}function ve(r,e){return(0,Wt.fromMiliseconds)((e||Date.now())+(0,Wt.toMiliseconds)(r))}function Ct(r){return Date.now()>=(0,Wt.toMiliseconds)(r)}function ne(r,e){return`${r}${e?`:${e}`:""}`}function Zs(r=[],e=[]){return[...new Set([...r,...e])]}async function zl({id:r,topic:e,wcDeepLink:t}){var s;try{if(!t)return;let i=typeof t=="string"?JSON.parse(t):t,n=i?.href;if(typeof n!="string")return;let o=qb(n,r,e),a=Xs();if(a===Ze.browser){if(!((s=(0,Gt.getDocument)())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}kb(o)}else a===Ze.reactNative&&typeof globalThis?.Linking<"u"&&await globalThis.Linking.openURL(o)}catch(i){console.error(i)}}function qb(r,e,t){let s=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let i=`${r}`;if(r.startsWith("https://t.me")){let n=r.includes("?")?"&startapp=":"?startapp=";i=`${i}${n}${$b(s,!0)}`}else i=`${i}/wc?${s}`;return i}function kb(r){let e="_self";Mb()?e="_top":(jb()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function Hl(r,e){let t="";try{if(ss()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(s){console.error(s)}return t}function ya(r,e){if(!r.includes(e))return null;let t=r.split(/([&,?,=])/),s=t.indexOf(e);return t[s+2]}function wa(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function Qs(){return typeof k<"u"&&k.env.IS_VITEST==="true"}function jb(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Mb(){try{return window.self!==window.top}catch{return!1}}function $b(r,e=!1){let t=B.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function Kl(r){return B.from(r,"base64").toString("utf-8")}function Wl(r){return new Promise(e=>setTimeout(e,r))}function Hs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Vb(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ei(r,...e){if(!Vb(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ba(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hs(r.outputLen),Hs(r.blockLen)}function Jr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Gl(r,e){ei(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}var Mi=BigInt(2**32-1),ul=BigInt(32);function zb(r,e=!1){return e?{h:Number(r&Mi),l:Number(r>>ul&Mi)}:{h:Number(r>>ul&Mi)|0,l:Number(r&Mi)|0}}function Hb(r,e=!1){let t=new Uint32Array(r.length),s=new Uint32Array(r.length);for(let i=0;i<r.length;i++){let{h:n,l:o}=zb(r[i],e);[t[i],s[i]]=[n,o]}return[t,s]}var Kb=(r,e,t)=>r<<t|e>>>32-t,Wb=(r,e,t)=>e<<t|r>>>32-t,Gb=(r,e,t)=>e<<t-32|r>>>64-t,Yb=(r,e,t)=>r<<t-32|e>>>64-t,Wr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Jb(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function zo(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ot(r,e){return r<<32-e|r>>>e}var hl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xb(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function ll(r){for(let e=0;e<r.length;e++)r[e]=Xb(r[e])}function Zb(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Xr(r){return typeof r=="string"&&(r=Zb(r)),ei(r),r}function Qb(...r){let e=0;for(let s=0;s<r.length;s++){let i=r[s];ei(i),e+=i.length}let t=new Uint8Array(e);for(let s=0,i=0;s<r.length;s++){let n=r[s];t.set(n,i),i+=n.length}return t}var Ks=class{clone(){return this._cloneInto()}};function Yl(r){let e=s=>r().update(Xr(s)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function is(r=32){if(Wr&&typeof Wr.getRandomValues=="function")return Wr.getRandomValues(new Uint8Array(r));if(Wr&&typeof Wr.randomBytes=="function")return Wr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}var Jl=[],Xl=[],Zl=[],ev=BigInt(0),Vs=BigInt(1),tv=BigInt(2),rv=BigInt(7),sv=BigInt(256),iv=BigInt(113);for(let r=0,e=Vs,t=1,s=0;r<24;r++){[t,s]=[s,(2*t+3*s)%5],Jl.push(2*(5*s+t)),Xl.push((r+1)*(r+2)/2%64);let i=ev;for(let n=0;n<7;n++)e=(e<<Vs^(e>>rv)*iv)%sv,e&tv&&(i^=Vs<<(Vs<<BigInt(n))-Vs);Zl.push(i)}var[nv,ov]=Hb(Zl,!0),pl=(r,e,t)=>t>32?Gb(r,e,t):Kb(r,e,t),dl=(r,e,t)=>t>32?Yb(r,e,t):Wb(r,e,t);function av(r,e=24){let t=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,u=t[c],h=t[c+1],l=pl(u,h,1)^t[a],p=dl(u,h,1)^t[a+1];for(let f=0;f<50;f+=10)r[o+f]^=l,r[o+f+1]^=p}let i=r[2],n=r[3];for(let o=0;o<24;o++){let a=Xl[o],c=pl(i,n,a),u=dl(i,n,a),h=Jl[o];i=r[h],n=r[h+1],r[h]=c,r[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=nv[s],r[1]^=ov[s]}t.fill(0)}var ta=class r extends Ks{constructor(e,t,s,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=s,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hs(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Jb(this.state)}keccak(){hl||ll(this.state32),av(this.state32,this.rounds),hl||ll(this.state32),this.posOut=0,this.pos=0}update(e){Jr(this);let{blockLen:t,state:s}=this;e=Xr(e);let i=e.length;for(let n=0;n<i;){let o=Math.min(t-this.pos,i-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:s,blockLen:i}=this;e[s]^=t,(t&128)!==0&&s===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Jr(this,!1),ei(e),this.finish();let t=this.state,{blockLen:s}=this;for(let i=0,n=e.length;i<n;){this.posOut>=s&&this.keccak();let o=Math.min(s-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Gl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:s,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new r(t,s,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}},cv=(r,e,t)=>Yl(()=>new ta(e,r,t)),uv=cv(1,136,256/8),hv="https://rpc.walletconnect.org/v1";function Ql(r){let e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+B.from(uv(t)).toString("hex")}async function lv(r,e,t,s,i,n){switch(t.t){case"eip191":return await pv(r,e,t.s);case"eip1271":return await dv(r,e,t.s,s,i,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function pv(r,e,t){return(await zn({hash:Ql(e),signature:t})).toLowerCase()===r.toLowerCase()}async function dv(r,e,t,s,i,n){let o=ur(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),l=Ql(e).substring(2),p=a+l+c+u+h,f=await fetch(`${n||hv}/?chainId=${s}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:fv(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:p},"latest"]})}),{result:d}=await f.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function fv(){return Date.now()+Math.floor(Math.random()*1e3)}function ep(r){let e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);let s=t[0];if(s===0)throw new Error("No signatures found");let i=1+s*64;if(t.length<i)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");let n=B.from(r,"base64").slice(1,65);return zu.encode(n)}var gv=Object.defineProperty,mv=Object.defineProperties,yv=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,wv=Object.prototype.hasOwnProperty,bv=Object.prototype.propertyIsEnumerable,gl=(r,e,t)=>e in r?gv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vv=(r,e)=>{for(var t in e||(e={}))wv.call(e,t)&&gl(r,t,e[t]);if(fl)for(var t of fl(e))bv.call(e,t)&&gl(r,t,e[t]);return r},Ev=(r,e)=>mv(r,yv(e)),Iv="did:pkh:",va=r=>r?.split(":"),_v=r=>{let e=r&&va(r);if(e)return r.includes(Iv)?e[3]:e[1]},Yi=r=>{let e=r&&va(r);if(e)return e[2]+":"+e[3]},ti=r=>{let e=r&&va(r);if(e)return e.pop()};async function Ea(r){let{cacao:e,projectId:t}=r,{s,p:i}=e,n=Ia(i,i.iss),o=ti(i.iss);return await lv(o,n,s,Yi(i.iss),t)}var Ia=(r,e)=>{let t=`${r.domain} wants you to sign in with your Ethereum account:`,s=ti(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=r.statement||void 0,n=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${_v(e)}`,c=`Nonce: ${r.nonce}`,u=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,l=r.nbf?`Not Before: ${r.nbf}`:void 0,p=r.requestId?`Request ID: ${r.requestId}`:void 0,f=r.resources?`Resources:${r.resources.map(m=>`
- ${m}`).join("")}`:void 0,d=ri(r.resources);if(d){let m=Ws(d);i=Cv(i,m)}return[t,s,"",i,"",n,o,a,c,u,h,l,p,f].filter(m=>m!=null).join(`
`)};function Sv(r){return B.from(JSON.stringify(r)).toString("base64")}function xv(r){return JSON.parse(B.from(r,"base64").toString("utf-8"))}function _r(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");let e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{let s=r.att[t];if(Array.isArray(s))throw new Error(`Resource must be an object: ${t}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(s).forEach(i=>{let n=s[i];if(!Array.isArray(n))throw new Error(`Ability limits ${i} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function Dv(r,e,t,s={}){return t?.sort((i,n)=>i.localeCompare(n)),{att:{[r]:Pv(e,t,s)}}}function Pv(r,e,t={}){e=e?.sort((i,n)=>i.localeCompare(n));let s=e.map(i=>({[`${r}/${i}`]:[t]}));return Object.assign({},...s)}function tp(r){return _r(r),`urn:recap:${Sv(r).replace(/=/g,"")}`}function Ws(r){let e=xv(r.replace("urn:recap:",""));return _r(e),e}function rp(r,e,t){let s=Dv(r,e,t);return tp(s)}function Av(r){return r&&r.includes("urn:recap:")}function sp(r,e){let t=Ws(r),s=Ws(e),i=Ov(t,s);return tp(i)}function Ov(r,e){_r(r),_r(e);let t=Object.keys(r.att).concat(Object.keys(e.att)).sort((i,n)=>i.localeCompare(n)),s={att:{}};return t.forEach(i=>{var n,o;Object.keys(((n=r.att)==null?void 0:n[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;s.att[i]=Ev(vv({},s.att[i]),{[a]:((c=r.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),s}function Cv(r="",e){_r(e);let t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;let s=[],i=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,p)=>l.action.localeCompare(p.action));let u={};c.forEach(l=>{u[l.ability]||(u[l.ability]=[]),u[l.ability].push(l.action)});let h=Object.keys(u).map(l=>(i++,`(${i}) '${l}': '${u[l].join("', '")}' for '${a}'.`));s.push(h.join(", ").replace(".,","."))});let n=s.join(" "),o=`${t}${n}`;return`${r?r+" ":""}${o}`}function _a(r){var e;let t=Ws(r);_r(t);let s=(e=t.att)==null?void 0:e.eip155;return s?Object.keys(s).map(i=>i.split("/")[1]):[]}function Sa(r){let e=Ws(r);_r(e);let t=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(i=>{var n;(n=i?.[0])!=null&&n.chains&&t.push(i[0].chains)})}),[...new Set(t.flat())]}function ri(r){if(!r)return;let e=r?.[r.length-1];return Av(e)?e:void 0}function Ho(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ip(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function it(r,...e){if(!ip(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ml(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Tv(r,e){it(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function yl(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}var or=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Rv=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Nv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Nv)throw new Error("Non little-endian hardware is not supported");function Fv(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function ra(r){if(typeof r=="string")r=Fv(r);else if(ip(r))r=sa(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Uv(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Bv(r,e){if(r.length!==e.length)return!1;let t=0;for(let s=0;s<r.length;s++)t|=r[s]^e[s];return t===0}var Lv=(r,e)=>{function t(s,...i){if(it(s),r.nonceLength!==void 0){let u=i[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?it(u):it(u,r.nonceLength)}let n=r.tagLength;n&&i[1]!==void 0&&it(i[1]);let o=e(s,...i),a=(u,h)=>{if(h!==void 0){if(u!==2)throw new Error("cipher output not supported");it(h)}},c=!1;return{encrypt(u,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,it(u),a(o.encrypt.length,h),o.encrypt(u,h)},decrypt(u,h){if(it(u),n&&u.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(u,h)}}}return Object.assign(t,r),t};function wl(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!qv(e))throw new Error("invalid output, must be aligned");return e}function bl(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);let i=BigInt(32),n=BigInt(4294967295),o=Number(t>>i&n),a=Number(t&n),c=s?4:0,u=s?0:4;r.setUint32(e+c,o,s),r.setUint32(e+u,a,s)}function qv(r){return r.byteOffset%4===0}function sa(r){return Uint8Array.from(r)}function Zr(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}var np=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),kv=np("expand 16-byte k"),jv=np("expand 32-byte k"),Mv=or(kv),$v=or(jv);function ie(r,e){return r<<e|r>>>32-e}function ia(r){return r.byteOffset%4===0}var $i=64,Vv=16,op=2**32-1,vl=new Uint32Array;function zv(r,e,t,s,i,n,o,a){let c=i.length,u=new Uint8Array($i),h=or(u),l=ia(i)&&ia(n),p=l?or(i):vl,f=l?or(n):vl;for(let d=0;d<c;o++){if(r(e,t,s,h,o,a),o>=op)throw new Error("arx: counter overflow");let m=Math.min($i,c-d);if(l&&m===$i){let g=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<Vv;w++)y=g+w,f[y]=p[y]^h[w];d+=$i;continue}for(let g=0,w;g<m;g++)w=d+g,n[w]=i[w]^u[g];d+=m}}function Hv(r,e){let{allowShortKeys:t,extendNonceFn:s,counterLength:i,counterRight:n,rounds:o}=Uv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Ho(i),Ho(o),yl(n),yl(t),(a,c,u,h,l=0)=>{it(a),it(c),it(u);let p=u.length;if(h===void 0&&(h=new Uint8Array(p)),it(h),Ho(l),l<0||l>=op)throw new Error("arx: counter overflow");if(h.length<p)throw new Error(`arx: output (${h.length}) is shorter than data (${p})`);let f=[],d=a.length,m,g;if(d===32)f.push(m=sa(a)),g=$v;else if(d===16&&t)m=new Uint8Array(32),m.set(a),m.set(a,16),g=Mv,f.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);ia(c)||f.push(c=sa(c));let w=or(m);if(s){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(g,w,or(c.subarray(0,16)),w),c=c.subarray(16)}let y=16-i;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){let S=new Uint8Array(12);S.set(c,n?0:12-c.length),c=S,f.push(c)}let b=or(c);return zv(r,g,w,b,u,h,l,o),Zr(...f),h}}var Ue=(r,e)=>r[e++]&255|(r[e++]&255)<<8,na=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ra(e),it(e,32);let t=Ue(e,0),s=Ue(e,2),i=Ue(e,4),n=Ue(e,6),o=Ue(e,8),a=Ue(e,10),c=Ue(e,12),u=Ue(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|s<<3)&8191,this.r[2]=(s>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let h=0;h<8;h++)this.pad[h]=Ue(e,16+2*h)}process(e,t,s=!1){let i=s?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],u=o[2],h=o[3],l=o[4],p=o[5],f=o[6],d=o[7],m=o[8],g=o[9],w=Ue(e,t+0),y=Ue(e,t+2),b=Ue(e,t+4),S=Ue(e,t+6),T=Ue(e,t+8),O=Ue(e,t+10),A=Ue(e,t+12),R=Ue(e,t+14),D=n[0]+(w&8191),K=n[1]+((w>>>13|y<<3)&8191),j=n[2]+((y>>>10|b<<6)&8191),z=n[3]+((b>>>7|S<<9)&8191),W=n[4]+((S>>>4|T<<12)&8191),F=n[5]+(T>>>1&8191),x=n[6]+((T>>>14|O<<2)&8191),v=n[7]+((O>>>11|A<<5)&8191),C=n[8]+((A>>>8|R<<8)&8191),N=n[9]+(R>>>5|i),P=0,q=P+D*a+K*(5*g)+j*(5*m)+z*(5*d)+W*(5*f);P=q>>>13,q&=8191,q+=F*(5*p)+x*(5*l)+v*(5*h)+C*(5*u)+N*(5*c),P+=q>>>13,q&=8191;let $=P+D*c+K*a+j*(5*g)+z*(5*m)+W*(5*d);P=$>>>13,$&=8191,$+=F*(5*f)+x*(5*p)+v*(5*l)+C*(5*h)+N*(5*u),P+=$>>>13,$&=8191;let H=P+D*u+K*c+j*a+z*(5*g)+W*(5*m);P=H>>>13,H&=8191,H+=F*(5*d)+x*(5*f)+v*(5*p)+C*(5*l)+N*(5*h),P+=H>>>13,H&=8191;let Y=P+D*h+K*u+j*c+z*a+W*(5*g);P=Y>>>13,Y&=8191,Y+=F*(5*m)+x*(5*d)+v*(5*f)+C*(5*p)+N*(5*l),P+=Y>>>13,Y&=8191;let J=P+D*l+K*h+j*u+z*c+W*a;P=J>>>13,J&=8191,J+=F*(5*g)+x*(5*m)+v*(5*d)+C*(5*f)+N*(5*p),P+=J>>>13,J&=8191;let Z=P+D*p+K*l+j*h+z*u+W*c;P=Z>>>13,Z&=8191,Z+=F*a+x*(5*g)+v*(5*m)+C*(5*d)+N*(5*f),P+=Z>>>13,Z&=8191;let re=P+D*f+K*p+j*l+z*h+W*u;P=re>>>13,re&=8191,re+=F*c+x*a+v*(5*g)+C*(5*m)+N*(5*d),P+=re>>>13,re&=8191;let pe=P+D*d+K*f+j*p+z*l+W*h;P=pe>>>13,pe&=8191,pe+=F*u+x*c+v*a+C*(5*g)+N*(5*m),P+=pe>>>13,pe&=8191;let ue=P+D*m+K*d+j*f+z*p+W*l;P=ue>>>13,ue&=8191,ue+=F*h+x*u+v*c+C*a+N*(5*g),P+=ue>>>13,ue&=8191;let se=P+D*g+K*m+j*d+z*f+W*p;P=se>>>13,se&=8191,se+=F*l+x*h+v*u+C*c+N*a,P+=se>>>13,se&=8191,P=(P<<2)+P|0,P=P+q|0,q=P&8191,P=P>>>13,$+=P,n[0]=q,n[1]=$,n[2]=H,n[3]=Y,n[4]=J,n[5]=Z,n[6]=re,n[7]=pe,n[8]=ue,n[9]=se}finalize(){let{h:e,pad:t}=this,s=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,s[0]=e[0]+5,i=s[0]>>>13,s[0]&=8191;for(let a=1;a<10;a++)s[a]=e[a]+i,i=s[a]>>>13,s[a]&=8191;s[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)s[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|s[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Zr(s)}update(e){ml(this);let{buffer:t,blockLen:s}=this;e=ra(e);let i=e.length;for(let n=0;n<i;){let o=Math.min(s-this.pos,i-n);if(o===s){for(;s<=i-n;n+=s)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===s&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Zr(this.h,this.r,this.buffer,this.pad)}digestInto(e){ml(this),Tv(e,this),this.finished=!0;let{buffer:t,h:s}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=s[o]>>>0,e[n++]=s[o]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let s=e.slice(0,t);return this.destroy(),s}};function Kv(r){let e=(s,i)=>r(i).update(ra(s)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=s=>r(s),e}var Wv=Kv(r=>new na(r));function Gv(r,e,t,s,i,n=20){let o=r[0],a=r[1],c=r[2],u=r[3],h=e[0],l=e[1],p=e[2],f=e[3],d=e[4],m=e[5],g=e[6],w=e[7],y=i,b=t[0],S=t[1],T=t[2],O=o,A=a,R=c,D=u,K=h,j=l,z=p,W=f,F=d,x=m,v=g,C=w,N=y,P=b,q=S,$=T;for(let Y=0;Y<n;Y+=2)O=O+K|0,N=ie(N^O,16),F=F+N|0,K=ie(K^F,12),O=O+K|0,N=ie(N^O,8),F=F+N|0,K=ie(K^F,7),A=A+j|0,P=ie(P^A,16),x=x+P|0,j=ie(j^x,12),A=A+j|0,P=ie(P^A,8),x=x+P|0,j=ie(j^x,7),R=R+z|0,q=ie(q^R,16),v=v+q|0,z=ie(z^v,12),R=R+z|0,q=ie(q^R,8),v=v+q|0,z=ie(z^v,7),D=D+W|0,$=ie($^D,16),C=C+$|0,W=ie(W^C,12),D=D+W|0,$=ie($^D,8),C=C+$|0,W=ie(W^C,7),O=O+j|0,$=ie($^O,16),v=v+$|0,j=ie(j^v,12),O=O+j|0,$=ie($^O,8),v=v+$|0,j=ie(j^v,7),A=A+z|0,N=ie(N^A,16),C=C+N|0,z=ie(z^C,12),A=A+z|0,N=ie(N^A,8),C=C+N|0,z=ie(z^C,7),R=R+W|0,P=ie(P^R,16),F=F+P|0,W=ie(W^F,12),R=R+W|0,P=ie(P^R,8),F=F+P|0,W=ie(W^F,7),D=D+K|0,q=ie(q^D,16),x=x+q|0,K=ie(K^x,12),D=D+K|0,q=ie(q^D,8),x=x+q|0,K=ie(K^x,7);let H=0;s[H++]=o+O|0,s[H++]=a+A|0,s[H++]=c+R|0,s[H++]=u+D|0,s[H++]=h+K|0,s[H++]=l+j|0,s[H++]=p+z|0,s[H++]=f+W|0,s[H++]=d+F|0,s[H++]=m+x|0,s[H++]=g+v|0,s[H++]=w+C|0,s[H++]=y+N|0,s[H++]=b+P|0,s[H++]=S+q|0,s[H++]=T+$|0}var Yv=Hv(Gv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Jv=new Uint8Array(16),El=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(Jv.subarray(t))},Xv=new Uint8Array(32);function Il(r,e,t,s,i){let n=r(e,t,Xv),o=Wv.create(n);i&&El(o,i),El(o,s);let a=new Uint8Array(16),c=Rv(a);bl(c,0,BigInt(i?i.length:0),!0),bl(c,8,BigInt(s.length),!0),o.update(a);let u=o.digest();return Zr(n,a),u}var Zv=r=>(e,t,s)=>({encrypt(i,n){let o=i.length;n=wl(o+16,n,!1),n.set(i);let a=n.subarray(0,-16);r(e,t,a,a,1);let c=Il(r,e,t,a,s);return n.set(c,o),Zr(c),n},decrypt(i,n){n=wl(i.length-16,n,!1);let o=i.subarray(0,-16),a=i.subarray(-16),c=Il(r,e,t,o,s);if(!Bv(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),r(e,t,n,n,1),Zr(c),n}}),ap=Lv({blockSize:64,nonceLength:12,tagLength:16},Zv(Yv)),zi=class extends Ks{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ba(e);let s=Xr(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,n=new Uint8Array(i);n.set(s.length>i?e.create().update(s).digest():s);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return Jr(this),this.iHash.update(e),this}digestInto(e){Jr(this),ei(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:s,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ji=(r,e,t)=>new zi(r,e).update(t).digest();Ji.create=(r,e)=>new zi(r,e);function Qv(r,e,t){return ba(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Ji(r,Xr(t),Xr(e))}var Ko=new Uint8Array([0]),_l=new Uint8Array;function e0(r,e,t,s=32){if(ba(r),Hs(s),s>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(s/r.outputLen);t===void 0&&(t=_l);let n=new Uint8Array(i*r.outputLen),o=Ji.create(r,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<i;u++)Ko[0]=u+1,a.update(u===0?_l:c).update(t).update(Ko).digestInto(c),n.set(c,r.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ko.fill(0),n.slice(0,s)}var t0=(r,e,t,s,i)=>e0(r,Qv(r,e,t),s,i);function r0(r,e,t,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,s);let i=BigInt(32),n=BigInt(4294967295),o=Number(t>>i&n),a=Number(t&n),c=s?4:0,u=s?0:4;r.setUint32(e+c,o,s),r.setUint32(e+u,a,s)}function s0(r,e,t){return r&e^~r&t}function i0(r,e,t){return r&e^r&t^e&t}var oa=class extends Ks{constructor(e,t,s,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zo(this.buffer)}update(e){Jr(this);let{view:t,buffer:s,blockLen:i}=this;e=Xr(e);let n=e.length;for(let o=0;o<n;){let a=Math.min(i-this.pos,n-o);if(a===i){let c=zo(e);for(;i<=n-o;o+=i)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Jr(this),Gl(e,this),this.finished=!0;let{buffer:t,view:s,blockLen:i,isLE:n}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(s,0),o=0);for(let l=o;l<i;l++)t[l]=0;r0(s,i-8,BigInt(this.length*8),n),this.process(s,0);let a=zo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:s,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%t&&e.buffer.set(s),e}},n0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ir=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),nr=new Uint32Array(64),aa=class extends oa{constructor(){super(64,32,8,!1),this.A=ir[0]|0,this.B=ir[1]|0,this.C=ir[2]|0,this.D=ir[3]|0,this.E=ir[4]|0,this.F=ir[5]|0,this.G=ir[6]|0,this.H=ir[7]|0}get(){let{A:e,B:t,C:s,D:i,E:n,F:o,G:a,H:c}=this;return[e,t,s,i,n,o,a,c]}set(e,t,s,i,n,o,a,c){this.A=e|0,this.B=t|0,this.C=s|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)nr[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let p=nr[l-15],f=nr[l-2],d=Ot(p,7)^Ot(p,18)^p>>>3,m=Ot(f,17)^Ot(f,19)^f>>>10;nr[l]=m+nr[l-7]+d+nr[l-16]|0}let{A:s,B:i,C:n,D:o,E:a,F:c,G:u,H:h}=this;for(let l=0;l<64;l++){let p=Ot(a,6)^Ot(a,11)^Ot(a,25),f=h+p+s0(a,c,u)+n0[l]+nr[l]|0,d=(Ot(s,2)^Ot(s,13)^Ot(s,22))+i0(s,i,n)|0;h=u,u=c,c=a,a=o+f|0,o=n,n=i,i=s,s=f+d|0}s=s+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(s,i,n,o,a,c,u,h)}roundClean(){nr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},si=Yl(()=>new aa);var Xi=BigInt(0),Zi=BigInt(1),o0=BigInt(2);function Sr(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ii(r){if(!Sr(r))throw new Error("Uint8Array expected")}function Qr(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}var a0=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function es(r){ii(r);let e="";for(let t=0;t<r.length;t++)e+=a0[r[t]];return e}function Yr(r){let e=r.toString(16);return e.length&1?"0"+e:e}function xa(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Xi:BigInt("0x"+r)}var Vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Sl(r){if(r>=Vt._0&&r<=Vt._9)return r-Vt._0;if(r>=Vt.A&&r<=Vt.F)return r-(Vt.A-10);if(r>=Vt.a&&r<=Vt.f)return r-(Vt.a-10)}function ts(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let s=new Uint8Array(t);for(let i=0,n=0;i<t;i++,n+=2){let o=Sl(r.charCodeAt(n)),a=Sl(r.charCodeAt(n+1));if(o===void 0||a===void 0){let c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}s[i]=o*16+a}return s}function Ir(r){return xa(es(r))}function Gs(r){return ii(r),xa(es(Uint8Array.from(r).reverse()))}function rs(r,e){return ts(r.toString(16).padStart(e*2,"0"))}function Qi(r,e){return rs(r,e).reverse()}function c0(r){return ts(Yr(r))}function st(r,e,t){let s;if(typeof e=="string")try{s=ts(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(Sr(e))s=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let i=s.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return s}function Ys(...r){let e=0;for(let s=0;s<r.length;s++){let i=r[s];ii(i),e+=i.length}let t=new Uint8Array(e);for(let s=0,i=0;s<r.length;s++){let n=r[s];t.set(n,i),i+=n.length}return t}function u0(r,e){if(r.length!==e.length)return!1;let t=0;for(let s=0;s<r.length;s++)t|=r[s]^e[s];return t===0}function h0(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}var Wo=r=>typeof r=="bigint"&&Xi<=r;function en(r,e,t){return Wo(r)&&Wo(e)&&Wo(t)&&e<=r&&r<t}function Kt(r,e,t,s){if(!en(e,t,s))throw new Error("expected valid "+r+": "+t+" <= n < "+s+", got "+e)}function cp(r){let e;for(e=0;r>Xi;r>>=Zi,e+=1);return e}function l0(r,e){return r>>BigInt(e)&Zi}function p0(r,e,t){return r|(t?Zi:Xi)<<BigInt(e)}var Da=r=>(o0<<BigInt(r-1))-Zi,Go=r=>new Uint8Array(r),xl=r=>Uint8Array.from(r);function up(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let s=Go(r),i=Go(r),n=0,o=()=>{s.fill(1),i.fill(0),n=0},a=(...h)=>t(i,s,...h),c=(h=Go())=>{i=a(xl([0]),h),s=a(),h.length!==0&&(i=a(xl([1]),h),s=a())},u=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,l=[];for(;h<e;){s=a();let p=s.slice();l.push(p),h+=s.length}return Ys(...l)};return(h,l)=>{o(),c(h);let p;for(;!(p=l(u()));)c();return o(),p}}var d0={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Sr(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function ns(r,e,t={}){let s=(i,n,o)=>{let a=d0[n];if(typeof a!="function")throw new Error("invalid validator function");let c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(let[i,n]of Object.entries(e))s(i,n,!1);for(let[i,n]of Object.entries(t))s(i,n,!0);return r}var f0=()=>{throw new Error("not implemented")};function ca(r){let e=new WeakMap;return(t,...s)=>{let i=e.get(t);if(i!==void 0)return i;let n=r(t,...s);return e.set(t,n),n}}var g0=Object.freeze({__proto__:null,isBytes:Sr,abytes:ii,abool:Qr,bytesToHex:es,numberToHexUnpadded:Yr,hexToNumber:xa,hexToBytes:ts,bytesToNumberBE:Ir,bytesToNumberLE:Gs,numberToBytesBE:rs,numberToBytesLE:Qi,numberToVarBytesBE:c0,ensureBytes:st,concatBytes:Ys,equalBytes:u0,utf8ToBytes:h0,inRange:en,aInRange:Kt,bitLen:cp,bitGet:l0,bitSet:p0,bitMask:Da,createHmacDrbg:up,validateObject:ns,notImplemented:f0,memoized:ca}),Ae=BigInt(0),be=BigInt(1),vr=BigInt(2),m0=BigInt(3),ua=BigInt(4),Dl=BigInt(5),Pl=BigInt(8);function Xe(r,e){let t=r%e;return t>=Ae?t:e+t}function hp(r,e,t){if(e<Ae)throw new Error("invalid exponent, negatives unsupported");if(t<=Ae)throw new Error("invalid modulus");if(t===be)return Ae;let s=be;for(;e>Ae;)e&be&&(s=s*r%t),r=r*r%t,e>>=be;return s}function bt(r,e,t){let s=r;for(;e-- >Ae;)s*=s,s%=t;return s}function ha(r,e){if(r===Ae)throw new Error("invert: expected non-zero number");if(e<=Ae)throw new Error("invert: expected positive modulus, got "+e);let t=Xe(r,e),s=e,i=Ae,n=be;for(;t!==Ae;){let o=s/t,a=s%t,c=i-n*o;s=t,t=a,i=n,n=c}if(s!==be)throw new Error("invert: does not exist");return Xe(i,e)}function y0(r){let e=(r-be)/vr,t,s,i;for(t=r-be,s=0;t%vr===Ae;t/=vr,s++);for(i=vr;i<r&&hp(i,e,r)!==r-be;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){let o=(r+be)/ua;return function(a,c){let u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}let n=(t+be)/vr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=s,u=o.pow(o.mul(o.ONE,i),t),h=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let p=1;for(let d=o.sqr(l);p<c&&!o.eql(d,o.ONE);p++)d=o.sqr(d);let f=o.pow(u,be<<BigInt(c-p-1));u=o.sqr(f),h=o.mul(h,f),l=o.mul(l,u),c=p}return h}}function w0(r){if(r%ua===m0){let e=(r+be)/ua;return function(t,s){let i=t.pow(s,e);if(!t.eql(t.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%Pl===Dl){let e=(r-Dl)/Pl;return function(t,s){let i=t.mul(s,vr),n=t.pow(i,e),o=t.mul(s,n),a=t.mul(t.mul(o,vr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),s))throw new Error("Cannot find square root");return c}}return y0(r)}var b0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function v0(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=b0.reduce((s,i)=>(s[i]="function",s),e);return ns(r,t)}function E0(r,e,t){if(t<Ae)throw new Error("invalid exponent, negatives unsupported");if(t===Ae)return r.ONE;if(t===be)return e;let s=r.ONE,i=e;for(;t>Ae;)t&be&&(s=r.mul(s,i)),i=r.sqr(i),t>>=be;return s}function I0(r,e){let t=new Array(e.length),s=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),i=r.inv(s);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),i),t}function lp(r,e){let t=e!==void 0?e:r.toString(2).length,s=Math.ceil(t/8);return{nBitLength:t,nByteLength:s}}function pp(r,e,t=!1,s={}){if(r<=Ae)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:i,nByteLength:n}=lp(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:n,MASK:Da(i),ZERO:Ae,ONE:be,create:c=>Xe(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ae<=c&&c<r},is0:c=>c===Ae,isOdd:c=>(c&be)===be,neg:c=>Xe(-c,r),eql:(c,u)=>c===u,sqr:c=>Xe(c*c,r),add:(c,u)=>Xe(c+u,r),sub:(c,u)=>Xe(c-u,r),mul:(c,u)=>Xe(c*u,r),pow:(c,u)=>E0(a,c,u),div:(c,u)=>Xe(c*ha(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>ha(c,r),sqrt:s.sqrt||(c=>(o||(o=w0(r)),o(a,c))),invertBatch:c=>I0(a,c),cmov:(c,u,h)=>h?u:c,toBytes:c=>t?Qi(c,n):rs(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Gs(c):Ir(c)}});return Object.freeze(a)}function dp(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function fp(r){let e=dp(r);return e+Math.ceil(e/2)}function _0(r,e,t=!1){let s=r.length,i=dp(e),n=fp(e);if(s<16||s<n||s>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+s);let o=t?Gs(r):Ir(r),a=Xe(o,e-be)+be;return t?Qi(a,i):rs(a,i)}var Al=BigInt(0),Vi=BigInt(1);function Yo(r,e){let t=e.negate();return r?t:e}function gp(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Jo(r,e){gp(r,e);let t=Math.ceil(e/r)+1,s=2**(r-1);return{windows:t,windowSize:s}}function S0(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,s)=>{if(!(t instanceof e))throw new Error("invalid point at index "+s)})}function x0(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,s)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+s)})}var Xo=new WeakMap,mp=new WeakMap;function Zo(r){return mp.get(r)||1}function D0(r,e){return{constTimeNegate:Yo,hasPrecomputes(t){return Zo(t)!==1},unsafeLadder(t,s,i=r.ZERO){let n=t;for(;s>Al;)s&Vi&&(i=i.add(n)),n=n.double(),s>>=Vi;return i},precomputeWindow(t,s){let{windows:i,windowSize:n}=Jo(s,e),o=[],a=t,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,s,i){let{windows:n,windowSize:o}=Jo(t,e),a=r.ZERO,c=r.BASE,u=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let p=0;p<n;p++){let f=p*o,d=Number(i&u);i>>=l,d>o&&(d-=h,i+=Vi);let m=f,g=f+Math.abs(d)-1,w=p%2!==0,y=d<0;d===0?c=c.add(Yo(w,s[m])):a=a.add(Yo(y,s[g]))}return{p:a,f:c}},wNAFUnsafe(t,s,i,n=r.ZERO){let{windows:o,windowSize:a}=Jo(t,e),c=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let l=0;l<o;l++){let p=l*a;if(i===Al)break;let f=Number(i&c);if(i>>=h,f>a&&(f-=u,i+=Vi),f===0)continue;let d=s[p+Math.abs(f)-1];f<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(t,s,i){let n=Xo.get(s);return n||(n=this.precomputeWindow(s,t),t!==1&&Xo.set(s,i(n))),n},wNAFCached(t,s,i){let n=Zo(t);return this.wNAF(n,this.getPrecomputes(n,t,i),s)},wNAFCachedUnsafe(t,s,i,n){let o=Zo(t);return o===1?this.unsafeLadder(t,s,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),s,n)},setWindowSize(t,s){gp(s,e),mp.set(t,s),Xo.delete(t)}}}function P0(r,e,t,s){if(S0(t,r),x0(s,e),t.length!==s.length)throw new Error("arrays of points and scalars must have equal length");let i=r.ZERO,n=cp(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o,h=i;for(let l=u;l>=0;l-=o){c.fill(i);for(let f=0;f<s.length;f++){let d=s[f],m=Number(d>>BigInt(l)&BigInt(a));c[m]=c[m].add(t[f])}let p=i;for(let f=c.length-1,d=i;f>0;f--)d=d.add(c[f]),p=p.add(d);if(h=h.add(p),l!==0)for(let f=0;f<o;f++)h=h.double()}return h}function yp(r){return v0(r.Fp),ns(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lp(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);var Gr=BigInt(0),Qo=BigInt(1);function A0(r){return ns(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function O0(r){let e=A0(r),{P:t}=e,s=y=>Xe(y,t),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),c=e.powPminus2||(y=>hp(y,t-BigInt(2),t));function u(y,b,S){let T=s(y*(b-S));return b=s(b-T),S=s(S+T),[b,S]}let h=(e.a-BigInt(2))/BigInt(4);function l(y,b){Kt("u",y,Gr,t),Kt("scalar",b,Gr,t);let S=b,T=y,O=Qo,A=Gr,R=y,D=Qo,K=Gr,j;for(let W=BigInt(i-1);W>=Gr;W--){let F=S>>W&Qo;K^=F,j=u(K,O,R),O=j[0],R=j[1],j=u(K,A,D),A=j[0],D=j[1],K=F;let x=O+A,v=s(x*x),C=O-A,N=s(C*C),P=v-N,q=R+D,$=R-D,H=s($*x),Y=s(q*C),J=H+Y,Z=H-Y;R=s(J*J),D=s(T*s(Z*Z)),O=s(v*N),A=s(P*(v+s(h*P)))}j=u(K,O,R),O=j[0],R=j[1],j=u(K,A,D),A=j[0],D=j[1];let z=c(A);return s(O*z)}function p(y){return Qi(s(y),n)}function f(y){let b=st("u coordinate",y,n);return o===32&&(b[31]&=127),Gs(b)}function d(y){let b=st("scalar",y),S=b.length;if(S!==n&&S!==o){let T=""+n+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+S)}return Gs(a(b))}function m(y,b){let S=f(b),T=d(y),O=l(S,T);if(O===Gr)throw new Error("invalid private or public key received");return p(O)}let g=p(e.Gu);function w(y){return m(y,g)}return{scalarMult:m,scalarMultBase:w,getSharedSecret:(y,b)=>m(y,b),getPublicKey:y=>w(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:g}}var la=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);var C0=BigInt(1),Ol=BigInt(2),T0=BigInt(3),R0=BigInt(5);BigInt(8);function N0(r){let e=BigInt(10),t=BigInt(20),s=BigInt(40),i=BigInt(80),n=la,o=r*r%n*r%n,a=bt(o,Ol,n)*o%n,c=bt(a,C0,n)*r%n,u=bt(c,R0,n)*c%n,h=bt(u,e,n)*u%n,l=bt(h,t,n)*h%n,p=bt(l,s,n)*l%n,f=bt(p,i,n)*p%n,d=bt(f,i,n)*p%n,m=bt(d,e,n)*u%n;return{pow_p_5_8:bt(m,Ol,n)*r%n,b2:o}}function F0(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var pa=O0({P:la,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let e=la,{pow_p_5_8:t,b2:s}=N0(r);return Xe(bt(t,T0,e)*s,e)},adjustScalarBytes:F0,randomBytes:is});function Cl(r){r.lowS!==void 0&&Qr("lowS",r.lowS),r.prehash!==void 0&&Qr("prehash",r.prehash)}function U0(r){let e=yp(r);ns(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:t,Fp:s,a:i}=e;if(t){if(!s.eql(i,s.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:B0,hexToBytes:L0}=g0,da=class extends Error{constructor(e=""){super(e)}},zt={Err:da,_tlv:{encode:(r,e)=>{let{Err:t}=zt;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let s=e.length/2,i=Yr(s);if(i.length/2&128)throw new t("tlv.encode: long form length too big");let n=s>127?Yr(i.length/2|128):"";return Yr(r)+n+i+e},decode(r,e){let{Err:t}=zt,s=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[s++]!==r)throw new t("tlv.decode: wrong tlv");let i=e[s++],n=!!(i&128),o=0;if(!n)o=i;else{let c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let u=e.subarray(s,s+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let h of u)o=o<<8|h;if(s+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(s,s+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(s+o)}}},_int:{encode(r){let{Err:e}=zt;if(r<Ht)throw new e("integer: negative integers are not allowed");let t=Yr(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=zt;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return B0(r)}},toSig(r){let{Err:e,_int:t,_tlv:s}=zt,i=typeof r=="string"?L0(r):r;ii(i);let{v:n,l:o}=s.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=s.decode(2,n),{v:u,l:h}=s.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){let{_tlv:e,_int:t}=zt,s=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),n=s+i;return e.encode(48,n)}},Ht=BigInt(0),Pe=BigInt(1);BigInt(2);var Tl=BigInt(3);BigInt(4);function q0(r){let e=U0(r),{Fp:t}=e,s=pp(e.n,e.nBitLength),i=e.toBytes||((m,g,w)=>{let y=g.toAffine();return Ys(Uint8Array.from([4]),t.toBytes(y.x),t.toBytes(y.y))}),n=e.fromBytes||(m=>{let g=m.subarray(1),w=t.fromBytes(g.subarray(0,t.BYTES)),y=t.fromBytes(g.subarray(t.BYTES,2*t.BYTES));return{x:w,y}});function o(m){let{a:g,b:w}=e,y=t.sqr(m),b=t.mul(y,m);return t.add(t.add(b,t.mul(m,g)),w)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return en(m,Pe,e.n)}function c(m){let{allowedPrivateKeyLengths:g,nByteLength:w,wrapPrivateKey:y,n:b}=e;if(g&&typeof m!="bigint"){if(Sr(m)&&(m=es(m)),typeof m!="string"||!g.includes(m.length))throw new Error("invalid private key");m=m.padStart(w*2,"0")}let S;try{S=typeof m=="bigint"?m:Ir(st("private key",m,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof m)}return y&&(S=Xe(S,b)),Kt("private key",S,Pe,b),S}function u(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}let h=ca((m,g)=>{let{px:w,py:y,pz:b}=m;if(t.eql(b,t.ONE))return{x:w,y};let S=m.is0();g==null&&(g=S?t.ONE:t.inv(b));let T=t.mul(w,g),O=t.mul(y,g),A=t.mul(b,g);if(S)return{x:t.ZERO,y:t.ZERO};if(!t.eql(A,t.ONE))throw new Error("invZ was invalid");return{x:T,y:O}}),l=ca(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}let{x:g,y:w}=m.toAffine();if(!t.isValid(g)||!t.isValid(w))throw new Error("bad point: x or y not FE");let y=t.sqr(w),b=o(g);if(!t.eql(y,b))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(g,w,y){if(this.px=g,this.py=w,this.pz=y,g==null||!t.isValid(g))throw new Error("x required");if(w==null||!t.isValid(w))throw new Error("y required");if(y==null||!t.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(g){let{x:w,y}=g||{};if(!g||!t.isValid(w)||!t.isValid(y))throw new Error("invalid affine point");if(g instanceof p)throw new Error("projective point not allowed");let b=S=>t.eql(S,t.ZERO);return b(w)&&b(y)?p.ZERO:new p(w,y,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){let w=t.invertBatch(g.map(y=>y.pz));return g.map((y,b)=>y.toAffine(w[b])).map(p.fromAffine)}static fromHex(g){let w=p.fromAffine(n(st("pointHex",g)));return w.assertValidity(),w}static fromPrivateKey(g){return p.BASE.multiply(c(g))}static msm(g,w){return P0(p,s,g,w)}_setWindowSize(g){d.setWindowSize(this,g)}assertValidity(){l(this)}hasEvenY(){let{y:g}=this.toAffine();if(t.isOdd)return!t.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);let{px:w,py:y,pz:b}=this,{px:S,py:T,pz:O}=g,A=t.eql(t.mul(w,O),t.mul(S,b)),R=t.eql(t.mul(y,O),t.mul(T,b));return A&&R}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){let{a:g,b:w}=e,y=t.mul(w,Tl),{px:b,py:S,pz:T}=this,O=t.ZERO,A=t.ZERO,R=t.ZERO,D=t.mul(b,b),K=t.mul(S,S),j=t.mul(T,T),z=t.mul(b,S);return z=t.add(z,z),R=t.mul(b,T),R=t.add(R,R),O=t.mul(g,R),A=t.mul(y,j),A=t.add(O,A),O=t.sub(K,A),A=t.add(K,A),A=t.mul(O,A),O=t.mul(z,O),R=t.mul(y,R),j=t.mul(g,j),z=t.sub(D,j),z=t.mul(g,z),z=t.add(z,R),R=t.add(D,D),D=t.add(R,D),D=t.add(D,j),D=t.mul(D,z),A=t.add(A,D),j=t.mul(S,T),j=t.add(j,j),D=t.mul(j,z),O=t.sub(O,D),R=t.mul(j,K),R=t.add(R,R),R=t.add(R,R),new p(O,A,R)}add(g){u(g);let{px:w,py:y,pz:b}=this,{px:S,py:T,pz:O}=g,A=t.ZERO,R=t.ZERO,D=t.ZERO,K=e.a,j=t.mul(e.b,Tl),z=t.mul(w,S),W=t.mul(y,T),F=t.mul(b,O),x=t.add(w,y),v=t.add(S,T);x=t.mul(x,v),v=t.add(z,W),x=t.sub(x,v),v=t.add(w,b);let C=t.add(S,O);return v=t.mul(v,C),C=t.add(z,F),v=t.sub(v,C),C=t.add(y,b),A=t.add(T,O),C=t.mul(C,A),A=t.add(W,F),C=t.sub(C,A),D=t.mul(K,v),A=t.mul(j,F),D=t.add(A,D),A=t.sub(W,D),D=t.add(W,D),R=t.mul(A,D),W=t.add(z,z),W=t.add(W,z),F=t.mul(K,F),v=t.mul(j,v),W=t.add(W,F),F=t.sub(z,F),F=t.mul(K,F),v=t.add(v,F),z=t.mul(W,v),R=t.add(R,z),z=t.mul(C,v),A=t.mul(x,A),A=t.sub(A,z),z=t.mul(x,W),D=t.mul(C,D),D=t.add(D,z),new p(A,R,D)}subtract(g){return this.add(g.negate())}is0(){return this.equals(p.ZERO)}wNAF(g){return d.wNAFCached(this,g,p.normalizeZ)}multiplyUnsafe(g){let{endo:w,n:y}=e;Kt("scalar",g,Ht,y);let b=p.ZERO;if(g===Ht)return b;if(this.is0()||g===Pe)return this;if(!w||d.hasPrecomputes(this))return d.wNAFCachedUnsafe(this,g,p.normalizeZ);let{k1neg:S,k1:T,k2neg:O,k2:A}=w.splitScalar(g),R=b,D=b,K=this;for(;T>Ht||A>Ht;)T&Pe&&(R=R.add(K)),A&Pe&&(D=D.add(K)),K=K.double(),T>>=Pe,A>>=Pe;return S&&(R=R.negate()),O&&(D=D.negate()),D=new p(t.mul(D.px,w.beta),D.py,D.pz),R.add(D)}multiply(g){let{endo:w,n:y}=e;Kt("scalar",g,Pe,y);let b,S;if(w){let{k1neg:T,k1:O,k2neg:A,k2:R}=w.splitScalar(g),{p:D,f:K}=this.wNAF(O),{p:j,f:z}=this.wNAF(R);D=d.constTimeNegate(T,D),j=d.constTimeNegate(A,j),j=new p(t.mul(j.px,w.beta),j.py,j.pz),b=D.add(j),S=K.add(z)}else{let{p:T,f:O}=this.wNAF(g);b=T,S=O}return p.normalizeZ([b,S])[0]}multiplyAndAddUnsafe(g,w,y){let b=p.BASE,S=(O,A)=>A===Ht||A===Pe||!O.equals(b)?O.multiplyUnsafe(A):O.multiply(A),T=S(this,w).add(S(g,y));return T.is0()?void 0:T}toAffine(g){return h(this,g)}isTorsionFree(){let{h:g,isTorsionFree:w}=e;if(g===Pe)return!0;if(w)return w(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:g,clearCofactor:w}=e;return g===Pe?this:w?w(p,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return Qr("isCompressed",g),this.assertValidity(),i(p,this,g)}toHex(g=!0){return Qr("isCompressed",g),es(this.toRawBytes(g))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);let f=e.nBitLength,d=D0(p,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function k0(r){let e=yp(r);return ns(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function j0(r){let e=k0(r),{Fp:t,n:s}=e,i=t.BYTES+1,n=2*t.BYTES+1;function o(F){return Xe(F,s)}function a(F){return ha(F,s)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:l}=q0({...e,toBytes(F,x,v){let C=x.toAffine(),N=t.toBytes(C.x),P=Ys;return Qr("isCompressed",v),v?P(Uint8Array.from([x.hasEvenY()?2:3]),N):P(Uint8Array.from([4]),N,t.toBytes(C.y))},fromBytes(F){let x=F.length,v=F[0],C=F.subarray(1);if(x===i&&(v===2||v===3)){let N=Ir(C);if(!en(N,Pe,t.ORDER))throw new Error("Point is not on curve");let P=h(N),q;try{q=t.sqrt(P)}catch(H){let Y=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+Y)}let $=(q&Pe)===Pe;return(v&1)===1!==$&&(q=t.neg(q)),{x:N,y:q}}else if(x===n&&v===4){let N=t.fromBytes(C.subarray(0,t.BYTES)),P=t.fromBytes(C.subarray(t.BYTES,2*t.BYTES));return{x:N,y:P}}else{let N=i,P=n;throw new Error("invalid Point, expected length of "+N+", or uncompressed "+P+", got "+x)}}}),p=F=>es(rs(F,e.nByteLength));function f(F){let x=s>>Pe;return F>x}function d(F){return f(F)?o(-F):F}let m=(F,x,v)=>Ir(F.slice(x,v));class g{constructor(x,v,C){this.r=x,this.s=v,this.recovery=C,this.assertValidity()}static fromCompact(x){let v=e.nByteLength;return x=st("compactSignature",x,v*2),new g(m(x,0,v),m(x,v,2*v))}static fromDER(x){let{r:v,s:C}=zt.toSig(st("DER",x));return new g(v,C)}assertValidity(){Kt("r",this.r,Pe,s),Kt("s",this.s,Pe,s)}addRecoveryBit(x){return new g(this.r,this.s,x)}recoverPublicKey(x){let{r:v,s:C,recovery:N}=this,P=O(st("msgHash",x));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");let q=N===2||N===3?v+e.n:v;if(q>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");let $=(N&1)===0?"02":"03",H=c.fromHex($+p(q)),Y=a(q),J=o(-P*Y),Z=o(C*Y),re=c.BASE.multiplyAndAddUnsafe(H,J,Z);if(!re)throw new Error("point at infinify");return re.assertValidity(),re}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return ts(this.toDERHex())}toDERHex(){return zt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ts(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}let w={isValidPrivateKey(F){try{return u(F),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let F=fp(e.n);return _0(e.randomBytes(F),e.n)},precompute(F=8,x=c.BASE){return x._setWindowSize(F),x.multiply(BigInt(3)),x}};function y(F,x=!0){return c.fromPrivateKey(F).toRawBytes(x)}function b(F){let x=Sr(F),v=typeof F=="string",C=(x||v)&&F.length;return x?C===i||C===n:v?C===2*i||C===2*n:F instanceof c}function S(F,x,v=!0){if(b(F))throw new Error("first arg must be private key");if(!b(x))throw new Error("second arg must be public key");return c.fromHex(x).multiply(u(F)).toRawBytes(v)}let T=e.bits2int||function(F){if(F.length>8192)throw new Error("input is too large");let x=Ir(F),v=F.length*8-e.nBitLength;return v>0?x>>BigInt(v):x},O=e.bits2int_modN||function(F){return o(T(F))},A=Da(e.nBitLength);function R(F){return Kt("num < 2^"+e.nBitLength,F,Ht,A),rs(F,e.nByteLength)}function D(F,x,v=K){if(["recovered","canonical"].some(ue=>ue in v))throw new Error("sign() legacy options not supported");let{hash:C,randomBytes:N}=e,{lowS:P,prehash:q,extraEntropy:$}=v;P==null&&(P=!0),F=st("msgHash",F),Cl(v),q&&(F=st("prehashed msgHash",C(F)));let H=O(F),Y=u(x),J=[R(Y),R(H)];if($!=null&&$!==!1){let ue=$===!0?N(t.BYTES):$;J.push(st("extraEntropy",ue))}let Z=Ys(...J),re=H;function pe(ue){let se=T(ue);if(!l(se))return;let ke=a(se),Te=c.BASE.multiply(se).toAffine(),Ve=o(Te.x);if(Ve===Ht)return;let ht=o(ke*o(re+Ve*Y));if(ht===Ht)return;let Lt=(Te.x===Ve?0:2)|Number(Te.y&Pe),Cr=ht;return P&&f(ht)&&(Cr=d(ht),Lt^=1),new g(Ve,Cr,Lt)}return{seed:Z,k2sig:pe}}let K={lowS:e.lowS,prehash:!1},j={lowS:e.lowS,prehash:!1};function z(F,x,v=K){let{seed:C,k2sig:N}=D(F,x,v),P=e;return up(P.hash.outputLen,P.nByteLength,P.hmac)(C,N)}c.BASE._setWindowSize(8);function W(F,x,v,C=j){let N=F;x=st("msgHash",x),v=st("publicKey",v);let{lowS:P,prehash:q,format:$}=C;if(Cl(C),"strict"in C)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");let H=typeof N=="string"||Sr(N),Y=!H&&!$&&typeof N=="object"&&N!==null&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!H&&!Y)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let J,Z;try{if(Y&&(J=new g(N.r,N.s)),H){try{$!=="compact"&&(J=g.fromDER(N))}catch(ht){if(!(ht instanceof zt.Err))throw ht}!J&&$!=="der"&&(J=g.fromCompact(N))}Z=c.fromHex(v)}catch{return!1}if(!J||P&&J.hasHighS())return!1;q&&(x=e.hash(x));let{r:re,s:pe}=J,ue=O(x),se=a(pe),ke=o(ue*se),Te=o(re*se),Ve=c.BASE.multiplyAndAddUnsafe(Z,ke,Te)?.toAffine();return Ve?o(Ve.x)===re:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:S,sign:z,verify:W,ProjectivePoint:c,Signature:g,utils:w}}function M0(r){return{hash:r,hmac:(e,...t)=>Ji(r,e,Qb(...t)),randomBytes:is}}function $0(r,e){let t=s=>j0({...r,...M0(s)});return{...t(e),create:t}}var wp=pp(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),V0=wp.create(BigInt("-3")),z0=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),H0=$0({a:V0,b:z0,Fp:wp,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},si),bp="base10",je="base16",nt="base64pad",Zt="base64url",ni="utf8",vp=0,vt=1,os=2,K0=0,Rl=1,zs=12,Pa=32;function Ep(){let r=pa.utils.randomPrivateKey(),e=pa.getPublicKey(r);return{privateKey:Fe(r,je),publicKey:Fe(e,je)}}function tn(){let r=is(Pa);return Fe(r,je)}function Ip(r,e){let t=pa.getSharedSecret(Je(r,je),Je(e,je)),s=t0(si,t,void 0,void 0,Pa);return Fe(s,je)}function as(r){let e=si(Je(r,je));return Fe(e,je)}function pt(r){let e=si(Je(r,ni));return Fe(e,je)}function _p(r){return Je(`${r}`,bp)}function ar(r){return Number(Fe(r,bp))}function Sp(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function xp(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function Dp(r){let e=_p(typeof r.type<"u"?r.type:vp);if(ar(e)===vt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let t=typeof r.senderPublicKey<"u"?Je(r.senderPublicKey,je):void 0,s=typeof r.iv<"u"?Je(r.iv,je):is(zs),i=Je(r.symKey,je),n=ap(i,s).encrypt(Je(r.message,ni)),o=Cp({type:e,sealed:n,iv:s,senderPublicKey:t});return r.encoding===Zt?Sp(o):o}function Pp(r){let e=Je(r.symKey,je),{sealed:t,iv:s}=cs({encoded:r.encoded,encoding:r.encoding}),i=ap(e,s).decrypt(t);if(i===null)throw new Error("Failed to decrypt");return Fe(i,ni)}function Ap(r,e){let t=_p(os),s=is(zs),i=Je(r,ni),n=Cp({type:t,sealed:i,iv:s});return e===Zt?Sp(n):n}function Op(r,e){let{sealed:t}=cs({encoded:r,encoding:e});return Fe(t,ni)}function Cp(r){if(ar(r.type)===os)return Fe(wr([r.type,r.sealed]),nt);if(ar(r.type)===vt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Fe(wr([r.type,r.senderPublicKey,r.iv,r.sealed]),nt)}return Fe(wr([r.type,r.iv,r.sealed]),nt)}function cs(r){let e=(r.encoding||nt)===Zt?xp(r.encoded):r.encoded,t=Je(e,nt),s=t.slice(K0,Rl),i=Rl;if(ar(s)===vt){let c=i+Pa,u=c+zs,h=t.slice(i,c),l=t.slice(c,u),p=t.slice(u);return{type:s,sealed:p,iv:l,senderPublicKey:h}}if(ar(s)===os){let c=t.slice(i),u=is(zs);return{type:s,sealed:c,iv:u}}let n=i+zs,o=t.slice(i,n),a=t.slice(n);return{type:s,sealed:a,iv:o}}function Tp(r,e){let t=cs({encoded:r,encoding:e?.encoding});return Aa({type:ar(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Fe(t.senderPublicKey,je):void 0,receiverPublicKey:e?.receiverPublicKey})}function Aa(r){let e=r?.type||vp;if(e===vt){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function Oa(r){return r.type===vt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Ca(r){return r.type===os}function W0(r){let e=B.from(r.x,"base64"),t=B.from(r.y,"base64");return wr([new Uint8Array([4]),e,t])}function Rp(r,e){let[t,s,i]=r.split("."),n=B.from(xp(i),"base64");if(n.length!==64)throw new Error("Invalid signature length");let o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${s}`,u=si(c),h=W0(e);if(!H0.verify(wr([o,a]),u,h))throw new Error("Invalid signature");return Ls(r).payload}var G0="irn";function oi(r){return r?.relay||{protocol:G0}}function us(r){let e=nl[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function Y0(r,e="-"){let t={},s="relay"+e;return Object.keys(r).forEach(i=>{if(i.startsWith(s)){let n=i.replace(s,""),o=r[i];t[n]=o}}),t}function Ta(r){if(!r.includes("wc:")){let u=Kl(r);u!=null&&u.includes("wc:")&&(r=u)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;let e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,s=r.substring(0,e),i=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((u,h)=>{a[h]=u});let c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:J0(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:Y0(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function J0(r){return r.startsWith("//")?r.substring(2):r}function X0(r,e="-"){let t="relay",s={};return Object.keys(r).forEach(i=>{let n=i,o=t+e+n;r[n]&&(s[o]=r[n])}),s}function Ra(r){let e=new URLSearchParams,t=X0(r.relay);Object.keys(t).sort().forEach(i=>{e.set(i,t[i])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));let s=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${s}`}function ai(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}function hs(r){let e=[];return r.forEach(t=>{let[s,i]=t.split(":");e.push(`${s}:${i}`)}),e}function Z0(r){let e=[];return Object.values(r).forEach(t=>{e.push(...hs(t.accounts))}),e}function Q0(r,e){let t=[];return Object.values(r).forEach(s=>{hs(s.accounts).includes(e)&&t.push(...s.methods)}),t}function eE(r,e){let t=[];return Object.values(r).forEach(s=>{hs(s.accounts).includes(e)&&t.push(...s.events)}),t}function rn(r){return r.includes(":")}function ls(r){return rn(r)?r.split(":")[0]:r}function tE(r){let e={};return r?.forEach(t=>{var s;let[i,n]=t.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(t),(s=e[i].chains)==null||s.push(`${i}:${n}`)}),e}function Na(r,e){e=e.map(s=>s.replace("did:pkh:",""));let t=tE(e);for(let[s,i]of Object.entries(t))i.methods?i.methods=Zs(i.methods,r):i.methods=r,i.events=["chainChanged","accountsChanged"];return t}var rE={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},sE={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function L(r,e){let{message:t,code:s}=sE[r];return{message:e?`${t} ${e}`:t,code:s}}function ce(r,e){let{message:t,code:s}=rE[r];return{message:e?`${t} ${e}`:t,code:s}}function Tt(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function xr(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function _e(r){return typeof r>"u"}function ye(r,e){return e&&_e(r)?!0:typeof r=="string"&&!!r.trim().length}function Fa(r,e){return e&&_e(r)?!0:typeof r=="number"&&!isNaN(r)}function Np(r,e){let{requiredNamespaces:t}=e,s=Object.keys(r.namespaces),i=Object.keys(t),n=!0;return Er(i,s)?(s.forEach(o=>{let{accounts:a,methods:c,events:u}=r.namespaces[o],h=hs(a),l=t[o];(!Er(Bl(o,l),h)||!Er(l.methods,c)||!Er(l.events,u))&&(n=!1)}),n):!1}function Hi(r){return ye(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function iE(r){if(ye(r,!1)&&r.includes(":")){let e=r.split(":");if(e.length===3){let t=e[0]+":"+e[1];return!!e[2]&&Hi(t)}}return!1}function Fp(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ye(r,!1)){if(e(r))return!0;let t=Kl(r);return e(t)}}catch{}return!1}function Up(r){var e;return(e=r?.proposer)==null?void 0:e.publicKey}function Bp(r){return r?.topic}function Lp(r,e){let t=null;return ye(r?.publicKey,!1)||(t=L("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Nl(r){let e=!0;return Tt(r)?r.length&&(e=r.every(t=>ye(t,!1))):e=!1,e}function nE(r,e,t){let s=null;return Tt(e)&&e.length?e.forEach(i=>{s||Hi(i)||(s=ce("UNSUPPORTED_CHAINS",`${t}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Hi(r)||(s=ce("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function oE(r,e,t){let s=null;return Object.entries(r).forEach(([i,n])=>{if(s)return;let o=nE(i,Bl(i,n),`${e} ${t}`);o&&(s=o)}),s}function aE(r,e){let t=null;return Tt(r)?r.forEach(s=>{t||iE(s)||(t=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):t=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function cE(r,e){let t=null;return Object.values(r).forEach(s=>{if(t)return;let i=aE(s?.accounts,`${e} namespace`);i&&(t=i)}),t}function uE(r,e){let t=null;return Nl(r?.methods)?Nl(r?.events)||(t=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function qp(r,e){let t=null;return Object.values(r).forEach(s=>{if(t)return;let i=uE(s,`${e}, namespace`);i&&(t=i)}),t}function kp(r,e,t){let s=null;if(r&&xr(r)){let i=qp(r,e);i&&(s=i);let n=oE(r,e,t);n&&(s=n)}else s=L("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return s}function sn(r,e){let t=null;if(r&&xr(r)){let s=qp(r,e);s&&(t=s);let i=cE(r,e);i&&(t=i)}else t=L("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Ua(r){return ye(r.protocol,!0)}function jp(r,e){let t=!1;return e&&!r?t=!0:r&&Tt(r)&&r.length&&r.forEach(s=>{t=Ua(s)}),t}function Mp(r){return typeof r=="number"}function Me(r){return typeof r<"u"&&typeof r!==null}function $p(r){return!(!r||typeof r!="object"||!r.code||!Fa(r.code,!1)||!r.message||!ye(r.message,!1))}function Vp(r){return!(_e(r)||!ye(r.method,!1))}function zp(r){return!(_e(r)||_e(r.result)&&_e(r.error)||!Fa(r.id,!1)||!ye(r.jsonrpc,!1))}function Hp(r){return!(_e(r)||!ye(r.name,!1))}function Ba(r,e){return!(!Hi(e)||!Z0(r).includes(e))}function Kp(r,e,t){return ye(t,!1)?Q0(r,e).includes(t):!1}function Wp(r,e,t){return ye(t,!1)?eE(r,e).includes(t):!1}function La(r,e,t){let s=null,i=hE(r),n=lE(e),o=Object.keys(i),a=Object.keys(n),c=Fl(Object.keys(r)),u=Fl(Object.keys(e)),h=c.filter(l=>!u.includes(l));return h.length&&(s=L("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),Er(o,a)||(s=L("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||s)return;let p=hs(e[l].accounts);p.includes(l)||(s=L("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${p.toString()}`))}),o.forEach(l=>{s||(Er(i[l].methods,n[l].methods)?Er(i[l].events,n[l].events)||(s=L("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):s=L("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),s}function hE(r){let e={};return Object.keys(r).forEach(t=>{var s;t.includes(":")?e[t]=r[t]:(s=r[t].chains)==null||s.forEach(i=>{e[i]={methods:r[t].methods,events:r[t].events}})}),e}function Fl(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function lE(r){let e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:hs(r[t].accounts)?.forEach(i=>{e[i]={accounts:r[t].accounts.filter(n=>n.includes(`${i}:`)),methods:r[t].methods,events:r[t].events}})}),e}function Gp(r,e){return Fa(r,!1)&&r<=e.max&&r>=e.min}function qa(){let r=Xs();return new Promise(e=>{switch(r){case Ze.browser:e(pE());break;case Ze.reactNative:e(dE());break;case Ze.node:e(fE());break;default:e(!0)}})}function pE(){return ss()&&navigator?.onLine}async function dE(){return Yt()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo?(await globalThis?.NetInfo.fetch())?.isConnected:!0}function fE(){return!0}function Yp(r){switch(Xs()){case Ze.browser:gE(r);break;case Ze.reactNative:mE(r);break;case Ze.node:break}}function gE(r){!Yt()&&ss()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function mE(r){Yt()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&globalThis?.NetInfo.addEventListener(e=>r(e?.isConnected))}var ea={},cr=class{static get(e){return ea[e]}static set(e,t){ea[e]=t}static delete(e){delete ea[e]}};E();_();I();E();_();I();E();_();I();Tr();E();_();I();Tr();var on=Qt(qr());E();_();I();E();_();I();var Et=class{};var ka=class extends Et{constructor(e){super()}},Jp=on.FIVE_SECONDS,Dr={pulse:"heartbeat_pulse"},nn=class r extends ka{constructor(e){super(e),this.events=new We,this.interval=Jp,this.interval=e?.interval||Jp}static async init(e){let t=new r(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,on.toMiliseconds)(this.interval))}pulse(){this.events.emit(Dr.pulse)}};E();_();I();E();_();I();E();_();I();var yE=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,wE=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,bE=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function vE(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){EE(r);return}return e}function EE(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function ci(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);let t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!bE.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(yE.test(r)||wE.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,vE)}return JSON.parse(r)}catch(s){if(e.strict)throw s;return r}}E();_();I();function IE(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function Se(r,...e){try{return IE(r(...e))}catch(t){return Promise.reject(t)}}function _E(r){let e=typeof r;return r===null||e!=="object"&&e!=="function"}function SE(r){let e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function ui(r){if(_E(r))return String(r);if(SE(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return ui(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}var ja="base64:";function Xp(r){return typeof r=="string"?r:ja+DE(r)}function Zp(r){return typeof r!="string"||!r.startsWith(ja)?r:xE(r.slice(ja.length))}function xE(r){return globalThis.Buffer?B.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function DE(r){return globalThis.Buffer?B.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function He(r){return r&&r.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Qp(...r){return He(r.join(":"))}function hi(r){return r=He(r),r?r+":":""}function ed(r,e){if(e===void 0)return!0;let t=0,s=r.indexOf(":");for(;s>-1;)t++,s=r.indexOf(":",s+1);return t<=e}function td(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}var PE="memory",AE=()=>{let r=new Map;return{name:PE,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function id(r={}){let e={mounts:{"":r.driver||AE()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=u=>{for(let h of e.mountpoints)if(u.startsWith(h))return{base:h,relativeKey:u.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:u,driver:e.mounts[""]}},s=(u,h)=>e.mountpoints.filter(l=>l.startsWith(u)||h&&u.startsWith(l)).map(l=>({relativeBase:u.length>l.length?u.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),i=(u,h)=>{if(e.watching){h=He(h);for(let l of e.watchListeners)l(u,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(let u in e.mounts)e.unwatch[u]=await rd(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(let u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,h,l)=>{let p=new Map,f=d=>{let m=p.get(d.base);return m||(m={driver:d.driver,base:d.base,items:[]},p.set(d.base,m)),m};for(let d of u){let m=typeof d=="string",g=He(m?d:d.key),w=m?void 0:d.value,y=m||!d.options?h:{...h,...d.options},b=t(g);f(b).items.push({key:g,value:w,relativeKey:b.relativeKey,options:y})}return Promise.all([...p.values()].map(d=>l(d))).then(d=>d.flat())},c={hasItem(u,h={}){u=He(u);let{relativeKey:l,driver:p}=t(u);return Se(p.hasItem,l,h)},getItem(u,h={}){u=He(u);let{relativeKey:l,driver:p}=t(u);return Se(p.getItem,l,h).then(f=>ci(f))},getItems(u,h={}){return a(u,h,l=>l.driver.getItems?Se(l.driver.getItems,l.items.map(p=>({key:p.relativeKey,options:p.options})),h).then(p=>p.map(f=>({key:Qp(l.base,f.key),value:ci(f.value)}))):Promise.all(l.items.map(p=>Se(l.driver.getItem,p.relativeKey,p.options).then(f=>({key:p.key,value:ci(f)})))))},getItemRaw(u,h={}){u=He(u);let{relativeKey:l,driver:p}=t(u);return p.getItemRaw?Se(p.getItemRaw,l,h):Se(p.getItem,l,h).then(f=>Zp(f))},async setItem(u,h,l={}){if(h===void 0)return c.removeItem(u);u=He(u);let{relativeKey:p,driver:f}=t(u);f.setItem&&(await Se(f.setItem,p,ui(h),l),f.watch||i("update",u))},async setItems(u,h){await a(u,h,async l=>{if(l.driver.setItems)return Se(l.driver.setItems,l.items.map(p=>({key:p.relativeKey,value:ui(p.value),options:p.options})),h);l.driver.setItem&&await Promise.all(l.items.map(p=>Se(l.driver.setItem,p.relativeKey,ui(p.value),p.options)))})},async setItemRaw(u,h,l={}){if(h===void 0)return c.removeItem(u,l);u=He(u);let{relativeKey:p,driver:f}=t(u);if(f.setItemRaw)await Se(f.setItemRaw,p,h,l);else if(f.setItem)await Se(f.setItem,p,Xp(h),l);else return;f.watch||i("update",u)},async removeItem(u,h={}){typeof h=="boolean"&&(h={removeMeta:h}),u=He(u);let{relativeKey:l,driver:p}=t(u);p.removeItem&&(await Se(p.removeItem,l,h),(h.removeMeta||h.removeMata)&&await Se(p.removeItem,l+"$",h),p.watch||i("remove",u))},async getMeta(u,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),u=He(u);let{relativeKey:l,driver:p}=t(u),f=Object.create(null);if(p.getMeta&&Object.assign(f,await Se(p.getMeta,l,h)),!h.nativeOnly){let d=await Se(p.getItem,l+"$",h).then(m=>ci(m));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(f,d))}return f},setMeta(u,h,l={}){return this.setItem(u+"$",h,l)},removeMeta(u,h={}){return this.removeItem(u+"$",h)},async getKeys(u,h={}){u=hi(u);let l=s(u,!0),p=[],f=[],d=!0;for(let g of l){g.driver.flags?.maxDepth||(d=!1);let w=await Se(g.driver.getKeys,g.relativeBase,h);for(let y of w){let b=g.mountpoint+He(y);p.some(S=>b.startsWith(S))||f.push(b)}p=[g.mountpoint,...p.filter(y=>!y.startsWith(g.mountpoint))]}let m=h.maxDepth!==void 0&&!d;return f.filter(g=>(!m||ed(g,h.maxDepth))&&td(g,u))},async clear(u,h={}){u=hi(u),await Promise.all(s(u,!1).map(async l=>{if(l.driver.clear)return Se(l.driver.clear,l.relativeBase,h);if(l.driver.removeItem){let p=await l.driver.getKeys(l.relativeBase||"",h);return Promise.all(p.map(f=>l.driver.removeItem(f,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>sd(u)))},async watch(u){return await n(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,h){if(u=hi(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((l,p)=>p.length-l.length)),e.mounts[u]=h,e.watching&&Promise.resolve(rd(h,i,u)).then(l=>{e.unwatch[u]=l}).catch(console.error),c},async unmount(u,h=!0){u=hi(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),h&&await sd(e.mounts[u]),e.mountpoints=e.mountpoints.filter(l=>l!==u),delete e.mounts[u])},getMount(u=""){u=He(u)+":";let h=t(u);return{driver:h.driver,base:h.base}},getMounts(u="",h={}){return u=He(u),s(u,h.parents).map(p=>({driver:p.driver,base:p.mountpoint}))},keys:(u,h={})=>c.getKeys(u,h),get:(u,h={})=>c.getItem(u,h),set:(u,h,l={})=>c.setItem(u,h,l),has:(u,h={})=>c.hasItem(u,h),del:(u,h={})=>c.removeItem(u,h),remove:(u,h={})=>c.removeItem(u,h)};return c}function rd(r,e,t){return r.watch?r.watch((s,i)=>e(s,t+i)):()=>{}}async function sd(r){typeof r.dispose=="function"&&await Se(r.dispose)}E();_();I();function Pr(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function $a(r,e){let t,s=()=>{if(t)return t;let i=indexedDB.open(r);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=Pr(i),t.then(n=>{n.onclose=()=>t=void 0},()=>{}),t};return(i,n)=>s().then(o=>n(o.transaction(e,i).objectStore(e)))}var Ma;function li(){return Ma||(Ma=$a("keyval-store","keyval")),Ma}function Va(r,e=li()){return e("readonly",t=>Pr(t.get(r)))}function nd(r,e,t=li()){return t("readwrite",s=>(s.put(e,r),Pr(s.transaction)))}function od(r,e=li()){return e("readwrite",t=>(t.delete(r),Pr(t.transaction)))}function ad(r=li()){return r("readwrite",e=>(e.clear(),Pr(e.transaction)))}function OE(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Pr(r.transaction)}function cd(r=li()){return r("readonly",e=>{if(e.getAllKeys)return Pr(e.getAllKeys());let t=[];return OE(e,s=>t.push(s.key)).then(()=>t)})}var CE="idb-keyval",TE=(r={})=>{let e=r.base&&r.base.length>0?`${r.base}:`:"",t=i=>e+i,s;return r.dbName&&r.storeName&&(s=$a(r.dbName,r.storeName)),{name:CE,options:r,async hasItem(i){return!(typeof await Va(t(i),s)>"u")},async getItem(i){return await Va(t(i),s)??null},setItem(i,n){return nd(t(i),n,s)},removeItem(i){return od(t(i),s)},getKeys(){return cd(s)},clear(){return ad(s)}}},RE="WALLET_CONNECT_V2_INDEXED_DB",NE="keyvaluestorage",Ha=class{constructor(){this.indexedDb=id({driver:TE({dbName:RE,storeName:NE})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,qt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}},za=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},an={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,s){this[t]=String(s)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){let t=this;Object.keys(t).forEach(function(s){t[s]=void 0,delete t[s]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof za<"u"&&za.localStorage?an.exports=za.localStorage:typeof window<"u"&&window.localStorage?an.exports=window.localStorage:an.exports=new e})();function FE(r){var e;return[r[0],xt((e=r[1])!=null?e:"")]}var Ka=class{constructor(){this.localStorage=an.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(FE)}async getItem(e){let t=this.localStorage.getItem(e);if(t!==null)return xt(t)}async setItem(e,t){this.localStorage.setItem(e,qt(t))}async removeItem(e){this.localStorage.removeItem(e)}},UE="wc_storage_version",ud=1,BE=async(r,e,t)=>{let s=UE,i=await e.getItem(s);if(i&&i>=ud){t(e);return}let n=await r.getKeys();if(!n.length){t(e);return}let o=[];for(;n.length;){let a=n.shift();if(!a)continue;let c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){let u=await r.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(s,ud),t(e),LE(r,o)},LE=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})},cn=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};let e=new Ka;this.storage=e;try{let t=new Ha;BE(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};E();_();I();Tr();var qE=Object.defineProperty,kE=(r,e,t)=>e in r?qE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hd=(r,e,t)=>kE(r,typeof e!="symbol"?e+"":e,t),un=class extends Et{constructor(e){super(),this.opts=e,hd(this,"protocol","wc"),hd(this,"version",2)}};var jE=Object.defineProperty,ME=(r,e,t)=>e in r?jE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$E=(r,e,t)=>ME(r,typeof e!="symbol"?e+"":e,t),hn=class extends Et{constructor(e,t){super(),this.core=e,this.logger=t,$E(this,"records",new Map)}},ln=class{constructor(e,t){this.logger=e,this.core=t}},pn=class extends Et{constructor(e,t){super(),this.relayer=e,this.logger=t}},dn=class extends Et{constructor(e){super()}},fn=class{constructor(e,t,s,i){this.core=e,this.logger=t,this.name=s}};var gn=class extends Et{constructor(e,t){super(),this.relayer=e,this.logger=t}};var mn=class extends Et{constructor(e,t){super(),this.core=e,this.logger=t}};var yn=class{constructor(e,t,s){this.core=e,this.logger=t,this.store=s}},wn=class{constructor(e,t){this.projectId=e,this.logger=t}},bn=class{constructor(e,t,s){this.core=e,this.logger=t,this.telemetryEnabled=s}},VE=Object.defineProperty,zE=(r,e,t)=>e in r?VE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ld=(r,e,t)=>zE(r,typeof e!="symbol"?e+"":e,t);var vn=class{constructor(e){this.opts=e,ld(this,"protocol","wc"),ld(this,"version",2)}};var En=class{constructor(e){this.client=e}};var G=Qt(qr());E();_();I();Tr();var HE=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:dd(),KE=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",fd=r=>r.split("?")[0],gd=10,WE=HE(),In=class{constructor(e){if(this.url=e,this.events=new We,this.registering=!1,!Ln(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Ln(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((s,i)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),i(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,s)=>{let i=(0,Fr.isReactNative)()?void 0:{rejectUnauthorized:!vu(e)},n=new WE(e,[],i);KE()?n.onerror=o=>{let a=o;s(this.emitError(a.error))}:n.on("error",o=>{s(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let t=typeof e.data=="string"?xt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){let s=this.parseError(t),i=s.message||s.toString(),n=Nr(e,i);this.events.emit("payload",n)}parseError(e,t=this.url){return bu(e,fd(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>gd&&this.events.setMaxListeners(gd)}emitError(e){let t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${fd(this.url)}`));return this.events.emit("register_error",t),t}};var jd=Qt(xi()),Md="wc",$d=2,xn="core",Ft=`${Md}@2:${xn}:`,GE={name:xn,logger:"error"},YE={database:":memory:"},JE="crypto",md="client_ed25519_seed",XE=G.ONE_DAY,ZE="keychain",QE="0.3",e1="messages",t1="0.3",yd=G.SIX_HOURS,r1="publisher",Pc="irn",s1="error",Vd="wss://relay.walletconnect.org",i1="relayer",xe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},n1="_subscription",dt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},o1=.1;var Xa="2.20.2";var ge={link_mode:"link_mode",relay:"relay"},Sn={inbound:"inbound",outbound:"outbound"},a1="0.3",c1="WALLETCONNECT_CLIENT_ID",wd="WALLETCONNECT_LINK_MODE_APPS",at={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var u1="subscription",h1="0.3",XC=G.FIVE_SECONDS*1e3,l1="pairing",p1="0.3";var pi={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},hr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},It={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},d1="history",f1="0.3",g1="expirer",ct={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},m1="0.3";var y1="verify-api",w1="https://verify.walletconnect.com",zd="https://verify.walletconnect.org",ds=zd,b1=`${ds}/v3`,v1=[w1,zd],E1="echo",I1="https://echo.walletconnect.com";var St={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Nt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ft={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},lr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},pr={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},fs={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},_1=.1,S1="event-client",x1=86400,D1="https://pulse.walletconnect.org/batch";function P1(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var i=0;i<r.length;i++){var n=r.charAt(i),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,w=0,y=d.length;w!==y&&d[w]===0;)w++,m++;for(var b=(y-w)*h+1>>>0,S=new Uint8Array(b);w!==y;){for(var T=d[w],O=0,A=b-1;(T!==0||O<g)&&A!==-1;A--,O++)T+=256*S[A]>>>0,S[A]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");g=O,w++}for(var R=b-g;R!==b&&S[R]===0;)R++;for(var D=c.repeat(m);R<b;++R)D+=r.charAt(S[R]);return D}function p(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,w=0;d[m]===c;)g++,m++;for(var y=(d.length-m)*u+1>>>0,b=new Uint8Array(y);d[m];){var S=t[d.charCodeAt(m)];if(S===255)return;for(var T=0,O=y-1;(S!==0||T<w)&&O!==-1;O--,T++)S+=a*b[O]>>>0,b[O]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=T,m++}if(d[m]!==" "){for(var A=y-w;A!==y&&b[A]===0;)A++;for(var R=new Uint8Array(g+(y-A)),D=g;A!==y;)R[D++]=b[A++];return R}}}function f(d){var m=p(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:f}}var A1=P1,O1=A1,Hd=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},C1=r=>new TextEncoder().encode(r),T1=r=>new TextDecoder().decode(r),Za=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Qa=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Kd(this,e)}},ec=class{constructor(e){this.decoders=e}or(e){return Kd(this,e)}decode(e){let t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Kd=(r,e)=>new ec({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),tc=class{constructor(e,t,s,i){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=i,this.encoder=new Za(e,t,s),this.decoder=new Qa(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Dn=({name:r,prefix:e,encode:t,decode:s})=>new tc(r,e,t,s),yi=({prefix:r,name:e,alphabet:t})=>{let{encode:s,decode:i}=O1(t,e);return Dn({prefix:r,name:e,encode:s,decode:n=>Hd(i(n))})},R1=(r,e,t,s)=>{let i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;let o=new Uint8Array(n*t/8|0),a=0,c=0,u=0;for(let h=0;h<n;++h){let l=i[r[h]];if(l===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},N1=(r,e,t)=>{let s=e[e.length-1]==="=",i=(1<<t)-1,n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[i&a>>o];if(o&&(n+=e[i&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},qe=({name:r,prefix:e,bitsPerChar:t,alphabet:s})=>Dn({prefix:e,name:r,encode(i){return N1(i,s,t)},decode(i){return R1(i,s,t,r)}}),F1=Dn({prefix:"\0",name:"identity",encode:r=>T1(r),decode:r=>C1(r)}),U1=Object.freeze({__proto__:null,identity:F1}),B1=qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),L1=Object.freeze({__proto__:null,base2:B1}),q1=qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),k1=Object.freeze({__proto__:null,base8:q1}),j1=yi({prefix:"9",name:"base10",alphabet:"0123456789"}),M1=Object.freeze({__proto__:null,base10:j1}),$1=qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),V1=qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),z1=Object.freeze({__proto__:null,base16:$1,base16upper:V1}),H1=qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),K1=qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),W1=qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),G1=qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Y1=qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),J1=qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),X1=qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Z1=qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Q1=qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),eI=Object.freeze({__proto__:null,base32:H1,base32upper:K1,base32pad:W1,base32padupper:G1,base32hex:Y1,base32hexupper:J1,base32hexpad:X1,base32hexpadupper:Z1,base32z:Q1}),tI=yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rI=yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),sI=Object.freeze({__proto__:null,base36:tI,base36upper:rI}),iI=yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),nI=yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),oI=Object.freeze({__proto__:null,base58btc:iI,base58flickr:nI}),aI=qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),cI=qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uI=qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hI=qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),lI=Object.freeze({__proto__:null,base64:aI,base64pad:cI,base64url:uI,base64urlpad:hI}),Wd=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),pI=Wd.reduce((r,e,t)=>(r[t]=e,r),[]),dI=Wd.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function fI(r){return r.reduce((e,t)=>(e+=pI[t],e),"")}function gI(r){let e=[];for(let t of r){let s=dI[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}var mI=Dn({prefix:"\u{1F680}",name:"base256emoji",encode:fI,decode:gI}),yI=Object.freeze({__proto__:null,base256emoji:mI}),wI=Gd,bd=128,bI=127,vI=~bI,EI=Math.pow(2,31);function Gd(r,e,t){e=e||[],t=t||0;for(var s=t;r>=EI;)e[t++]=r&255|bd,r/=128;for(;r&vI;)e[t++]=r&255|bd,r>>>=7;return e[t]=r|0,Gd.bytes=t-s+1,e}var II=rc,_I=128,vd=127;function rc(r,s){var t=0,s=s||0,i=0,n=s,o,a=r.length;do{if(n>=a)throw rc.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=i<28?(o&vd)<<i:(o&vd)*Math.pow(2,i),i+=7}while(o>=_I);return rc.bytes=n-s,t}var SI=Math.pow(2,7),xI=Math.pow(2,14),DI=Math.pow(2,21),PI=Math.pow(2,28),AI=Math.pow(2,35),OI=Math.pow(2,42),CI=Math.pow(2,49),TI=Math.pow(2,56),RI=Math.pow(2,63),NI=function(r){return r<SI?1:r<xI?2:r<DI?3:r<PI?4:r<AI?5:r<OI?6:r<CI?7:r<TI?8:r<RI?9:10},FI={encode:wI,decode:II,encodingLength:NI},Yd=FI,Ed=(r,e,t=0)=>(Yd.encode(r,e,t),e),Id=r=>Yd.encodingLength(r),sc=(r,e)=>{let t=e.byteLength,s=Id(r),i=s+Id(t),n=new Uint8Array(i+t);return Ed(r,n,0),Ed(t,n,s),n.set(e,i),new ic(r,t,e,n)},ic=class{constructor(e,t,s,i){this.code=e,this.size=t,this.digest=s,this.bytes=i}},Jd=({name:r,code:e,encode:t})=>new nc(r,e,t),nc=class{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?sc(this.code,t):t.then(s=>sc(this.code,s))}else throw Error("Unknown type, must be binary type")}},Xd=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),UI=Jd({name:"sha2-256",code:18,encode:Xd("SHA-256")}),BI=Jd({name:"sha2-512",code:19,encode:Xd("SHA-512")}),LI=Object.freeze({__proto__:null,sha256:UI,sha512:BI}),Zd=0,qI="identity",Qd=Hd,kI=r=>sc(Zd,Qd(r)),jI={code:Zd,name:qI,encode:Qd,digest:kI},MI=Object.freeze({__proto__:null,identity:jI});new TextEncoder,new TextDecoder;var _d={...U1,...L1,...k1,...M1,...z1,...eI,...sI,...oI,...lI,...yI};({...LI,...MI});function $I(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function ef(r,e,t,s){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:s}}}var Sd=ef("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Wa=ef("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=$I(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),VI={utf8:Sd,"utf-8":Sd,hex:_d.base16,latin1:Wa,ascii:Wa,binary:Wa,..._d};function zI(r,e="utf8"){let t=VI[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}var HI=Object.defineProperty,KI=(r,e,t)=>e in r?HI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rt=(r,e,t)=>KI(r,typeof e!="symbol"?e+"":e,t),oc=class{constructor(e,t){this.core=e,this.logger=t,Rt(this,"keychain",new Map),Rt(this,"name",ZE),Rt(this,"version",QE),Rt(this,"initialized",!1),Rt(this,"storagePrefix",Ft),Rt(this,"init",async()=>{if(!this.initialized){let s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}}),Rt(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),Rt(this,"set",async(s,i)=>{this.isInitialized(),this.keychain.set(s,i),await this.persist()}),Rt(this,"get",s=>{this.isInitialized();let i=this.keychain.get(s);if(typeof i>"u"){let{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(n)}return i}),Rt(this,"del",async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()}),this.core=e,this.logger=Re(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ki(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Wi(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},WI=Object.defineProperty,GI=(r,e,t)=>e in r?WI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Be=(r,e,t)=>GI(r,typeof e!="symbol"?e+"":e,t),ac=class{constructor(e,t,s){this.core=e,this.logger=t,Be(this,"name",JE),Be(this,"keychain"),Be(this,"randomSessionIdentifier",tn()),Be(this,"initialized",!1),Be(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Be(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Be(this,"getClientId",async()=>{this.isInitialized();let i=await this.getClientSeed(),n=Io(i);return Eo(n.publicKey)}),Be(this,"generateKeyPair",()=>{this.isInitialized();let i=Ep();return this.setPrivateKey(i.publicKey,i.privateKey)}),Be(this,"signJWT",async i=>{this.isInitialized();let n=await this.getClientSeed(),o=Io(n),a=this.randomSessionIdentifier;return await qh(a,i,XE,o)}),Be(this,"generateSharedKey",(i,n,o)=>{this.isInitialized();let a=this.getPrivateKey(i),c=Ip(a,n);return this.setSymKey(c,o)}),Be(this,"setSymKey",async(i,n)=>{this.isInitialized();let o=n||as(i);return await this.keychain.set(o,i),o}),Be(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Be(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Be(this,"encode",async(i,n,o)=>{this.isInitialized();let a=Aa(o),c=qt(n);if(Ca(a))return Ap(c,o?.encoding);if(Oa(a)){let p=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(p,f)}let u=this.getSymKey(i),{type:h,senderPublicKey:l}=a;return Dp({type:h,symKey:u,message:c,senderPublicKey:l,encoding:o?.encoding})}),Be(this,"decode",async(i,n,o)=>{this.isInitialized();let a=Tp(n,o);if(Ca(a)){let c=Op(n,o?.encoding);return xt(c)}if(Oa(a)){let c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{let c=this.getSymKey(i),u=Pp({symKey:c,encoded:n,encoding:o?.encoding});return xt(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Be(this,"getPayloadType",(i,n=nt)=>{let o=cs({encoded:i,encoding:n});return ar(o.type)}),Be(this,"getPayloadSenderPublicKey",(i,n=nt)=>{let o=cs({encoded:i,encoding:n});return o.senderPublicKey?Fe(o.senderPublicKey,je):void 0}),this.core=e,this.logger=Re(t,this.name),this.keychain=s||new oc(this.core,this.logger)}get context(){return ze(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(md)}catch{e=tn(),await this.keychain.set(md,e)}return zI(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},YI=Object.defineProperty,JI=Object.defineProperties,XI=Object.getOwnPropertyDescriptors,xd=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,QI=Object.prototype.propertyIsEnumerable,cc=(r,e,t)=>e in r?YI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,e_=(r,e)=>{for(var t in e||(e={}))ZI.call(e,t)&&cc(r,t,e[t]);if(xd)for(var t of xd(e))QI.call(e,t)&&cc(r,t,e[t]);return r},t_=(r,e)=>JI(r,XI(e)),ot=(r,e,t)=>cc(r,typeof e!="symbol"?e+"":e,t),uc=class extends ln{constructor(e,t){super(e,t),this.logger=e,this.core=t,ot(this,"messages",new Map),ot(this,"messagesWithoutClientAck",new Map),ot(this,"name",e1),ot(this,"version",t1),ot(this,"initialized",!1),ot(this,"storagePrefix",Ft),ot(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s);let i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}}),ot(this,"set",async(s,i,n)=>{this.isInitialized();let o=pt(i),a=this.messages.get(s);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(s,a),n===Sn.inbound){let c=this.messagesWithoutClientAck.get(s)||{};this.messagesWithoutClientAck.set(s,t_(e_({},c),{[o]:i}))}return await this.persist(),o}),ot(this,"get",s=>{this.isInitialized();let i=this.messages.get(s);return typeof i>"u"&&(i={}),i}),ot(this,"getWithoutAck",s=>{this.isInitialized();let i={};for(let n of s){let o=this.messagesWithoutClientAck.get(n)||{};i[n]=Object.values(o)}return i}),ot(this,"has",(s,i)=>{this.isInitialized();let n=this.get(s),o=pt(i);return typeof n[o]<"u"}),ot(this,"ack",async(s,i)=>{this.isInitialized();let n=this.messagesWithoutClientAck.get(s);if(typeof n>"u")return;let o=pt(i);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(s):this.messagesWithoutClientAck.set(s,n),await this.persist()}),ot(this,"del",async s=>{this.isInitialized(),this.messages.delete(s),this.messagesWithoutClientAck.delete(s),await this.persist()}),this.logger=Re(e,this.name),this.core=t}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ki(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ki(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Wi(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Wi(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},r_=Object.defineProperty,s_=Object.defineProperties,i_=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,o_=Object.prototype.propertyIsEnumerable,hc=(r,e,t)=>e in r?r_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_n=(r,e)=>{for(var t in e||(e={}))n_.call(e,t)&&hc(r,t,e[t]);if(Dd)for(var t of Dd(e))o_.call(e,t)&&hc(r,t,e[t]);return r},Ga=(r,e)=>s_(r,i_(e)),_t=(r,e,t)=>hc(r,typeof e!="symbol"?e+"":e,t),lc=class extends pn{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,_t(this,"events",new We),_t(this,"name",r1),_t(this,"queue",new Map),_t(this,"publishTimeout",(0,G.toMiliseconds)(G.ONE_MINUTE)),_t(this,"initialPublishTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),_t(this,"needsTransportRestart",!1),_t(this,"publish",async(s,i,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:i,opts:n}});let a=n?.ttl||yd,c=oi(n),u=n?.prompt||!1,h=n?.tag||0,l=n?.id||er().toString(),p={topic:s,message:i,opts:{ttl:a,relay:c,prompt:u,tag:h,id:l,attestation:n?.attestation,tvf:n?.tvf}},f=`Failed to publish payload, please try again. id:${l} tag:${h}`;try{let d=new Promise(async m=>{let g=({id:y})=>{p.opts.id===y&&(this.removeRequestFromQueue(y),this.relayer.events.removeListener(xe.publish,g),m(p))};this.relayer.events.on(xe.publish,g);let w=Xt(new Promise((y,b)=>{this.rpcPublish({topic:s,message:i,ttl:a,prompt:u,tag:h,id:l,attestation:n?.attestation,tvf:n?.tvf}).then(y).catch(S=>{this.logger.warn(S,S?.message),b(S)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${h}`);try{await w,this.events.removeListener(xe.publish,g)}catch(y){this.queue.set(l,Ga(_n({},p),{attempt:1})),this.logger.warn(y,y?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:s,message:i,opts:n}}),await Xt(d,this.publishTimeout,f)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw d}finally{this.queue.delete(l)}}),_t(this,"on",(s,i)=>{this.events.on(s,i)}),_t(this,"once",(s,i)=>{this.events.once(s,i)}),_t(this,"off",(s,i)=>{this.events.off(s,i)}),_t(this,"removeListener",(s,i)=>{this.events.removeListener(s,i)}),this.relayer=e,this.logger=Re(t,this.name),this.registerEventListeners()}get context(){return ze(this.logger)}async rpcPublish(e){var t,s,i,n;let{topic:o,message:a,ttl:c=yd,prompt:u,tag:h,id:l,attestation:p,tvf:f}=e,d={method:us(oi().protocol).publish,params:_n({topic:o,message:a,ttl:c,prompt:u,tag:h,attestation:p},f),id:l};_e((t=d.params)==null?void 0:t.prompt)&&((s=d.params)==null||delete s.prompt),_e((i=d.params)==null?void 0:i.tag)&&((n=d.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d});let m=await this.relayer.request(d);return this.relayer.events.emit(xe.publish,e),this.logger.debug("Successfully Published Payload"),m}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{let s=e.attempt+1;this.queue.set(t,Ga(_n({},e),{attempt:s}));let{topic:i,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${s}`),await this.rpcPublish(Ga(_n({},e),{topic:i,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(xe.connection_stalled);return}this.checkQueue()}),this.relayer.on(xe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},a_=Object.defineProperty,c_=(r,e,t)=>e in r?a_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ps=(r,e,t)=>c_(r,typeof e!="symbol"?e+"":e,t),pc=class{constructor(){ps(this,"map",new Map),ps(this,"set",(e,t)=>{let s=this.get(e);this.exists(e,t)||this.map.set(e,[...s,t])}),ps(this,"get",e=>this.map.get(e)||[]),ps(this,"exists",(e,t)=>this.get(e).includes(t)),ps(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let s=this.get(e);if(!this.exists(e,t))return;let i=s.filter(n=>n!==t);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),ps(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},u_=Object.defineProperty,h_=Object.defineProperties,l_=Object.getOwnPropertyDescriptors,Pd=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,dc=(r,e,t)=>e in r?u_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,di=(r,e)=>{for(var t in e||(e={}))p_.call(e,t)&&dc(r,t,e[t]);if(Pd)for(var t of Pd(e))d_.call(e,t)&&dc(r,t,e[t]);return r},Ya=(r,e)=>h_(r,l_(e)),he=(r,e,t)=>dc(r,typeof e!="symbol"?e+"":e,t),fc=class extends gn{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,he(this,"subscriptions",new Map),he(this,"topicMap",new pc),he(this,"events",new We),he(this,"name",u1),he(this,"version",h1),he(this,"pending",new Map),he(this,"cached",[]),he(this,"initialized",!1),he(this,"storagePrefix",Ft),he(this,"subscribeTimeout",(0,G.toMiliseconds)(G.ONE_MINUTE)),he(this,"initialSubscribeTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),he(this,"clientId"),he(this,"batchSubscribeTopicsLimit",500),he(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),he(this,"subscribe",async(s,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:i}});try{let n=oi(i),o={topic:s,relay:n,transportType:i?.transportType};this.pending.set(s,o);let a=await this.rpcSubscribe(s,n,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:i}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),he(this,"unsubscribe",async(s,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(s,i.id,i):await this.unsubscribeByTopic(s,i)}),he(this,"isSubscribed",s=>new Promise(i=>{i(this.topicMap.topics.includes(s))})),he(this,"isKnownTopic",s=>new Promise(i=>{i(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(n=>n.topic===s))})),he(this,"on",(s,i)=>{this.events.on(s,i)}),he(this,"once",(s,i)=>{this.events.once(s,i)}),he(this,"off",(s,i)=>{this.events.off(s,i)}),he(this,"removeListener",(s,i)=>{this.events.removeListener(s,i)}),he(this,"start",async()=>{await this.onConnect()}),he(this,"stop",async()=>{await this.onDisconnect()}),he(this,"restart",async()=>{await this.restore(),await this.onRestart()}),he(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let s=[];this.pending.forEach(i=>{s.push(i)}),await this.batchSubscribe(s)}),he(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Dr.pulse,async()=>{await this.checkPending()}),this.events.on(at.created,async s=>{let i=at.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:s}),await this.persist()}),this.events.on(at.deleted,async s=>{let i=at.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:s}),await this.persist()})}),this.relayer=e,this.logger=Re(t,this.name),this.clientId=""}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let s=!1;try{s=this.getSubscription(e).topic===t}catch{}return s}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let s=this.topicMap.get(e);await Promise.all(s.map(async i=>await this.unsubscribeById(e,i,t)))}async unsubscribeById(e,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}});try{let i=oi(s);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);let n=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,t,s){var i;(!s||s?.transportType===ge.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});let n={method:us(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let o=(i=s?.internal)==null?void 0:i.throwOnFailedPublish;try{let a=await this.getSubscriptionId(e);if(s?.transportType===ge.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},(0,G.toMiliseconds)(G.ONE_SECOND)),a;let c=new Promise(async h=>{let l=p=>{p.topic===e&&(this.events.removeListener(at.created,l),h(p.id))};this.events.on(at.created,l);try{let p=await Xt(new Promise((f,d)=>{this.relayer.request(n).catch(m=>{this.logger.warn(m,m?.message),d(m)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(at.created,l),h(p)}catch{}}),u=await Xt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(xe.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t=e[0].relay,s={method:us(t.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Xt(new Promise(i=>{this.relayer.request(s).catch(n=>this.logger.warn(n)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(xe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let t=e[0].relay,s={method:us(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let i;try{i=await await Xt(new Promise((n,o)=>{this.relayer.request(s).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(xe.connection_stalled)}return i}rpcUnsubscribe(e,t,s){let i={method:us(s.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,Ya(di({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,di({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,di({},t)),this.topicMap.set(t.topic,e),this.events.emit(at.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:s}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(at.deleted,Ya(di({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(at.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<t;s++){let i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(at.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){let{message:t}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>Ya(di({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Wl((0,G.toMiliseconds)(G.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return pt(e+await this.getClientId())}},f_=Object.defineProperty,Ad=Object.getOwnPropertySymbols,g_=Object.prototype.hasOwnProperty,m_=Object.prototype.propertyIsEnumerable,gc=(r,e,t)=>e in r?f_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Od=(r,e)=>{for(var t in e||(e={}))g_.call(e,t)&&gc(r,t,e[t]);if(Ad)for(var t of Ad(e))m_.call(e,t)&&gc(r,t,e[t]);return r},oe=(r,e,t)=>gc(r,typeof e!="symbol"?e+"":e,t),mc=class extends dn{constructor(e){super(e),oe(this,"protocol","wc"),oe(this,"version",2),oe(this,"core"),oe(this,"logger"),oe(this,"events",new We),oe(this,"provider"),oe(this,"messages"),oe(this,"subscriber"),oe(this,"publisher"),oe(this,"name",i1),oe(this,"transportExplicitlyClosed",!1),oe(this,"initialized",!1),oe(this,"connectionAttemptInProgress",!1),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"packageName"),oe(this,"bundleId"),oe(this,"hasExperiencedNetworkDisruption",!1),oe(this,"pingTimeout"),oe(this,"heartBeatTimeout",(0,G.toMiliseconds)(G.THIRTY_SECONDS+G.FIVE_SECONDS)),oe(this,"reconnectTimeout"),oe(this,"connectPromise"),oe(this,"reconnectInProgress",!1),oe(this,"requestsInFlight",[]),oe(this,"connectTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),oe(this,"request",async t=>{var s,i;this.logger.debug("Publishing Request Payload");let n=t.id||er().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(s=t.params)==null?void 0:s.topic},"relayer.request - publishing...");let o=`${n}:${((i=t.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);let a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),oe(this,"resetPingTimeout",()=>{Js()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,s,i,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(i=(s=(t=this.provider)==null?void 0:t.connection)==null?void 0:s.socket)==null?void 0:i.terminate)==null||n.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),oe(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),oe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(xe.connect)}),oe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),oe(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(xe.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),oe(this,"registerProviderListeners",()=>{this.provider.on(dt.payload,this.onPayloadHandler),this.provider.on(dt.connect,this.onConnectHandler),this.provider.on(dt.disconnect,this.onDisconnectHandler),this.provider.on(dt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Re(e.logger,this.name):(0,Rr.default)(fr({level:e.logger||s1})),this.messages=new uc(this.logger,e.core),this.subscriber=new fc(this,this.logger),this.publisher=new lc(this,this.logger),this.relayUrl=e?.relayUrl||Vd,this.projectId=e.projectId,Ll()?this.packageName=fa():ql()&&(this.bundleId=fa()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return ze(this.logger)}get connected(){var e,t,s;return((s=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:s.readyState)===1||!1}get connecting(){var e,t,s;return((s=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:s.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,s){this.isInitialized(),await this.publisher.publish(e,t,s),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ge.relay},Sn.outbound)}async subscribe(e,t){var s,i,n;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((s=t?.internal)==null?void 0:s.throwOnFailedPublish)>"u"?!0:(i=t?.internal)==null?void 0:i.throwOnFailedPublish,a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c,u=h=>{h.topic===e&&(this.subscriber.off(at.created,u),c())};return await Promise.all([new Promise(h=>{c=h,this.subscriber.on(at.created,u)}),new Promise(async(h,l)=>{a=await this.subscriber.subscribe(e,Od({internal:{throwOnFailedPublish:o}},t)).catch(p=>{o&&l(p)})||a,h()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Xt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,s)=>{await this.connect(e).then(t).catch(s).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await qa())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let t=e.sort((s,i)=>s.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(let s of t)try{await this.onMessageEvent(s)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:s}=e;if(!t.sessionExists){let i=ve(G.FIVE_MINUTES),n={topic:s,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(s,n)}this.events.emit(xe.message,e),await this.recordMessageEvent(e,Sn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(s,i)=>{let n=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(dt.disconnect,n),await Xt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(dt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(dt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(dt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){await this.subscriber.stop();let i=s;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(s=>setTimeout(s,(0,G.toMiliseconds)(t*1))),t++}}startPingTimeout(){var e,t,s,i,n;if(Js())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(i=(s=this.provider)==null?void 0:s.connection)==null?void 0:i.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ge(new In(jl({sdkVersion:Xa,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:s,message:i}=e;await this.messages.set(s,i,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:s}=e;if(!s||s.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let i=this.messages.has(t,s);return i&&this.logger.warn(`Ignoring duplicate message: ${s}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Os(e)){if(!e.method.endsWith(n1))return;let t=e.params,{topic:s,message:i,publishedAt:n,attestation:o}=t.data,a={topic:s,message:i,publishedAt:n,transportType:ge.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Od({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Cs(e)&&this.events.emit(xe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Sn.inbound),this.events.emit(xe.message,e))}async acknowledgePayload(e){let t=gr(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(dt.payload,this.onPayloadHandler),this.provider.off(dt.connect,this.onConnectHandler),this.provider.off(dt.disconnect,this.onDisconnectHandler),this.provider.off(dt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await qa();Yp(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(s=>this.logger.error(s,s?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(xe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,G.toMiliseconds)(o1)))))}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function y_(){}function Cd(r){if(!r||typeof r!="object")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function Td(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Rd(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}var w_="[object RegExp]",b_="[object String]",v_="[object Number]",E_="[object Boolean]",Nd="[object Arguments]",I_="[object Symbol]",__="[object Date]",S_="[object Map]",x_="[object Set]",D_="[object Array]",P_="[object Function]",A_="[object ArrayBuffer]",Ja="[object Object]",O_="[object Error]",C_="[object DataView]",T_="[object Uint8Array]",R_="[object Uint8ClampedArray]",N_="[object Uint16Array]",F_="[object Uint32Array]",U_="[object BigUint64Array]",B_="[object Int8Array]",L_="[object Int16Array]",q_="[object Int32Array]",k_="[object BigInt64Array]",j_="[object Float32Array]",M_="[object Float64Array]";function $_(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function V_(r,e,t){return gi(r,e,void 0,void 0,void 0,void 0,t)}function gi(r,e,t,s,i,n,o){let a=o(r,e,t,s,i,n);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return mi(r,e,n,o)}return mi(r,e,n,o)}function mi(r,e,t,s){if(Object.is(r,e))return!0;let i=Rd(r),n=Rd(e);if(i===Nd&&(i=Ja),n===Nd&&(n=Ja),i!==n)return!1;switch(i){case b_:return r.toString()===e.toString();case v_:{let c=r.valueOf(),u=e.valueOf();return $_(c,u)}case E_:case __:case I_:return Object.is(r.valueOf(),e.valueOf());case w_:return r.source===e.source&&r.flags===e.flags;case P_:return r===e}t=t??new Map;let o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(i){case S_:{if(r.size!==e.size)return!1;for(let[c,u]of r.entries())if(!e.has(c)||!gi(u,e.get(c),c,r,e,t,s))return!1;return!0}case x_:{if(r.size!==e.size)return!1;let c=Array.from(r.values()),u=Array.from(e.values());for(let h=0;h<c.length;h++){let l=c[h],p=u.findIndex(f=>gi(l,f,void 0,r,e,t,s));if(p===-1)return!1;u.splice(p,1)}return!0}case D_:case T_:case R_:case N_:case F_:case U_:case B_:case L_:case q_:case k_:case j_:case M_:{if(typeof B<"u"&&B.isBuffer(r)!==B.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!gi(r[c],e[c],c,r,e,t,s))return!1;return!0}case A_:return r.byteLength!==e.byteLength?!1:mi(new Uint8Array(r),new Uint8Array(e),t,s);case C_:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:mi(new Uint8Array(r),new Uint8Array(e),t,s);case O_:return r.name===e.name&&r.message===e.message;case Ja:{if(!(mi(r.constructor,e.constructor,t,s)||Cd(r)&&Cd(e)))return!1;let c=[...Object.keys(r),...Td(r)],u=[...Object.keys(e),...Td(e)];if(c.length!==u.length)return!1;for(let h=0;h<c.length;h++){let l=c[h],p=r[l];if(!Object.hasOwn(e,l))return!1;let f=e[l];if(!gi(p,f,l,r,e,t,s))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function z_(r,e){return V_(r,e,y_)}var H_=Object.defineProperty,Fd=Object.getOwnPropertySymbols,K_=Object.prototype.hasOwnProperty,W_=Object.prototype.propertyIsEnumerable,yc=(r,e,t)=>e in r?H_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ud=(r,e)=>{for(var t in e||(e={}))K_.call(e,t)&&yc(r,t,e[t]);if(Fd)for(var t of Fd(e))W_.call(e,t)&&yc(r,t,e[t]);return r},Qe=(r,e,t)=>yc(r,typeof e!="symbol"?e+"":e,t),Ut=class extends fn{constructor(e,t,s,i=Ft,n=void 0){super(e,t,s,i),this.core=e,this.logger=t,this.name=s,Qe(this,"map",new Map),Qe(this,"version",a1),Qe(this,"cached",[]),Qe(this,"initialized",!1),Qe(this,"getKey"),Qe(this,"storagePrefix",Ft),Qe(this,"recentlyDeleted",[]),Qe(this,"recentlyDeletedLimit",200),Qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!_e(o)?this.map.set(this.getKey(o),o):Up(o)?this.map.set(o.id,o):Bp(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Qe(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Qe(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Qe(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>z_(a[c],o[c]))):this.values)),Qe(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=Ud(Ud({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Qe(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Re(t,this.name),this.storagePrefix=i,this.getKey=n}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:i}=L("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}let{message:s}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:t}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},G_=Object.defineProperty,Y_=(r,e,t)=>e in r?G_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ee=(r,e,t)=>Y_(r,typeof e!="symbol"?e+"":e,t),wc=class{constructor(e,t){this.core=e,this.logger=t,ee(this,"name",l1),ee(this,"version",p1),ee(this,"events",new dr),ee(this,"pairings"),ee(this,"initialized",!1),ee(this,"storagePrefix",Ft),ee(this,"ignoredPayloadTypes",[vt]),ee(this,"registeredMethods",[]),ee(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ee(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),ee(this,"create",async s=>{this.isInitialized();let i=tn(),n=await this.core.crypto.setSymKey(i),o=ve(G.FIVE_MINUTES),a={protocol:Pc},c={topic:n,expiry:o,relay:a,active:!1,methods:s?.methods},u=Ra({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:o,methods:s?.methods});return this.events.emit(hr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:s?.transportType}),{topic:n,uri:u}}),ee(this,"pair",async s=>{this.isInitialized();let i=this.core.eventClient.createEvent({properties:{topic:s?.uri,trace:[St.pairing_started]}});this.isValidPair(s,i);let{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Ta(s.uri);i.props.properties.topic=n,i.addTrace(St.pairing_uri_validation_success),i.addTrace(St.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),i.addTrace(St.existing_pairing),h.active)throw i.setError(Nt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);i.addTrace(St.pairing_not_expired)}let l=c||ve(G.FIVE_MINUTES),p={topic:n,relay:a,expiry:l,active:!1,methods:u};this.core.expirer.set(n,l),await this.pairings.set(n,p),i.addTrace(St.store_new_pairing),s.activatePairing&&await this.activate({topic:n}),this.events.emit(hr.create,p),i.addTrace(St.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),i.addTrace(St.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Nt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw i.setError(Nt.subscribe_pairing_topic_failure),f}return i.addTrace(St.subscribe_pairing_topic_success),p}),ee(this,"activate",async({topic:s})=>{this.isInitialized();let i=ve(G.FIVE_MINUTES);this.core.expirer.set(s,i),await this.pairings.update(s,{active:!0,expiry:i})}),ee(this,"ping",async s=>{this.isInitialized(),await this.isValidPing(s),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:i}=s;if(this.pairings.keys.includes(i)){let n=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Jt();this.events.once(ne("pairing_ping",n),({error:u})=>{u?c(u):a()}),await o()}}),ee(this,"updateExpiry",async({topic:s,expiry:i})=>{this.isInitialized(),await this.pairings.update(s,{expiry:i})}),ee(this,"updateMetadata",async({topic:s,metadata:i})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:i})}),ee(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ee(this,"disconnect",async s=>{this.isInitialized(),await this.isValidDisconnect(s);let{topic:i}=s;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(i))}),ee(this,"formatUriFromPairing",s=>{this.isInitialized();let{topic:i,relay:n,expiry:o,methods:a}=s,c=this.core.crypto.keychain.get(i);return Ra({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),ee(this,"sendRequest",async(s,i,n)=>{let o=Dt(i,n),a=await this.core.crypto.encode(s,o),c=pi[i].req;return this.core.history.set(s,o),this.core.relayer.publish(s,a,c),o.id}),ee(this,"sendResult",async(s,i,n)=>{let o=gr(s,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,s)).request.method,u=pi[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),ee(this,"sendError",async(s,i,n)=>{let o=Nr(s,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,s)).request.method,u=pi[c]?pi[c].res:pi.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),ee(this,"deletePairing",async(s,i)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),i?Promise.resolve():this.core.expirer.del(s)])}),ee(this,"cleanup",async()=>{let s=this.pairings.getAll().filter(i=>Ct(i.expiry));await Promise.all(s.map(i=>this.deletePairing(i.topic)))}),ee(this,"onRelayEventRequest",async s=>{let{topic:i,payload:n}=s;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,n);default:return await this.onUnknownRpcMethodRequest(i,n)}}),ee(this,"onRelayEventResponse",async s=>{let{topic:i,payload:n}=s,o=(await this.core.history.get(i,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,n);default:return this.onUnknownRpcMethodResponse(o)}}),ee(this,"onPairingPingRequest",async(s,i)=>{let{id:n}=i;try{this.isValidPing({topic:s}),await this.sendResult(n,s,!0),this.events.emit(hr.ping,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),ee(this,"onPairingPingResponse",(s,i)=>{let{id:n}=i;setTimeout(()=>{yt(i)?this.events.emit(ne("pairing_ping",n),{}):lt(i)&&this.events.emit(ne("pairing_ping",n),{error:i.error})},500)}),ee(this,"onPairingDeleteRequest",async(s,i)=>{let{id:n}=i;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(hr.delete,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),ee(this,"onUnknownRpcMethodRequest",async(s,i)=>{let{id:n,method:o}=i;try{if(this.registeredMethods.includes(o))return;let a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,s,a),this.logger.error(a)}catch(a){await this.sendError(n,s,a),this.logger.error(a)}}),ee(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",s))}),ee(this,"isValidPair",(s,i)=>{var n;if(!Me(s)){let{message:a}=L("MISSING_OR_INVALID",`pair() params: ${s}`);throw i.setError(Nt.malformed_pairing_uri),new Error(a)}if(!Fp(s.uri)){let{message:a}=L("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw i.setError(Nt.malformed_pairing_uri),new Error(a)}let o=Ta(s?.uri);if(!((n=o?.relay)!=null&&n.protocol)){let{message:a}=L("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Nt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=L("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Nt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,G.toMiliseconds)(o?.expiryTimestamp)<Date.now()){i.setError(Nt.pairing_expired);let{message:a}=L("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ee(this,"isValidPing",async s=>{if(!Me(s)){let{message:n}=L("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(n)}let{topic:i}=s;await this.isValidPairingTopic(i)}),ee(this,"isValidDisconnect",async s=>{if(!Me(s)){let{message:n}=L("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(n)}let{topic:i}=s;await this.isValidPairingTopic(i)}),ee(this,"isValidPairingTopic",async s=>{if(!ye(s,!1)){let{message:i}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(i)}if(!this.pairings.keys.includes(s)){let{message:i}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(i)}if(Ct(this.pairings.get(s).expiry)){await this.deletePairing(s);let{message:i}=L("EXPIRED",`pairing topic: ${s}`);throw new Error(i)}}),this.core=e,this.logger=Re(t,this.name),this.pairings=new Ut(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ze(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(xe.message,async e=>{let{topic:t,message:s,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==ge.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))try{let n=await this.core.crypto.decode(t,s);Os(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Cs(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,s)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(ct.expired,async e=>{let{topic:t}=Gi(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(hr.expire,{topic:t}))})}},J_=Object.defineProperty,X_=(r,e,t)=>e in r?J_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Le=(r,e,t)=>X_(r,typeof e!="symbol"?e+"":e,t),bc=class extends hn{constructor(e,t){super(e,t),this.core=e,this.logger=t,Le(this,"records",new Map),Le(this,"events",new We),Le(this,"name",d1),Le(this,"version",f1),Le(this,"cached",[]),Le(this,"initialized",!1),Le(this,"storagePrefix",Ft),Le(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Le(this,"set",(s,i,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:i,chainId:n}),this.records.has(i.id))return;let o={id:i.id,topic:s,request:{method:i.method,params:i.params||null},chainId:n,expiry:ve(G.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(It.created,o)}),Le(this,"resolve",async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;let i=await this.getRecord(s.id);typeof i.response>"u"&&(i.response=lt(s)?{error:s.error}:{result:s.result},this.records.set(i.id,i),this.persist(),this.events.emit(It.updated,i))}),Le(this,"get",async(s,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:i}),await this.getRecord(i))),Le(this,"delete",(s,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(n=>{if(n.topic===s){if(typeof i<"u"&&n.id!==i)return;this.records.delete(n.id),this.events.emit(It.deleted,n)}}),this.persist()}),Le(this,"exists",async(s,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===s:!1)),Le(this,"on",(s,i)=>{this.events.on(s,i)}),Le(this,"once",(s,i)=>{this.events.once(s,i)}),Le(this,"off",(s,i)=>{this.events.off(s,i)}),Le(this,"removeListener",(s,i)=>{this.events.removeListener(s,i)}),this.logger=Re(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;let s={topic:t.topic,request:Dt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:s}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(It.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:t}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(It.created,e=>{let t=It.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(It.updated,e=>{let t=It.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(It.deleted,e=>{let t=It.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Dr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,G.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(It.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},Z_=Object.defineProperty,Q_=(r,e,t)=>e in r?Z_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e,t)=>Q_(r,typeof e!="symbol"?e+"":e,t),vc=class extends mn{constructor(e,t){super(e,t),this.core=e,this.logger=t,$e(this,"expirations",new Map),$e(this,"events",new We),$e(this,"name",g1),$e(this,"version",m1),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"storagePrefix",Ft),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),$e(this,"has",s=>{try{let i=this.formatTarget(s);return typeof this.getExpiration(i)<"u"}catch{return!1}}),$e(this,"set",(s,i)=>{this.isInitialized();let n=this.formatTarget(s),o={target:n,expiry:i};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(ct.created,{target:n,expiration:o})}),$e(this,"get",s=>{this.isInitialized();let i=this.formatTarget(s);return this.getExpiration(i)}),$e(this,"del",s=>{if(this.isInitialized(),this.has(s)){let i=this.formatTarget(s),n=this.getExpiration(i);this.expirations.delete(i),this.events.emit(ct.deleted,{target:i,expiration:n})}}),$e(this,"on",(s,i)=>{this.events.on(s,i)}),$e(this,"once",(s,i)=>{this.events.once(s,i)}),$e(this,"off",(s,i)=>{this.events.off(s,i)}),$e(this,"removeListener",(s,i)=>{this.events.removeListener(s,i)}),this.logger=Re(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return $l(e);if(typeof e=="number")return Vl(e);let{message:t}=L("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ct.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:t}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:s}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(s),new Error(s)}return t}checkExpiry(e,t){let{expiry:s}=t;(0,G.toMiliseconds)(s)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(ct.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Dr.pulse,()=>this.checkExpirations()),this.events.on(ct.created,e=>{let t=ct.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(ct.expired,e=>{let t=ct.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(ct.deleted,e=>{let t=ct.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}},eS=Object.defineProperty,tS=(r,e,t)=>e in r?eS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ee=(r,e,t)=>tS(r,typeof e!="symbol"?e+"":e,t),Ec=class extends yn{constructor(e,t,s){super(e,t,s),this.core=e,this.logger=t,this.store=s,Ee(this,"name",y1),Ee(this,"abortController"),Ee(this,"isDevEnv"),Ee(this,"verifyUrlV3",b1),Ee(this,"storagePrefix",Ft),Ee(this,"version",$d),Ee(this,"publicKey"),Ee(this,"fetchPromise"),Ee(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,G.toMiliseconds)((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ee(this,"register",async i=>{if(!ss()||this.isDevEnv)return;let n=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{let u=(0,jd.getDocument)(),h=this.startAbortTimer(G.ONE_SECOND*5),l=await new Promise((p,f)=>{let d=()=>{window.removeEventListener("message",g),u.body.removeChild(m),f("attestation aborted")};this.abortController.signal.addEventListener("abort",d);let m=u.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",d,{signal:this.abortController.signal});let g=w=>{if(w.data&&typeof w.data=="string")try{let y=JSON.parse(w.data);if(y.type==="verify_attestation"){if(Ls(y.attestation).payload.id!==o)return;clearInterval(h),u.body.removeChild(m),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",g),p(y.attestation===null?"":y.attestation)}}catch(y){this.logger.warn(y)}};u.body.appendChild(m),window.addEventListener("message",g,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(u){this.logger.warn(u)}return""}),Ee(this,"resolve",async i=>{if(this.isDevEnv)return"";let{attestationId:n,hash:o,encryptedId:a}=i;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Ls(n).payload.id!==a)return;let u=await this.isValidJwtAttestation(n);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;let c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),Ee(this,"fetchAttestation",async(i,n)=>{this.logger.debug(`resolving attestation: ${i} from url: ${n}`);let o=this.startAbortTimer(G.ONE_SECOND*5),a=await fetch(`${n}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ee(this,"getVerifyUrl",i=>{let n=i||ds;return v1.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${ds}`),n=ds),n}),Ee(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let i=this.startAbortTimer(G.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await n.json()}catch(i){this.logger.warn(i)}}),Ee(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Ee(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ee(this,"isValidJwtAttestation",async i=>{let n=await this.getPublicKey();try{if(n)return this.validateAttestation(i,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ee(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ee(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});let i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Ee(this,"validateAttestation",(i,n)=>{let o=Rp(i,n.publicKey),a={hasExpired:(0,G.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Re(t,this.name),this.abortController=new AbortController,this.isDevEnv=Qs(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ze(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,G.toMiliseconds)(e))}},rS=Object.defineProperty,sS=(r,e,t)=>e in r?rS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Bd=(r,e,t)=>sS(r,typeof e!="symbol"?e+"":e,t),Ic=class extends wn{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Bd(this,"context",E1),Bd(this,"registerDeviceToken",async s=>{let{clientId:i,token:n,notificationType:o,enableEncrypted:a=!1}=s,c=`${I1}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:n,always_raw:a})})}),this.logger=Re(t,this.context)}},iS=Object.defineProperty,Ld=Object.getOwnPropertySymbols,nS=Object.prototype.hasOwnProperty,oS=Object.prototype.propertyIsEnumerable,_c=(r,e,t)=>e in r?iS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fi=(r,e)=>{for(var t in e||(e={}))nS.call(e,t)&&_c(r,t,e[t]);if(Ld)for(var t of Ld(e))oS.call(e,t)&&_c(r,t,e[t]);return r},Oe=(r,e,t)=>_c(r,typeof e!="symbol"?e+"":e,t),Sc=class extends bn{constructor(e,t,s=!0){super(e,t,s),this.core=e,this.logger=t,Oe(this,"context",S1),Oe(this,"storagePrefix",Ft),Oe(this,"storageVersion",_1),Oe(this,"events",new Map),Oe(this,"shouldPersist",!1),Oe(this,"init",async()=>{if(!Qs())try{let i={eventId:wa(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ma(this.core.relayer.protocol,this.core.relayer.version,Xa)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Oe(this,"createEvent",i=>{let{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=wa(),h=this.core.projectId||"",l=Date.now(),p=fi({eventId:u,timestamp:l,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:h,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,p),this.shouldPersist=!0),p}),Oe(this,"getEvent",i=>{let{eventId:n,topic:o}=i;if(n)return this.events.get(n);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return fi(fi({},a),this.setMethods(a.eventId))}),Oe(this,"deleteEvent",i=>{let{eventId:n}=i;this.events.delete(n),this.shouldPersist=!0}),Oe(this,"setEventListeners",()=>{this.core.heartbeat.on(Dr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{(0,G.fromMiliseconds)(Date.now())-(0,G.fromMiliseconds)(i.timestamp)>x1&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Oe(this,"setMethods",i=>({addTrace:n=>this.addTrace(i,n),setError:n=>this.setError(i,n)})),Oe(this,"addTrace",(i,n)=>{let o=this.events.get(i);o&&(o.props.properties.trace.push(n),this.events.set(i,o),this.shouldPersist=!0)}),Oe(this,"setError",(i,n)=>{let o=this.events.get(i);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Oe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Oe(this,"restore",async()=>{try{let i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(n=>{this.events.set(n.eventId,fi(fi({},n),this.setMethods(n.eventId)))})}catch(i){this.logger.warn(i)}}),Oe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let i=[];for(let[n,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(let n of i)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Oe(this,"sendEvent",async i=>{let n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${D1}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Xa}${n}`,{method:"POST",body:JSON.stringify(i)})}),Oe(this,"getAppDomain",()=>ga().url),this.logger=Re(t,this.context),this.telemetryEnabled=s,s?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},aS=Object.defineProperty,qd=Object.getOwnPropertySymbols,cS=Object.prototype.hasOwnProperty,uS=Object.prototype.propertyIsEnumerable,xc=(r,e,t)=>e in r?aS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kd=(r,e)=>{for(var t in e||(e={}))cS.call(e,t)&&xc(r,t,e[t]);if(qd)for(var t of qd(e))uS.call(e,t)&&xc(r,t,e[t]);return r},fe=(r,e,t)=>xc(r,typeof e!="symbol"?e+"":e,t),Dc=class r extends un{constructor(e){var t;super(e),fe(this,"protocol",Md),fe(this,"version",$d),fe(this,"name",xn),fe(this,"relayUrl"),fe(this,"projectId"),fe(this,"customStoragePrefix"),fe(this,"events",new We),fe(this,"logger"),fe(this,"heartbeat"),fe(this,"relayer"),fe(this,"crypto"),fe(this,"storage"),fe(this,"history"),fe(this,"expirer"),fe(this,"pairing"),fe(this,"verify"),fe(this,"echoClient"),fe(this,"linkModeSupportedApps"),fe(this,"eventClient"),fe(this,"initialized",!1),fe(this,"logChunkController"),fe(this,"on",(a,c)=>this.events.on(a,c)),fe(this,"once",(a,c)=>this.events.once(a,c)),fe(this,"off",(a,c)=>this.events.off(a,c)),fe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),fe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;let h={topic:a,message:c,publishedAt:Date.now(),transportType:ge.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:u})});let s=this.getGlobalCore(e?.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Vd,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let i=fr({level:typeof e?.logger=="string"&&e.logger?e.logger:GE.logger,name:xn}),{logger:n,chunkLoggerController:o}=gu({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Re(n,this.name),this.heartbeat=new nn,this.crypto=new ac(this,this.logger,e?.keychain),this.history=new bc(this,this.logger),this.expirer=new vc(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new cn(kd(kd({},YE),e?.storageOptions)),this.relayer=new mc({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wc(this,this.logger),this.verify=new Ec(this,this.logger,this.storage),this.echoClient=new Ic(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Sc(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new r(e);await t.initialize();let s=await t.crypto.getClientId();return await t.storage.setItem(c1,s),t}get context(){return ze(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(wd,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(wd)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,s=`${t}_count`;return globalThis[s]=(globalThis[s]||0)+1,globalThis[s]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[s]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let s=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[s]=e}catch(s){console.warn("Failed to set global WalletConnect core",s)}}isGlobalCoreDisabled(){try{return typeof k<"u"&&k.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},tf=Dc;var Q=Qt(qr());Tr();var af="wc",cf=2,uf="client",jc=`${af}@${cf}:${uf}:`,Ac={name:uf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var rf="WALLETCONNECT_DEEPLINK_CHOICE";var hS="proposal";var sf="Proposal expired",lS="session",gs=Q.SEVEN_DAYS,pS="engine",Ce={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Q.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Q.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1119}}},Oc={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},Bt={idle:"IDLE",active:"ACTIVE"},nf={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},dS="request",fS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],gS="wc";var mS="auth",yS="authKeys",wS="pairingTopics",bS="requests",On=`${gS}@${1.5}:${mS}:`,Pn=`${On}:PUB_KEY`,vS=Object.defineProperty,ES=Object.defineProperties,IS=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,_S=Object.prototype.hasOwnProperty,SS=Object.prototype.propertyIsEnumerable,Tc=(r,e,t)=>e in r?vS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,le=(r,e)=>{for(var t in e||(e={}))_S.call(e,t)&&Tc(r,t,e[t]);if(of)for(var t of of(e))SS.call(e,t)&&Tc(r,t,e[t]);return r},Ke=(r,e)=>ES(r,IS(e)),U=(r,e,t)=>Tc(r,typeof e!="symbol"?e+"":e,t),Rc=class extends En{constructor(e){super(e),U(this,"name",pS),U(this,"events",new dr),U(this,"initialized",!1),U(this,"requestQueue",{state:Bt.idle,queue:[]}),U(this,"sessionRequestQueue",{state:Bt.idle,queue:[]}),U(this,"requestQueueDelay",Q.ONE_SECOND),U(this,"expectedPairingMethodMap",new Map),U(this,"recentlyDeletedMap",new Map),U(this,"recentlyDeletedLimit",200),U(this,"relayMessageCache",[]),U(this,"pendingSessions",new Map),U(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ce)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,Q.toMiliseconds)(this.requestQueueDelay)))}),U(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let s=Ke(le({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s);let{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=s,h=i,l,p=!1;try{if(h){let O=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),p=O.active}}catch(O){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),O}if(!h||!p){let{topic:O,uri:A}=await this.client.core.pairing.create();h=O,l=A}if(!h){let{message:O}=L("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(O)}let f=await this.client.core.crypto.generateKeyPair(),d=Ce.wc_sessionPropose.req.ttl||Q.FIVE_MINUTES,m=ve(d),g=Ke(le(le({requiredNamespaces:n,optionalNamespaces:o,relays:u??[{protocol:Pc}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:h},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:kt()}),w=ne("session_connect",g.id),{reject:y,resolve:b,done:S}=Jt(d,sf),T=({id:O})=>{O===g.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(g.id),this.events.emit(w,{error:{message:sf,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(w,({error:O,session:A})=>{this.client.events.off("proposal_expire",T),O?y(O):A&&b(A)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0,clientRpcId:g.id}),await this.setProposal(g.id,g),{uri:l,approval:S}}),U(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(s){throw this.client.logger.error("pair() failed"),s}}),U(this,"approve",async t=>{var s,i,n;let o=this.client.core.eventClient.createEvent({properties:{topic:(s=t?.id)==null?void 0:s.toString(),trace:[ft.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(D){throw o.setError(lr.no_internet_connection),D}try{await this.isValidProposalId(t?.id)}catch(D){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(lr.proposal_not_found),D}try{await this.isValidApprove(t)}catch(D){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(lr.session_approve_namespace_validation_failure),D}let{id:a,relayProtocol:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:p}=t,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:d,proposer:m,requiredNamespaces:g,optionalNamespaces:w}=f,y=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:d});y||(y=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:ft.session_approve_started,properties:{topic:d,trace:[ft.session_approve_started,ft.session_namespaces_validation_success]}}));let b=await this.client.core.crypto.generateKeyPair(),S=m.publicKey,T=await this.client.core.crypto.generateSharedKey(b,S),O=le(le(le({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:b,metadata:this.client.metadata},expiry:ve(gs)},h&&{sessionProperties:h}),l&&{scopedProperties:l}),p&&{sessionConfig:p}),A=ge.relay;y.addTrace(ft.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:A})}catch(D){throw y.setError(lr.subscribe_session_topic_failure),D}y.addTrace(ft.subscribe_session_topic_success);let R=Ke(le({},O),{topic:T,requiredNamespaces:g,optionalNamespaces:w,pairingTopic:d,acknowledged:!1,self:O.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:b,transportType:ge.relay});await this.client.session.set(T,R),y.addTrace(ft.store_session);try{y.addTrace(ft.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:O,throwOnFailedPublish:!0}).catch(D=>{throw y?.setError(lr.session_settle_publish_failure),D}),y.addTrace(ft.session_settle_publish_success),y.addTrace(ft.publishing_session_approve),await this.sendResult({id:a,topic:d,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(D=>{throw y?.setError(lr.session_approve_publish_failure),D}),y.addTrace(ft.session_approve_publish_success)}catch(D){throw this.client.logger.error(D),this.client.session.delete(T,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),D}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:m.metadata}),await this.client.proposal.delete(a,ce("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(T,ve(gs)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),U(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:s,reason:i}=t,n;try{n=this.client.proposal.get(s).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${s}) failed`),o}n&&(await this.sendError({id:s,topic:n,error:i,rpcOpts:Ce.wc_sessionPropose.reject}),await this.client.proposal.delete(s,ce("USER_DISCONNECTED")))}),U(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}let{topic:s,namespaces:i}=t,{done:n,resolve:o,reject:a}=Jt(),c=kt(),u=er().toString(),h=this.client.session.get(s).namespaces;return this.events.once(ne("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(s,{namespaces:i}),await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(l=>{this.client.logger.error(l),this.client.session.update(s,{namespaces:h}),a(l)}),{acknowledged:n}}),U(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:s}=t,i=kt(),{done:n,resolve:o,reject:a}=Jt();return this.events.once(ne("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(s,ve(gs)),this.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),U(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}let{chainId:s,request:i,topic:n,expiry:o=Ce.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);a?.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let c=kt(),u=er().toString(),{done:h,resolve:l,reject:p}=Jt(o,"Request expired. Please try again.");this.events.once(ne("session_request",c),({error:w,result:y})=>{w?p(w):l(y)});let f="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:n,method:f,params:{request:Ke(le({},i),{expiryTimestamp:ve(o)}),chainId:s},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(w=>p(w)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:s,id:c}),await h();let m={request:Ke(le({},i),{expiryTimestamp:ve(o)}),chainId:s},g=this.shouldSetTVF(f,m);return await Promise.all([new Promise(async w=>{await this.sendRequest(le({clientRpcId:c,relayRpcId:u,topic:n,method:f,params:m,expiry:o,throwOnFailedPublish:!0},g&&{tvf:this.getTVFParams(c,m)})).catch(y=>p(y)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:s,id:c}),w()}),new Promise(async w=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){let b=await Hl(this.client.core.storage,rf);await zl({id:c,topic:n,wcDeepLink:b})}w()}),h()]).then(w=>w[2])}),U(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);let{topic:s,response:i}=t,{id:n}=i,o=this.client.session.get(s);o.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);yt(i)?await this.sendResult({id:n,topic:s,result:i.result,throwOnFailedPublish:!0,appLink:a}):lt(i)&&await this.sendError({id:n,topic:s,error:i.error,appLink:a}),this.cleanupAfterResponse(t)}),U(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}let{topic:s}=t;if(this.client.session.keys.includes(s)){let i=kt(),n=er().toString(),{done:o,resolve:a,reject:c}=Jt();this.events.once(ne("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(s)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:s}))}),U(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);let{topic:s,event:i,chainId:n}=t,o=er().toString(),a=kt();await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:i,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),U(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);let{topic:s}=t;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{let{message:i}=L("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(i)}}),U(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(s=>Np(s,t)))),U(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),U(this,"authenticate",async(t,s)=>{var i;this.isInitialized(),this.isValidAuthenticate(t);let n=s&&this.client.core.linkModeSupportedApps.includes(s)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=n?ge.link_mode:ge.relay;o===ge.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:u,domain:h,nonce:l,type:p,exp:f,nbf:d,methods:m=[],expiry:g}=t,w=[...t.resources||[]],{topic:y,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:b}});let S=await this.client.core.crypto.generateKeyPair(),T=as(S);if(await Promise.all([this.client.auth.authKeys.set(Pn,{responseTopic:T,publicKey:S}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:y})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${y}`),m.length>0){let{namespace:P}=ur(a[0]),q=rp(P,"request",m);ri(w)&&(q=sp(q,w.pop())),w.push(q)}let O=g&&g>Ce.wc_sessionAuthenticate.req.ttl?g:Ce.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:p??"caip122",chains:a,statement:c,aud:u,domain:h,version:"1",nonce:l,iat:new Date().toISOString(),exp:f,nbf:d,resources:w},requester:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:ve(O)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},D={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:ve(Ce.wc_sessionPropose.req.ttl),id:kt()},{done:K,resolve:j,reject:z}=Jt(O,"Request expired"),W=kt(),F=ne("session_connect",D.id),x=ne("session_request",W),v=async({error:P,session:q})=>{this.events.off(x,C),P?z(P):q&&j({session:q})},C=async P=>{var q,$,H;if(await this.deletePendingAuthRequest(W,{message:"fulfilled",code:0}),P.error){let se=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return P.error.code===se.code?void 0:(this.events.off(F,v),z(P.error.message))}await this.deleteProposal(D.id),this.events.off(F,v);let{cacaos:Y,responder:J}=P.result,Z=[],re=[];for(let se of Y){await Ea({cacao:se,projectId:this.client.core.projectId})||(this.client.logger.error(se,"Signature verification failed"),z(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:ke}=se,Te=ri(ke.resources),Ve=[Yi(ke.iss)],ht=ti(ke.iss);if(Te){let Lt=_a(Te),Cr=Sa(Te);Z.push(...Lt),Ve.push(...Cr)}for(let Lt of Ve)re.push(`${Lt}:${ht}`)}let pe=await this.client.core.crypto.generateSharedKey(S,J.publicKey),ue;Z.length>0&&(ue={topic:pe,acknowledged:!0,self:{publicKey:S,metadata:this.client.metadata},peer:J,controller:J.publicKey,expiry:ve(gs),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:Na([...new Set(Z)],[...new Set(re)]),transportType:o},await this.client.core.relayer.subscribe(pe,{transportType:o}),await this.client.session.set(pe,ue),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:J.metadata}),ue=this.client.session.get(pe)),(q=this.client.metadata.redirect)!=null&&q.linkMode&&($=J.metadata.redirect)!=null&&$.linkMode&&(H=J.metadata.redirect)!=null&&H.universal&&s&&(this.client.core.addLinkModeSupportedApp(J.metadata.redirect.universal),this.client.session.update(pe,{transportType:ge.link_mode})),j({auths:Y,session:ue})};this.events.once(F,v),this.events.once(x,C);let N;try{if(n){let P=Dt("wc_sessionAuthenticate",A,W);this.client.core.history.set(y,P);let q=await this.client.core.crypto.encode("",P,{type:os,encoding:Zt});N=ai(s,y,q)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:A,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:W}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:D,expiry:Ce.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:D.id})])}catch(P){throw this.events.off(F,v),this.events.off(x,C),P}return await this.setProposal(D.id,D),await this.setAuthRequest(W,{request:Ke(le({},A),{verifyContext:{}}),pairingTopic:y,transportType:o}),{uri:N??b,response:K}}),U(this,"approveSessionAuthenticate",async t=>{let{id:s,auths:i}=t,n=this.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:[pr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(g){throw n.setError(fs.no_internet_connection),g}let o=this.getPendingAuthRequest(s);if(!o)throw n.setError(fs.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${s}`);let a=o.transportType||ge.relay;a===ge.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),h=as(c),l={type:vt,receiverPublicKey:c,senderPublicKey:u},p=[],f=[];for(let g of i){if(!await Ea({cacao:g,projectId:this.client.core.projectId})){n.setError(fs.invalid_cacao);let T=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:s,topic:h,error:T,encodeOpts:l}),new Error(T.message)}n.addTrace(pr.cacaos_verified);let{p:w}=g,y=ri(w.resources),b=[Yi(w.iss)],S=ti(w.iss);if(y){let T=_a(y),O=Sa(y);p.push(...T),b.push(...O)}for(let T of b)f.push(`${T}:${S}`)}let d=await this.client.core.crypto.generateSharedKey(u,c);n.addTrace(pr.create_authenticated_session_topic);let m;if(p?.length>0){m={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:ve(gs),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Na([...new Set(p)],[...new Set(f)]),transportType:a},n.addTrace(pr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(g){throw n.setError(fs.subscribe_authenticated_session_topic_failure),g}n.addTrace(pr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,m),n.addTrace(pr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(pr.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:s,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(g){throw n.setError(fs.authenticated_session_approve_publish_failure),g}return await this.client.auth.requests.delete(s,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:m}}),U(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();let{id:s,reason:i}=t,n=this.getPendingAuthRequest(s);if(!n)throw new Error(`Could not find pending auth request with id ${s}`);n.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=as(o),u={type:vt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:s,topic:c,error:i,encodeOpts:u,rpcOpts:Ce.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(s,{message:"rejected",code:0}),await this.client.proposal.delete(s,ce("USER_DISCONNECTED"))}),U(this,"formatAuthMessage",t=>{this.isInitialized();let{request:s,iss:i}=t;return Ia(s,i)}),U(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),U(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{let s=this.client.core.pairing.pairings.get(t.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==s.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}}),U(this,"deleteSession",async t=>{var s;let{topic:i,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(rf).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,ce("USER_DISCONNECTED"))}),i===((s=this.sessionRequestQueue.queue[0])==null?void 0:s.topic)&&(this.sessionRequestQueue.state=Bt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),U(this,"deleteProposal",async(t,s)=>{if(s)try{let i=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:i.pairingTopic})?.setError(lr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,ce("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),U(this,"deletePendingSessionRequest",async(t,s,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),i&&(this.sessionRequestQueue.state=Bt.idle,this.client.events.emit("session_request_expire",{id:t}))}),U(this,"deletePendingAuthRequest",async(t,s,i=!1)=>{await Promise.all([this.client.auth.requests.delete(t,s),i?Promise.resolve():this.client.core.expirer.del(t)])}),U(this,"setExpiry",async(t,s)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,s),await this.client.session.update(t,{expiry:s}))}),U(this,"setProposal",async(t,s)=>{this.client.core.expirer.set(t,ve(Ce.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,s)}),U(this,"setAuthRequest",async(t,s)=>{let{request:i,pairingTopic:n,transportType:o=ge.relay}=s;this.client.core.expirer.set(t,i.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:t,pairingTopic:n,verifyContext:i.verifyContext,transportType:o})}),U(this,"setPendingSessionRequest",async t=>{let{id:s,topic:i,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||ve(Ce.wc_sessionRequest.req.ttl);this.client.core.expirer.set(s,a),await this.client.pendingRequest.set(s,{id:s,topic:i,params:n,verifyContext:o})}),U(this,"sendRequest",async t=>{let{topic:s,method:i,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:h,tvf:l}=t,p=Dt(i,n,c),f,d=!!h;try{let w=d?Zt:nt;f=await this.client.core.crypto.encode(s,p,{encoding:w})}catch(w){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),w}let m;if(fS.includes(i)){let w=pt(JSON.stringify(p)),y=pt(f);m=await this.client.core.verify.register({id:y,decryptedId:w})}let g=Ce[i].req;if(g.attestation=m,o&&(g.ttl=o),a&&(g.id=a),this.client.core.history.set(s,p),d){let w=ai(h,s,f);await globalThis.Linking.openURL(w,this.client.name)}else{let w=Ce[i].req;o&&(w.ttl=o),a&&(w.id=a),w.tvf=Ke(le({},l),{correlationId:p.id}),u?(w.internal=Ke(le({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,f,w)):this.client.core.relayer.publish(s,f,w).catch(y=>this.client.logger.error(y))}return p.id}),U(this,"sendResult",async t=>{let{id:s,topic:i,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,u=gr(s,n),h,l=c&&typeof globalThis?.Linking<"u";try{let d=l?Zt:nt;h=await this.client.core.crypto.encode(i,u,Ke(le({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),d}let p,f;try{p=await this.client.core.history.get(i,s);let d=p.request;try{this.shouldSetTVF(d.method,d.params)&&(f=this.getTVFParams(s,d.params,n))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${s}) failed`),d}if(l){let d=ai(c,i,h);await globalThis.Linking.openURL(d,this.client.name)}else{let d=p.request.method,m=Ce[d].res;m.tvf=Ke(le({},f),{correlationId:s}),o?(m.internal=Ke(le({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,h,m)):this.client.core.relayer.publish(i,h,m).catch(g=>this.client.logger.error(g))}await this.client.core.history.resolve(u)}),U(this,"sendError",async t=>{let{id:s,topic:i,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,u=Nr(s,n),h,l=c&&typeof globalThis?.Linking<"u";try{let f=l?Zt:nt;h=await this.client.core.crypto.encode(i,u,Ke(le({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let p;try{p=await this.client.core.history.get(i,s)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${s}) failed`),f}if(l){let f=ai(c,i,h);await globalThis.Linking.openURL(f,this.client.name)}else{let f=p.request.method,d=a||Ce[f].res;this.client.core.relayer.publish(i,h,d)}await this.client.core.history.resolve(u)}),U(this,"cleanup",async()=>{let t=[],s=[];this.client.session.getAll().forEach(i=>{let n=!1;Ct(i.expiry)&&(n=!0),this.client.core.crypto.keychain.has(i.topic)||(n=!0),n&&t.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{Ct(i.expiryTimestamp)&&s.push(i.id)}),await Promise.all([...t.map(i=>this.deleteSession({topic:i})),...s.map(i=>this.deleteProposal(i))])}),U(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),U(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),U(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Bt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Bt.active;let t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Bt.idle}),U(this,"processRequest",async t=>{let{topic:s,payload:i,attestation:n,transportType:o,encryptedId:a}=t,c=i.method;if(!this.shouldIgnorePairingRequest({topic:s,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:s,payload:i,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(s,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(s,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(s,i);case"wc_sessionPing":return await this.onSessionPingRequest(s,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(s,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:s,payload:i,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(s,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:s,payload:i,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),U(this,"onRelayEventResponse",async t=>{let{topic:s,payload:i,transportType:n}=t,o=(await this.client.core.history.get(s,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(s,i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(s,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,i);case"wc_sessionExtend":return this.onSessionExtendResponse(s,i);case"wc_sessionPing":return this.onSessionPingResponse(s,i);case"wc_sessionRequest":return this.onSessionRequestResponse(s,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(s,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),U(this,"onRelayEventUnknownPayload",t=>{let{topic:s}=t,{message:i}=L("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),U(this,"shouldIgnorePairingRequest",t=>{let{topic:s,requestMethod:i}=t,n=this.expectedPairingMethodMap.get(s);return!n||n.includes(i)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),U(this,"onSessionProposeRequest",async t=>{let{topic:s,payload:i,attestation:n,encryptedId:o}=t,{params:a,id:c}=i;try{let u=this.client.core.eventClient.getEvent({topic:s});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(Nt.proposal_listener_not_found)),this.isValidConnect(le({},i.params));let h=a.expiryTimestamp||ve(Ce.wc_sessionPropose.req.ttl),l=le({id:c,pairingTopic:s,expiryTimestamp:h},a);await this.setProposal(c,l);let p=await this.getVerifyContext({attestationId:n,hash:pt(JSON.stringify(i)),encryptedId:o,metadata:l.proposer.metadata});u?.addTrace(St.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:p})}catch(u){await this.sendError({id:c,topic:s,error:u,rpcOpts:Ce.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),U(this,"onSessionProposeResponse",async(t,s,i)=>{let{id:n}=s;if(yt(s)){let{result:o}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});let h=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:t,proposalId:n,publicKey:c});let l=await this.client.core.relayer.subscribe(h,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(lt(s)){await this.client.proposal.delete(n,ce("USER_DISCONNECTED"));let o=ne("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:s.error})}}),U(this,"onSessionSettleRequest",async(t,s)=>{let{id:i,params:n}=s;try{this.isValidSessionSettleRequest(n);let{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:p}=s.params,f=[...this.pendingSessions.values()].find(g=>g.sessionTopic===t);if(!f)return this.client.logger.error(`Pending session not found for topic ${t}`);let d=this.client.proposal.get(f.proposalId),m=Ke(le(le(le({topic:t,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),l&&{scopedProperties:l}),p&&{sessionConfig:p}),{transportType:ge.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(ne("session_connect",f.proposalId),{session:m}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:s.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),U(this,"onSessionSettleResponse",async(t,s)=>{let{id:i}=s;yt(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ne("session_approve",i),{})):lt(s)&&(await this.client.session.delete(t,ce("USER_DISCONNECTED")),this.events.emit(ne("session_approve",i),{error:s.error}))}),U(this,"onSessionUpdateRequest",async(t,s)=>{let{params:i,id:n}=s;try{let o=`${t}_session_update`,a=cr.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(le({topic:t},i));try{cr.set(o,n),await this.client.session.update(t,{namespaces:i.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw cr.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:i})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),U(this,"isRequestOutOfSync",(t,s)=>s.toString().slice(0,-3)<t.toString().slice(0,-3)),U(this,"onSessionUpdateResponse",(t,s)=>{let{id:i}=s,n=ne("session_update",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yt(s)?this.events.emit(ne("session_update",i),{}):lt(s)&&this.events.emit(ne("session_update",i),{error:s.error})}),U(this,"onSessionExtendRequest",async(t,s)=>{let{id:i}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,ve(gs)),await this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:t})}catch(n){await this.sendError({id:i,topic:t,error:n}),this.client.logger.error(n)}}),U(this,"onSessionExtendResponse",(t,s)=>{let{id:i}=s,n=ne("session_extend",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yt(s)?this.events.emit(ne("session_extend",i),{}):lt(s)&&this.events.emit(ne("session_extend",i),{error:s.error})}),U(this,"onSessionPingRequest",async(t,s)=>{let{id:i}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:t})}catch(n){await this.sendError({id:i,topic:t,error:n}),this.client.logger.error(n)}}),U(this,"onSessionPingResponse",(t,s)=>{let{id:i}=s,n=ne("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);yt(s)?this.events.emit(ne("session_ping",i),{}):lt(s)&&this.events.emit(ne("session_ping",i),{error:s.error})},500)}),U(this,"onSessionDeleteRequest",async(t,s)=>{let{id:i}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(xe.publish,async()=>{n(await this.deleteSession({topic:t,id:i}))})}),this.sendResult({id:i,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:ce("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),U(this,"onSessionRequest",async t=>{var s,i,n;let{topic:o,payload:a,attestation:c,encryptedId:u,transportType:h}=t,{id:l,params:p}=a;try{await this.isValidRequest(le({topic:o},p));let f=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:pt(JSON.stringify(Dt("wc_sessionRequest",p,l))),encryptedId:u,metadata:f.peer.metadata,transportType:h}),m={id:l,topic:o,params:p,verifyContext:d};await this.setPendingSessionRequest(m),h===ge.link_mode&&(s=f.peer.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(f){await this.sendError({id:l,topic:o,error:f}),this.client.logger.error(f)}}),U(this,"onSessionRequestResponse",(t,s)=>{let{id:i}=s,n=ne("session_request",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yt(s)?this.events.emit(ne("session_request",i),{result:s.result}):lt(s)&&this.events.emit(ne("session_request",i),{error:s.error})}),U(this,"onSessionEventRequest",async(t,s)=>{let{id:i,params:n}=s;try{let o=`${t}_session_event_${n.event.name}`,a=cr.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(le({topic:t},n)),this.client.events.emit("session_event",{id:i,topic:t,params:n}),cr.set(o,i)}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),U(this,"onSessionAuthenticateResponse",(t,s)=>{let{id:i}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:s}),yt(s)?this.events.emit(ne("session_request",i),{result:s.result}):lt(s)&&this.events.emit(ne("session_request",i),{error:s.error})}),U(this,"onSessionAuthenticateRequest",async t=>{var s;let{topic:i,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{let{requester:u,authPayload:h,expiryTimestamp:l}=n.params,p=await this.getVerifyContext({attestationId:o,hash:pt(JSON.stringify(n)),encryptedId:a,metadata:u.metadata,transportType:c}),f={requester:u,pairingTopic:i,id:n.id,authPayload:h,verifyContext:p,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:f,pairingTopic:i,transportType:c}),c===ge.link_mode&&(s=u.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:n.params,id:n.id,verifyContext:p})}catch(u){this.client.logger.error(u);let h=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),p=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:vt,receiverPublicKey:h,senderPublicKey:l};await this.sendError({id:n.id,topic:i,error:u,encodeOpts:f,rpcOpts:Ce.wc_sessionAuthenticate.autoReject,appLink:p})}}),U(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),U(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Bt.idle,this.processSessionRequestQueue()},(0,Q.toMiliseconds)(this.requestQueueDelay))}),U(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:s})=>{let i=this.client.core.history.pending;i.length>0&&i.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{let o=n.request.id,a=ne("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ne("session_request",n.request.id),{error:s})})}),U(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Bt.active){this.client.logger.info("session request queue is already active.");return}let t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Bt.active,this.emitSessionRequest(t)}catch(s){this.client.logger.error(s)}}),U(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),U(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;let s=this.client.proposal.getAll().find(i=>i.pairingTopic===t.topic);s&&this.onSessionProposeRequest({topic:t.topic,payload:Dt("wc_sessionPropose",Ke(le({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id)})}),U(this,"isValidConnect",async t=>{if(!Me(t)){let{message:u}=L("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(u)}let{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(_e(s)||await this.isValidPairingTopic(s),!jp(c,!0)){let{message:u}=L("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!_e(i)&&xr(i)!==0&&this.validateNamespaces(i,"requiredNamespaces"),!_e(n)&&xr(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),_e(o)||this.validateSessionProps(o,"sessionProperties"),!_e(a)){this.validateSessionProps(a,"scopedProperties");let u=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(h=>u.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),U(this,"validateNamespaces",(t,s)=>{let i=kp(t,"connect()",s);if(i)throw new Error(i.message)}),U(this,"isValidApprove",async t=>{if(!Me(t))throw new Error(L("MISSING_OR_INVALID",`approve() params: ${t}`).message);let{id:s,namespaces:i,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(s),await this.isValidProposalId(s);let c=this.client.proposal.get(s),u=sn(i,"approve()");if(u)throw new Error(u.message);let h=La(c.requiredNamespaces,i,"approve()");if(h)throw new Error(h.message);if(!ye(n,!0)){let{message:l}=L("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(l)}if(_e(o)||this.validateSessionProps(o,"sessionProperties"),!_e(a)){this.validateSessionProps(a,"scopedProperties");let l=new Set(Object.keys(i));if(!Object.keys(a).every(p=>l.has(p)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),U(this,"isValidReject",async t=>{if(!Me(t)){let{message:n}=L("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}let{id:s,reason:i}=t;if(this.checkRecentlyDeleted(s),await this.isValidProposalId(s),!$p(i)){let{message:n}=L("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(n)}}),U(this,"isValidSessionSettleRequest",t=>{if(!Me(t)){let{message:u}=L("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(u)}let{relay:s,controller:i,namespaces:n,expiry:o}=t;if(!Ua(s)){let{message:u}=L("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}let a=Lp(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=sn(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ct(o)){let{message:u}=L("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),U(this,"isValidUpdate",async t=>{if(!Me(t)){let{message:c}=L("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}let{topic:s,namespaces:i}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);let n=this.client.session.get(s),o=sn(i,"update()");if(o)throw new Error(o.message);let a=La(n.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),U(this,"isValidExtend",async t=>{if(!Me(t)){let{message:i}=L("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(i)}let{topic:s}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s)}),U(this,"isValidRequest",async t=>{if(!Me(t)){let{message:c}=L("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}let{topic:s,request:i,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);let{namespaces:a}=this.client.session.get(s);if(!Ba(a,n)){let{message:c}=L("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!Vp(i)){let{message:c}=L("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!Kp(a,n,i.method)){let{message:c}=L("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!Gp(o,Oc)){let{message:c}=L("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Oc.min} and ${Oc.max}`);throw new Error(c)}}),U(this,"isValidRespond",async t=>{var s;if(!Me(t)){let{message:o}=L("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}let{topic:i,response:n}=t;try{await this.isValidSessionTopic(i)}catch(o){throw(s=t?.response)!=null&&s.id&&this.cleanupAfterResponse(t),o}if(!zp(n)){let{message:o}=L("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),U(this,"isValidPing",async t=>{if(!Me(t)){let{message:i}=L("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(i)}let{topic:s}=t;await this.isValidSessionOrPairingTopic(s)}),U(this,"isValidEmit",async t=>{if(!Me(t)){let{message:a}=L("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}let{topic:s,event:i,chainId:n}=t;await this.isValidSessionTopic(s);let{namespaces:o}=this.client.session.get(s);if(!Ba(o,n)){let{message:a}=L("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!Hp(i)){let{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!Wp(o,n,i.name)){let{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),U(this,"isValidDisconnect",async t=>{if(!Me(t)){let{message:i}=L("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(i)}let{topic:s}=t;await this.isValidSessionOrPairingTopic(s)}),U(this,"isValidAuthenticate",t=>{let{chains:s,uri:i,domain:n,nonce:o}=t;if(!Array.isArray(s)||s.length===0)throw new Error("chains is required and must be a non-empty array");if(!ye(i,!1))throw new Error("uri is required parameter");if(!ye(n,!1))throw new Error("domain is required parameter");if(!ye(o,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(c=>ur(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=ur(s[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),U(this,"getVerifyContext",async t=>{let{attestationId:s,hash:i,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||ds,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ge.link_mode){let h=this.getAppLinkIfEnabled(o,a);return c.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",c}let u=await this.client.core.verify.resolve({attestationId:s,hash:i,encryptedId:n,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),U(this,"validateSessionProps",(t,s)=>{Object.values(t).forEach((i,n)=>{if(i==null){let{message:o}=L("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${i} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),U(this,"getPendingAuthRequest",t=>{let s=this.client.auth.requests.get(t);return typeof s=="object"?s:void 0}),U(this,"addToRecentlyDeleted",(t,s)=>{if(this.recentlyDeletedMap.set(t,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0,n=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(i++>=n)break;this.recentlyDeletedMap.delete(o)}}}),U(this,"checkRecentlyDeleted",t=>{let s=this.recentlyDeletedMap.get(t);if(s){let{message:i}=L("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${t}`);throw new Error(i)}}),U(this,"isLinkModeEnabled",(t,s)=>{var i,n,o,a,c,u,h,l,p;return!t||s!==ge.link_mode?!1:((n=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((h=t?.redirect)==null?void 0:h.universal)!==void 0&&((l=t?.redirect)==null?void 0:l.universal)!==""&&((p=t?.redirect)==null?void 0:p.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof globalThis?.Linking<"u"}),U(this,"getAppLinkIfEnabled",(t,s)=>{var i;return this.isLinkModeEnabled(t,s)?(i=t?.redirect)==null?void 0:i.universal:void 0}),U(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;let s=ya(t,"topic")||"",i=decodeURIComponent(ya(t,"wc_ev")||""),n=this.client.session.keys.includes(s);n&&this.client.session.update(s,{transportType:ge.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:i,sessionExists:n})}),U(this,"registerLinkModeListeners",async()=>{var t;if(Qs()||Yt()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){let s=globalThis?.Linking;if(typeof s<"u"){s.addEventListener("url",this.handleLinkModeMessage,this.client.name);let i=await s.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),U(this,"shouldSetTVF",(t,s)=>{if(!s||t!=="wc_sessionRequest")return!1;let{request:i}=s;return Object.keys(nf).includes(i.method)}),U(this,"getTVFParams",(t,s,i)=>{var n,o;try{let a=s.request.method,c=this.extractTxHashesFromResult(a,i);return Ke(le({correlationId:t,rpcMethods:[a],chainId:s.chainId},this.isValidContractData(s.request.params)&&{contractAddresses:[(o=(n=s.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),U(this,"isValidContractData",t=>{var s;if(!t)return!1;try{let i=t?.data||((s=t?.[0])==null?void 0:s.data);if(!i.startsWith("0x"))return!1;let n=i.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),U(this,"extractTxHashesFromResult",(t,s)=>{try{let i=nf[t];if(typeof s=="string")return[s];let n=s[i.key];if(Tt(n))return t==="solana_signAllTransactions"?n.map(o=>ep(o)):n;if(typeof n=="string")return[n]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[s,i]of Object.entries(t))for(let n of i)try{await this.onProviderMessageEvent({topic:s,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){let{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(xe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:s,attestation:i,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Pn)?this.client.auth.authKeys.get(Pn):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(t,s,{receiverPublicKey:o,encoding:n===ge.link_mode?Zt:nt});Os(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:i,transportType:n,encryptedId:pt(s)})):Cs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,s)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ct.expired,async e=>{let{topic:t,id:s}=Gi(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,L("EXPIRED"),!0);if(s&&this.client.auth.requests.keys.includes(s))return await this.deletePendingAuthRequest(s,L("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(hr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(hr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ye(e,!1)){let{message:t}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ct(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=L("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ye(e,!1)){let{message:t}=L("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=L("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ct(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=L("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=L("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ye(e,!1)){let{message:t}=L("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{let{message:t}=L("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Mp(e)){let{message:t}=L("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=L("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ct(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=L("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}},Nc=class extends Ut{constructor(e,t){super(e,t,hS,jc),this.core=e,this.logger=t}},Fc=class extends Ut{constructor(e,t){super(e,t,lS,jc),this.core=e,this.logger=t}},Uc=class extends Ut{constructor(e,t){super(e,t,dS,jc,s=>s.id),this.core=e,this.logger=t}},Bc=class extends Ut{constructor(e,t){super(e,t,yS,On,()=>Pn),this.core=e,this.logger=t}},Lc=class extends Ut{constructor(e,t){super(e,t,wS,On),this.core=e,this.logger=t}},qc=class extends Ut{constructor(e,t){super(e,t,bS,On,s=>s.id),this.core=e,this.logger=t}},xS=Object.defineProperty,DS=(r,e,t)=>e in r?xS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cc=(r,e,t)=>DS(r,typeof e!="symbol"?e+"":e,t),kc=class{constructor(e,t){this.core=e,this.logger=t,Cc(this,"authKeys"),Cc(this,"pairingTopics"),Cc(this,"requests"),this.authKeys=new Bc(this.core,this.logger),this.pairingTopics=new Lc(this.core,this.logger),this.requests=new qc(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},PS=Object.defineProperty,AS=(r,e,t)=>e in r?PS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,te=(r,e,t)=>AS(r,typeof e!="symbol"?e+"":e,t),An=class r extends vn{constructor(e){super(e),te(this,"protocol",af),te(this,"version",cf),te(this,"name",Ac.name),te(this,"metadata"),te(this,"core"),te(this,"logger"),te(this,"events",new We),te(this,"engine"),te(this,"session"),te(this,"proposal"),te(this,"pendingRequest"),te(this,"auth"),te(this,"signConfig"),te(this,"on",(s,i)=>this.events.on(s,i)),te(this,"once",(s,i)=>this.events.once(s,i)),te(this,"off",(s,i)=>this.events.off(s,i)),te(this,"removeListener",(s,i)=>this.events.removeListener(s,i)),te(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),te(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"update",async s=>{try{return await this.engine.update(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"request",async s=>{try{return await this.engine.request(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"find",s=>{try{return this.engine.find(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),te(this,"authenticate",async(s,i)=>{try{return await this.engine.authenticate(s,i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(i){throw this.logger.error(i.message),i}}),te(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||Ac.name,this.metadata=kl(e?.metadata),this.signConfig=e?.signConfig;let t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,Rr.default)(fr({level:e?.logger||Ac.logger}));this.core=e?.core||new tf(e),this.logger=Re(t,this.name),this.session=new Fc(this.core,this.logger),this.proposal=new Nc(this.core,this.logger),this.pendingRequest=new Uc(this.core,this.logger),this.engine=new Rc(this),this.auth=new kc(this.core,this.logger)}static async init(e){let t=new r(e);return await t.initialize(),t}get context(){return ze(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,Q.toMiliseconds)(Q.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};Tr();var hf="error",OS="wss://relay.walletconnect.org",CS="wc",TS="universal_provider",Cn=`${CS}@2:${TS}:`,_f="https://rpc.walletconnect.org/v1/",Ps="generic",RS=`${_f}bundler`,mt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function NS(){}function ou(r){return r==null||typeof r!="object"&&typeof r!="function"}function au(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function FS(r){if(ou(r))return r;if(Array.isArray(r)||au(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);let e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){let s=new t(r);return s.lastIndex=r.lastIndex,s}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){let s=new t(r.message);return s.stack=r.stack,s.name=r.name,s.cause=r.cause,s}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){let s=Object.create(e);return Object.assign(s,r)}return r}function lf(r){return typeof r=="object"&&r!==null}function Sf(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function xf(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}var US="[object RegExp]",Df="[object String]",Pf="[object Number]",Af="[object Boolean]",Of="[object Arguments]",BS="[object Symbol]",LS="[object Date]",qS="[object Map]",kS="[object Set]",jS="[object Array]",MS="[object ArrayBuffer]",$S="[object Object]",VS="[object DataView]",zS="[object Uint8Array]",HS="[object Uint8ClampedArray]",KS="[object Uint16Array]",WS="[object Uint32Array]",GS="[object Int8Array]",YS="[object Int16Array]",JS="[object Int32Array]",XS="[object Float32Array]",ZS="[object Float64Array]";function QS(r,e){return As(r,void 0,r,new Map,e)}function As(r,e,t,s=new Map,i=void 0){let n=i?.(r,e,t,s);if(n!=null)return n;if(ou(r))return r;if(s.has(r))return s.get(r);if(Array.isArray(r)){let o=new Array(r.length);s.set(r,o);for(let a=0;a<r.length;a++)o[a]=As(r[a],a,t,s,i);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){let o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){let o=new Map;s.set(r,o);for(let[a,c]of r)o.set(a,As(c,a,t,s,i));return o}if(r instanceof Set){let o=new Set;s.set(r,o);for(let a of r)o.add(As(a,void 0,t,s,i));return o}if(typeof B<"u"&&B.isBuffer(r))return r.subarray();if(au(r)){let o=new(Object.getPrototypeOf(r)).constructor(r.length);s.set(r,o);for(let a=0;a<r.length;a++)o[a]=As(r[a],a,t,s,i);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){let o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return s.set(r,o),Ar(o,r,t,s,i),o}if(typeof File<"u"&&r instanceof File){let o=new File([r],r.name,{type:r.type});return s.set(r,o),Ar(o,r,t,s,i),o}if(r instanceof Blob){let o=new Blob([r],{type:r.type});return s.set(r,o),Ar(o,r,t,s,i),o}if(r instanceof Error){let o=new r.constructor;return s.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,Ar(o,r,t,s,i),o}if(typeof r=="object"&&ex(r)){let o=Object.create(Object.getPrototypeOf(r));return s.set(r,o),Ar(o,r,t,s,i),o}return r}function Ar(r,e,t=r,s,i){let n=[...Object.keys(e),...Sf(e)];for(let o=0;o<n.length;o++){let a=n[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=As(e[a],a,t,s,i))}}function ex(r){switch(xf(r)){case Of:case jS:case MS:case VS:case Af:case LS:case XS:case ZS:case GS:case YS:case JS:case qS:case Pf:case $S:case US:case kS:case Df:case BS:case zS:case HS:case KS:case WS:return!0;default:return!1}}function tx(r,e){return QS(r,(t,s,i,n)=>{let o=e?.(t,s,i,n);if(o!=null)return o;if(typeof r=="object")switch(Object.prototype.toString.call(r)){case Pf:case Df:case Af:{let a=new r.constructor(r?.valueOf());return Ar(a,r),a}case Of:{let a={};return Ar(a,r),a.length=r.length,a[Symbol.iterator]=r[Symbol.iterator],a}default:return}})}function pf(r){return tx(r)}function df(r){return r!==null&&typeof r=="object"&&xf(r)==="[object Arguments]"}function rx(r){return au(r)}function sx(r){if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){let t=r[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable?!1:r.toString()===`[object ${t}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function ix(r,...e){let t=e.slice(0,-1),s=e[e.length-1],i=r;for(let n=0;n<t.length;n++){let o=t[n];i=Hc(i,o,s,new Map)}return i}function Hc(r,e,t,s){if(ou(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(s.has(e))return FS(s.get(e));if(s.set(e,r),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}let i=[...Object.keys(e),...Sf(e)];for(let n=0;n<i.length;n++){let o=i[n],a=e[o],c=r[o];if(df(a)&&(a={...a}),df(c)&&(c={...c}),typeof B<"u"&&B.isBuffer(a)&&(a=pf(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let h=[],l=Reflect.ownKeys(c);for(let p=0;p<l.length;p++){let f=l[p];h[f]=c[f]}c=h}else c=[];let u=t(c,a,o,r,e,s);u!=null?r[o]=u:Array.isArray(a)||lf(c)&&lf(a)?r[o]=Hc(c,a,t,s):c==null&&sx(a)?r[o]=Hc({},a,t,s):c==null&&rx(a)?r[o]=pf(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function nx(r,...e){return ix(r,...e,NS)}var ox=Object.defineProperty,ax=Object.defineProperties,cx=Object.getOwnPropertyDescriptors,ff=Object.getOwnPropertySymbols,ux=Object.prototype.hasOwnProperty,hx=Object.prototype.propertyIsEnumerable,gf=(r,e,t)=>e in r?ox(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Tn=(r,e)=>{for(var t in e||(e={}))ux.call(e,t)&&gf(r,t,e[t]);if(ff)for(var t of ff(e))hx.call(e,t)&&gf(r,t,e[t]);return r},lx=(r,e)=>ax(r,cx(e));function ut(r,e,t){var s;let i=ur(r);return((s=e.rpcMap)==null?void 0:s[i.reference])||`${_f}?chainId=${i.namespace}:${i.reference}&projectId=${t}`}function Or(r){return r.includes(":")?r.split(":")[1]:r}function Cf(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function px(r,e){let t=Object.keys(e.namespaces).filter(i=>i.includes(r));if(!t.length)return[];let s=[];return t.forEach(i=>{let n=e.namespaces[i].accounts;s.push(...n)}),s}function Mc(r={},e={}){let t=mf(r),s=mf(e);return nx(t,s)}function mf(r){var e,t,s,i;let n={};if(!xr(r))return n;for(let[o,a]of Object.entries(r)){let c=rn(o)?[o]:a.chains,u=a.methods||[],h=a.events||[],l=a.rpcMap||{},p=ls(o);n[p]=lx(Tn(Tn({},n[p]),a),{chains:Zs(c,(e=n[p])==null?void 0:e.chains),methods:Zs(u,(t=n[p])==null?void 0:t.methods),events:Zs(h,(s=n[p])==null?void 0:s.events),rpcMap:Tn(Tn({},l),(i=n[p])==null?void 0:i.rpcMap)})}return n}function yf(r){return r.includes(":")?r.split(":")[2]:r}function wf(r){let e={};for(let[t,s]of Object.entries(r)){let i=s.methods||[],n=s.events||[],o=s.accounts||[],a=rn(t)?[t]:s.chains?s.chains:Cf(s.accounts);e[t]={chains:a,methods:i,events:n,accounts:o}}return e}function $c(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}var Tf={},ae=r=>Tf[r],Vc=(r,e)=>{Tf[r]=e},dx=Object.defineProperty,fx=(r,e,t)=>e in r?dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ms=(r,e,t)=>fx(r,typeof e!="symbol"?e+"":e,t),Kc=class{constructor(e){ms(this,"name","polkadot"),ms(this,"client"),ms(this,"httpProviders"),ms(this,"events"),ms(this,"namespace"),ms(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=Or(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},gx=Object.defineProperty,mx=Object.defineProperties,yx=Object.getOwnPropertyDescriptors,bf=Object.getOwnPropertySymbols,wx=Object.prototype.hasOwnProperty,bx=Object.prototype.propertyIsEnumerable,Wc=(r,e,t)=>e in r?gx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vf=(r,e)=>{for(var t in e||(e={}))wx.call(e,t)&&Wc(r,t,e[t]);if(bf)for(var t of bf(e))bx.call(e,t)&&Wc(r,t,e[t]);return r},Ef=(r,e)=>mx(r,yx(e)),ys=(r,e,t)=>Wc(r,typeof e!="symbol"?e+"":e,t),Gc=class{constructor(e){ys(this,"name","eip155"),ys(this,"client"),ys(this,"chainId"),ys(this,"namespace"),ys(this,"httpProviders"),ys(this,"events"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let s=t||ut(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=parseInt(Or(t));e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){let e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,s;let i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;let n=parseInt(i,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,s,i;let n=(s=(t=e.request)==null?void 0:t.params)==null?void 0:s[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let o=this.client.session.get(e.topic),a=((i=o?.sessionProperties)==null?void 0:i.capabilities)||{};if(a!=null&&a[n])return a?.[n];let c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ef(vf({},o.sessionProperties||{}),{capabilities:Ef(vf({},a||{}),{[n]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,s;let i=this.client.session.get(e.topic),n=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(n){let a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}let o=(s=i.sessionProperties)==null?void 0:s.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var s;let i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Dt("eth_getUserOperationReceipt",[(s=t.request.params)==null?void 0:s[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${RS}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}},vx=Object.defineProperty,Ex=(r,e,t)=>e in r?vx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ws=(r,e,t)=>Ex(r,typeof e!="symbol"?e+"":e,t),Yc=class{constructor(e){ws(this,"name","solana"),ws(this,"client"),ws(this,"httpProviders"),ws(this,"events"),ws(this,"namespace"),ws(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=Or(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},Ix=Object.defineProperty,_x=(r,e,t)=>e in r?Ix(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bs=(r,e,t)=>_x(r,typeof e!="symbol"?e+"":e,t),Jc=class{constructor(e){bs(this,"name","cosmos"),bs(this,"client"),bs(this,"httpProviders"),bs(this,"events"),bs(this,"namespace"),bs(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=Or(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},Sx=Object.defineProperty,xx=(r,e,t)=>e in r?Sx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vs=(r,e,t)=>xx(r,typeof e!="symbol"?e+"":e,t),Xc=class{constructor(e){vs(this,"name","algorand"),vs(this,"client"),vs(this,"httpProviders"),vs(this,"events"),vs(this,"namespace"),vs(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){let s=t||ut(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ge(new rt(s,ae("disableProviderPing")))}},Dx=Object.defineProperty,Px=(r,e,t)=>e in r?Dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Es=(r,e,t)=>Px(r,typeof e!="symbol"?e+"":e,t),Zc=class{constructor(e){Es(this,"name","cip34"),Es(this,"client"),Es(this,"httpProviders"),Es(this,"events"),Es(this,"namespace"),Es(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let s=this.getCardanoRPCUrl(t),i=Or(t);e[i]=this.createHttpProvider(i,s)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){let t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},Ax=Object.defineProperty,Ox=(r,e,t)=>e in r?Ax(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Is=(r,e,t)=>Ox(r,typeof e!="symbol"?e+"":e,t),Qc=class{constructor(e){Is(this,"name","elrond"),Is(this,"client"),Is(this,"httpProviders"),Is(this,"events"),Is(this,"namespace"),Is(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=Or(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},Cx=Object.defineProperty,Tx=(r,e,t)=>e in r?Cx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_s=(r,e,t)=>Tx(r,typeof e!="symbol"?e+"":e,t),eu=class{constructor(e){_s(this,"name","multiversx"),_s(this,"client"),_s(this,"httpProviders"),_s(this,"events"),_s(this,"namespace"),_s(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;let i=Or(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},Rx=Object.defineProperty,Nx=(r,e,t)=>e in r?Rx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ss=(r,e,t)=>Nx(r,typeof e!="symbol"?e+"":e,t),tu=class{constructor(e){Ss(this,"name","near"),Ss(this,"client"),Ss(this,"httpProviders"),Ss(this,"events"),Ss(this,"namespace"),Ss(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let s=t||ut(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace);return typeof s>"u"?void 0:new Ge(new rt(s,ae("disableProviderPing")))}},Fx=Object.defineProperty,Ux=(r,e,t)=>e in r?Fx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xs=(r,e,t)=>Ux(r,typeof e!="symbol"?e+"":e,t),ru=class{constructor(e){xs(this,"name","tezos"),xs(this,"client"),xs(this,"httpProviders"),xs(this,"events"),xs(this,"namespace"),xs(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let s=t||ut(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace);return typeof s>"u"?void 0:new Ge(new rt(s))}},Bx=Object.defineProperty,Lx=(r,e,t)=>e in r?Bx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ds=(r,e,t)=>Lx(r,typeof e!="symbol"?e+"":e,t),su=class{constructor(e){Ds(this,"name",Ps),Ds(this,"client"),Ds(this,"httpProviders"),Ds(this,"events"),Ds(this,"namespace"),Ds(this,"chainId"),this.namespace=e.namespace,this.events=ae("events"),this.client=ae("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;let s={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(i=>{let n=ur(i);s[`${n.namespace}:${n.reference}`]=this.createHttpProvider(i)}),s}getHttpProvider(e){let t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){let s=t||ut(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ge(new rt(s,ae("disableProviderPing")))}},qx=Object.defineProperty,kx=Object.defineProperties,jx=Object.getOwnPropertyDescriptors,If=Object.getOwnPropertySymbols,Mx=Object.prototype.hasOwnProperty,$x=Object.prototype.propertyIsEnumerable,iu=(r,e,t)=>e in r?qx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rn=(r,e)=>{for(var t in e||(e={}))Mx.call(e,t)&&iu(r,t,e[t]);if(If)for(var t of If(e))$x.call(e,t)&&iu(r,t,e[t]);return r},zc=(r,e)=>kx(r,jx(e)),gt=(r,e,t)=>iu(r,typeof e!="symbol"?e+"":e,t),nu=class r{constructor(e){gt(this,"client"),gt(this,"namespaces"),gt(this,"optionalNamespaces"),gt(this,"sessionProperties"),gt(this,"scopedProperties"),gt(this,"events",new dr),gt(this,"rpcProviders",{}),gt(this,"session"),gt(this,"providerOpts"),gt(this,"logger"),gt(this,"uri"),gt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,Rr.default)(fr({level:e?.logger||hf})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let t=new r(e);return await t.initialize(),t}async request(e,t,s){let[i,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Rn({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:s})}sendAsync(e,t,s,i){let n=new Date().getTime();this.request(e,s,i).then(o=>t(null,gr(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:s,response:i}=await this.client.authenticate(e,t);s&&(this.uri=s,this.events.emit("display_uri",s));let n=await i();if(this.session=n.session,this.session){let o=wf(this.session.namespaces);this.namespaces=Mc(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let i=await s();this.session=i;let n=wf(i.namespaces);return this.namespaces=Mc(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[s,i]=this.validateChain(e),n=this.getProvider(s);n.name===Ps?n.setDefaultChain(`${s}:${i}`,t):n.setDefaultChain(i,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(Tt(t)){for(let s of t)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await An.init({core:this.providerOpts.core,logger:this.providerOpts.logger||hf,relayUrl:this.providerOpts.relayUrl||OS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(s){throw this.logger.error("Failed to get session",s),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{let s=this.client.session.getAll();this.session=s[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(t=>ls(t)))];Vc("client",this.client),Vc("events",this.events),Vc("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;let s=px(t,this.session),i=Cf(s),n=Mc(this.namespaces,this.optionalNamespaces),o=zc(Rn({},n[t]),{accounts:s,chains:i});switch(t){case"eip155":this.rpcProviders[t]=new Gc({namespace:o});break;case"algorand":this.rpcProviders[t]=new Xc({namespace:o});break;case"solana":this.rpcProviders[t]=new Yc({namespace:o});break;case"cosmos":this.rpcProviders[t]=new Jc({namespace:o});break;case"polkadot":this.rpcProviders[t]=new Kc({namespace:o});break;case"cip34":this.rpcProviders[t]=new Zc({namespace:o});break;case"elrond":this.rpcProviders[t]=new Qc({namespace:o});break;case"multiversx":this.rpcProviders[t]=new eu({namespace:o});break;case"near":this.rpcProviders[t]=new tu({namespace:o});break;case"tezos":this.rpcProviders[t]=new ru({namespace:o});break;default:this.rpcProviders[Ps]?this.rpcProviders[Ps].updateNamespace(o):this.rpcProviders[Ps]=new su({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:s}=e;s===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:s,topic:i}=e;if(i!==((t=this.session)==null?void 0:t.topic))return;let{event:n}=s;if(n.name==="accountsChanged"){let o=n.data;o&&Tt(o)&&this.events.emit("accountsChanged",o.map(yf))}else if(n.name==="chainChanged"){let o=s.chainId,a=s.event.data,c=ls(o),u=$c(o)!==$c(a)?`${c}:${$c(a)}`:o;this.onChainChanged(u)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var s,i;if(e!==((s=this.session)==null?void 0:s.topic))return;let{namespaces:n}=t,o=(i=this.client)==null?void 0:i.session.get(e);this.session=zc(Rn({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",zc(Rn({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(mt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Ps]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t,optionalNamespaces:s,sessionProperties:i,scopedProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){let[t,s]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(o=>ls(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];let i=ls(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;let[s,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(s,i),this.events.emit("chainChanged",i);let n=this.getProvider(s).getDefaultChain();t||this.getProvider(s).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:s,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:s}){var i,n;try{if(t===s)return;let o=(n=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:n.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${s}:`)).map(yf);if(!Tt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;let s=this.namespaces[e]?e:`${e}:${t}`,i={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[s]?this.namespaces[s]&&(this.namespaces[s].defaultChain=t):this.namespaces[s]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var s;let i=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.setItem(`${Cn}/${e}${i}`,t)}async getFromStore(e){var t;let s=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Cn}/${e}${s}`)}async deleteFromStore(e){var t;let s=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Cn}/${e}${s}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let t=await this.client.core.storage.getKeys();for(let s of t)s.startsWith(Cn)&&await this.client.core.storage.removeItem(s)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}},bT=nu;export{zu as a,T2 as b,ce as c,Tt as d,nu as e,bT as f};
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@walletconnect/relay-auth/dist/index.es.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@walletconnect/utils/dist/index.es.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
