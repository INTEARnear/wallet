var pr=Object.defineProperty;var wr=(t,e)=>{for(var n in e)pr(t,n,{get:e[n],enumerable:!0})};Object.defineProperty(window,"localStorage",{value:sandboxedLocalStorage});Object.defineProperty(window,"open",{value:function(t,e,n){return console.log("open",t),window.selector.open(t,e,n)}});import*as ne from"@fastnear/utils";import{tryParseJson as Xe,fromBase64 as so,lsSet as ir,lsGet as io,privateKeyFromRandom as co,toBase64 as zs,parseJsonFromBytes as Zs,canSignWithLAK as Gs,serializeTransaction as $s,toBase58 as js,signHash as Ys,serializeSignedTransaction as Js,bytesToBase64 as Xs}from"@fastnear/utils";var yr=20,xr=1,vt=1e6,rn=1e6,mr=-7,br=21,Er=!1,Ft="[big.js] ",Bt=Ft+"Invalid ",ie=Bt+"decimal places",Ir=Bt+"rounding mode",on=Ft+"Division by zero",B={},ot=void 0,Ar=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function sn(){function t(e){var n=this;if(!(n instanceof t))return e===ot?sn():new t(e);if(e instanceof t)n.s=e.s,n.e=e.e,n.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(Bt+"value");e=e===0&&1/e<0?"-0":String(e)}Sr(n,e)}n.constructor=t}return t.prototype=B,t.DP=yr,t.RM=xr,t.NE=mr,t.PE=br,t.strict=Er,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Sr(t,e){var n,r,o;if(!Ar.test(e))throw Error(Bt+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),o=e.length,r=0;r<o&&e.charAt(r)=="0";)++r;if(r==o)t.c=[t.e=0];else{for(;o>0&&e.charAt(--o)=="0";);for(t.e=n-r-1,t.c=[],n=0;r<=o;)t.c[n++]=+e.charAt(r++)}return t}function _t(t,e,n,r){var o=t.c;if(n===ot&&(n=t.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(Ir);if(e<1)r=n===3&&(r||!!o[0])||e===0&&(n===1&&o[0]>=5||n===2&&(o[0]>5||o[0]===5&&(r||o[1]!==ot))),o.length=1,r?(t.e=t.e-e+1,o[0]=1):o[0]=t.e=0;else if(e<o.length){if(r=n===1&&o[e]>=5||n===2&&(o[e]>5||o[e]===5&&(r||o[e+1]!==ot||o[e-1]&1))||n===3&&(r||!!o[0]),o.length=e,r){for(;++o[--e]>9;)if(o[e]=0,e===0){++t.e,o.unshift(1);break}}for(e=o.length;!o[--e];)o.pop()}return t}function Tt(t,e,n){var r=t.e,o=t.c.join(""),s=o.length;if(e)o=o.charAt(0)+(s>1?"."+o.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)o="0"+o;o="0."+o}else if(r>0)if(++r>s)for(r-=s;r--;)o+="0";else r<s&&(o=o.slice(0,r)+"."+o.slice(r));else s>1&&(o=o.charAt(0)+"."+o.slice(1));return t.s<0&&n?"-"+o:o}B.abs=function(){var t=new this.constructor(this);return t.s=1,t};B.cmp=function(t){var e,n=this,r=n.c,o=(t=new n.constructor(t)).c,s=n.s,a=t.s,c=n.e,i=t.e;if(!r[0]||!o[0])return r[0]?s:o[0]?-a:0;if(s!=a)return s;if(e=s<0,c!=i)return c>i^e?1:-1;for(a=(c=r.length)<(i=o.length)?c:i,s=-1;++s<a;)if(r[s]!=o[s])return r[s]>o[s]^e?1:-1;return c==i?0:c>i^e?1:-1};B.div=function(t){var e=this,n=e.constructor,r=e.c,o=(t=new n(t)).c,s=e.s==t.s?1:-1,a=n.DP;if(a!==~~a||a<0||a>vt)throw Error(ie);if(!o[0])throw Error(on);if(!r[0])return t.s=s,t.c=[t.e=0],t;var c,i,l,f,u,d=o.slice(),w=c=o.length,b=r.length,h=r.slice(0,c),p=h.length,I=t,L=I.c=[],A=0,x=a+(I.e=e.e-t.e)+1;for(I.s=s,s=x<0?0:x,d.unshift(0);p++<c;)h.push(0);do{for(l=0;l<10;l++){if(c!=(p=h.length))f=c>p?1:-1;else for(u=-1,f=0;++u<c;)if(o[u]!=h[u]){f=o[u]>h[u]?1:-1;break}if(f<0){for(i=p==c?o:d;p;){if(h[--p]<i[p]){for(u=p;u&&!h[--u];)h[u]=9;--h[u],h[p]+=10}h[p]-=i[p]}for(;!h[0];)h.shift()}else break}L[A++]=f?l:++l,h[0]&&f?h[p]=r[w]||0:h=[r[w]]}while((w++<b||h[0]!==ot)&&s--);return!L[0]&&A!=1&&(L.shift(),I.e--,x--),A>x&&_t(I,x,n.RM,h[0]!==ot),I};B.eq=function(t){return this.cmp(t)===0};B.gt=function(t){return this.cmp(t)>0};B.gte=function(t){return this.cmp(t)>-1};B.lt=function(t){return this.cmp(t)<0};B.lte=function(t){return this.cmp(t)<1};B.minus=B.sub=function(t){var e,n,r,o,s=this,a=s.constructor,c=s.s,i=(t=new a(t)).s;if(c!=i)return t.s=-i,s.plus(t);var l=s.c.slice(),f=s.e,u=t.c,d=t.e;if(!l[0]||!u[0])return u[0]?t.s=-i:l[0]?t=new a(s):t.s=1,t;if(c=f-d){for((o=c<0)?(c=-c,r=l):(d=f,r=u),r.reverse(),i=c;i--;)r.push(0);r.reverse()}else for(n=((o=l.length<u.length)?l:u).length,c=i=0;i<n;i++)if(l[i]!=u[i]){o=l[i]<u[i];break}if(o&&(r=l,l=u,u=r,t.s=-t.s),(i=(n=u.length)-(e=l.length))>0)for(;i--;)l[e++]=0;for(i=e;n>c;){if(l[--n]<u[n]){for(e=n;e&&!l[--e];)l[e]=9;--l[e],l[n]+=10}l[n]-=u[n]}for(;l[--i]===0;)l.pop();for(;l[0]===0;)l.shift(),--d;return l[0]||(t.s=1,l=[d=0]),t.c=l,t.e=d,t};B.mod=function(t){var e,n=this,r=n.constructor,o=n.s,s=(t=new r(t)).s;if(!t.c[0])throw Error(on);return n.s=t.s=1,e=t.cmp(n)==1,n.s=o,t.s=s,e?new r(n):(o=r.DP,s=r.RM,r.DP=r.RM=0,n=n.div(t),r.DP=o,r.RM=s,this.minus(n.times(t)))};B.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};B.plus=B.add=function(t){var e,n,r,o=this,s=o.constructor;if(t=new s(t),o.s!=t.s)return t.s=-t.s,o.minus(t);var a=o.e,c=o.c,i=t.e,l=t.c;if(!c[0]||!l[0])return l[0]||(c[0]?t=new s(o):t.s=o.s),t;if(c=c.slice(),e=a-i){for(e>0?(i=a,r=l):(e=-e,r=c),r.reverse();e--;)r.push(0);r.reverse()}for(c.length-l.length<0&&(r=l,l=c,c=r),e=l.length,n=0;e;c[e]%=10)n=(c[--e]=c[e]+l[e]+n)/10|0;for(n&&(c.unshift(n),++i),e=c.length;c[--e]===0;)c.pop();return t.c=c,t.e=i,t};B.pow=function(t){var e=this,n=new e.constructor("1"),r=n,o=t<0;if(t!==~~t||t<-rn||t>rn)throw Error(Bt+"exponent");for(o&&(t=-t);t&1&&(r=r.times(e)),t>>=1,!!t;)e=e.times(e);return o?n.div(r):r};B.prec=function(t,e){if(t!==~~t||t<1||t>vt)throw Error(Bt+"precision");return _t(new this.constructor(this),t,e)};B.round=function(t,e){if(t===ot)t=0;else if(t!==~~t||t<-vt||t>vt)throw Error(ie);return _t(new this.constructor(this),t+this.e+1,e)};B.sqrt=function(){var t,e,n,r=this,o=r.constructor,s=r.s,a=r.e,c=new o("0.5");if(!r.c[0])return new o(r);if(s<0)throw Error(Ft+"No square root");s=Math.sqrt(+Tt(r,!0,!0)),s===0||s===1/0?(e=r.c.join(""),e.length+a&1||(e+="0"),s=Math.sqrt(e),a=((a+1)/2|0)-(a<0||a&1),t=new o((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+a)):t=new o(s+""),a=t.e+(o.DP+=4);do n=t,t=c.times(n.plus(r.div(n)));while(n.c.slice(0,a).join("")!==t.c.slice(0,a).join(""));return _t(t,(o.DP-=4)+t.e+1,o.RM)};B.times=B.mul=function(t){var e,n=this,r=n.constructor,o=n.c,s=(t=new r(t)).c,a=o.length,c=s.length,i=n.e,l=t.e;if(t.s=n.s==t.s?1:-1,!o[0]||!s[0])return t.c=[t.e=0],t;for(t.e=i+l,a<c&&(e=o,o=s,s=e,l=a,a=c,c=l),e=new Array(l=a+c);l--;)e[l]=0;for(i=c;i--;){for(c=0,l=a+i;l>i;)c=e[l]+s[i]*o[l-i-1]+c,e[l--]=c%10,c=c/10|0;e[l]=c}for(c?++t.e:e.shift(),i=e.length;!e[--i];)e.pop();return t.c=e,t};B.toExponential=function(t,e){var n=this,r=n.c[0];if(t!==ot){if(t!==~~t||t<0||t>vt)throw Error(ie);for(n=_t(new n.constructor(n),++t,e);n.c.length<t;)n.c.push(0)}return Tt(n,!0,!!r)};B.toFixed=function(t,e){var n=this,r=n.c[0];if(t!==ot){if(t!==~~t||t<0||t>vt)throw Error(ie);for(n=_t(new n.constructor(n),t+n.e+1,e),t=t+n.e+1;n.c.length<t;)n.c.push(0)}return Tt(n,!1,!!r)};B[Symbol.for("nodejs.util.inspect.custom")]=B.toJSON=B.toString=function(){var t=this,e=t.constructor;return Tt(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};B.toNumber=function(){var t=+Tt(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(Ft+"Imprecise conversion");return t};B.toPrecision=function(t,e){var n=this,r=n.constructor,o=n.c[0];if(t!==ot){if(t!==~~t||t<1||t>vt)throw Error(Bt+"precision");for(n=_t(new r(n),t,e);n.c.length<t;)n.c.push(0)}return Tt(n,t<=n.e||n.e<=r.NE||n.e>=r.PE,!!o)};B.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(Ft+"valueOf disallowed");return Tt(t,t.e<=e.NE||t.e>=e.PE,!0)};var vr=sn(),cn=vr;var be={};wr(be,{DEFAULT_NETWORK_ID:()=>er,NETWORKS:()=>ee,WIDGET_URL:()=>tr,_adapter:()=>Nt,_config:()=>te,_state:()=>_,_txHistory:()=>yt,_unbroadcastedEvents:()=>ft,events:()=>Z,getConfig:()=>Rt,getTxHistory:()=>Ye,getWalletAdapterState:()=>rr,onAdapterStateUpdate:()=>nr,resetTxHistory:()=>Je,setConfig:()=>me,update:()=>ct,updateTxHistory:()=>xt});import{lsGet as je,publicKeyFromPrivate as Qn,lsSet as qt}from"@fastnear/utils";import{publicKeyFromPrivate as J,signHash as ye,fromBase58 as ge,privateKeyFromRandom as to}from"@fastnear/utils";var kt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Br(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function an(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ae(t,...e){if(!Br(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ae(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ln(t,e){ae(t);let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Lt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function le(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Q(t,e){return t<<32-e|t>>>e}function un(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Se(t){return typeof t=="string"&&(t=un(t)),ae(t),t}var ce=class{};function ve(t){let e=r=>t().update(Se(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function fn(t=32){if(kt&&typeof kt.getRandomValues=="function")return kt.getRandomValues(new Uint8Array(t));if(kt&&typeof kt.randomBytes=="function")return Uint8Array.from(kt.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function _r(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),a=Number(n>>o&s),c=Number(n&s),i=r?4:0,l=r?0:4;t.setUint32(e+i,a,r),t.setUint32(e+l,c,r)}function dn(t,e,n){return t&e^~t&n}function hn(t,e,n){return t&e^t&n^e&n}var zt=class extends ce{constructor(e,n,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(e),this.view=le(this.buffer)}update(e){Ae(this),e=Se(e),ae(e);let{view:n,buffer:r,blockLen:o}=this,s=e.length;for(let a=0;a<s;){let c=Math.min(o-this.pos,s-a);if(c===o){let i=le(e);for(;o<=s-a;a+=o)this.process(i,a);continue}r.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ae(this),ln(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:a}=this;n[a++]=128,Lt(this.buffer.subarray(a)),this.padOffset>o-a&&(this.process(r,0),a=0);for(let u=a;u<o;u++)n[u]=0;_r(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=le(e),i=this.outputLen;if(i%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=i/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)c.setUint32(4*u,f[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:a,pos:c}=this;return e.destroyed=a,e.finished=s,e.length=o,e.pos=c,o%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}},at=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var R=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var ue=BigInt(4294967295),gn=BigInt(32);function Tr(t,e=!1){return e?{h:Number(t&ue),l:Number(t>>gn&ue)}:{h:Number(t>>gn&ue)|0,l:Number(t&ue)|0}}function pn(t,e=!1){let n=t.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){let{h:a,l:c}=Tr(t[s],e);[r[s],o[s]]=[a,c]}return[r,o]}var Be=(t,e,n)=>t>>>n,_e=(t,e,n)=>t<<32-n|e>>>n,Ut=(t,e,n)=>t>>>n|e<<32-n,Kt=(t,e,n)=>t<<32-n|e>>>n,Zt=(t,e,n)=>t<<64-n|e>>>n-32,Gt=(t,e,n)=>t>>>n-32|e<<64-n;function st(t,e,n,r){let o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}var wn=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),yn=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,xn=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),mn=(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,bn=(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0),En=(t,e,n,r,o,s)=>e+n+r+o+s+(t/2**32|0)|0;var Lr=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gt=new Uint32Array(64),Te=class extends zt{constructor(e=32){super(64,e,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:a,G:c,H:i}=this;return[e,n,r,o,s,a,c,i]}set(e,n,r,o,s,a,c,i){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=c|0,this.H=i|0}process(e,n){for(let u=0;u<16;u++,n+=4)gt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let d=gt[u-15],w=gt[u-2],b=Q(d,7)^Q(d,18)^d>>>3,h=Q(w,17)^Q(w,19)^w>>>10;gt[u]=h+gt[u-7]+b+gt[u-16]|0}let{A:r,B:o,C:s,D:a,E:c,F:i,G:l,H:f}=this;for(let u=0;u<64;u++){let d=Q(c,6)^Q(c,11)^Q(c,25),w=f+d+dn(c,i,l)+Lr[u]+gt[u]|0,h=(Q(r,2)^Q(r,13)^Q(r,22))+hn(r,o,s)|0;f=l,l=i,i=c,c=a+w|0,a=s,s=o,o=r,r=w+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,c=c+this.E|0,i=i+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,a,c,i,l,f)}roundClean(){Lt(gt)}destroy(){this.set(0,0,0,0,0,0,0,0),Lt(this.buffer)}};var In=pn(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Ur=In[0],Kr=In[1],pt=new Uint32Array(80),wt=new Uint32Array(80),ke=class extends zt{constructor(e=64){super(128,e,16,!1),this.Ah=R[0]|0,this.Al=R[1]|0,this.Bh=R[2]|0,this.Bl=R[3]|0,this.Ch=R[4]|0,this.Cl=R[5]|0,this.Dh=R[6]|0,this.Dl=R[7]|0,this.Eh=R[8]|0,this.El=R[9]|0,this.Fh=R[10]|0,this.Fl=R[11]|0,this.Gh=R[12]|0,this.Gl=R[13]|0,this.Hh=R[14]|0,this.Hl=R[15]|0}get(){let{Ah:e,Al:n,Bh:r,Bl:o,Ch:s,Cl:a,Dh:c,Dl:i,Eh:l,El:f,Fh:u,Fl:d,Gh:w,Gl:b,Hh:h,Hl:p}=this;return[e,n,r,o,s,a,c,i,l,f,u,d,w,b,h,p]}set(e,n,r,o,s,a,c,i,l,f,u,d,w,b,h,p){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=a|0,this.Dh=c|0,this.Dl=i|0,this.Eh=l|0,this.El=f|0,this.Fh=u|0,this.Fl=d|0,this.Gh=w|0,this.Gl=b|0,this.Hh=h|0,this.Hl=p|0}process(e,n){for(let A=0;A<16;A++,n+=4)pt[A]=e.getUint32(n),wt[A]=e.getUint32(n+=4);for(let A=16;A<80;A++){let x=pt[A-15]|0,H=wt[A-15]|0,bt=Ut(x,H,1)^Ut(x,H,8)^Be(x,H,7),dt=Kt(x,H,1)^Kt(x,H,8)^_e(x,H,7),$=pt[A-2]|0,j=wt[A-2]|0,Et=Ut($,j,19)^Zt($,j,61)^Be($,j,6),It=Kt($,j,19)^Gt($,j,61)^_e($,j,6),Ct=xn(dt,It,wt[A-7],wt[A-16]),At=mn(Ct,bt,Et,pt[A-7],pt[A-16]);pt[A]=At|0,wt[A]=Ct|0}let{Ah:r,Al:o,Bh:s,Bl:a,Ch:c,Cl:i,Dh:l,Dl:f,Eh:u,El:d,Fh:w,Fl:b,Gh:h,Gl:p,Hh:I,Hl:L}=this;for(let A=0;A<80;A++){let x=Ut(u,d,14)^Ut(u,d,18)^Zt(u,d,41),H=Kt(u,d,14)^Kt(u,d,18)^Gt(u,d,41),bt=u&w^~u&h,dt=d&b^~d&p,$=bn(L,H,dt,Kr[A],wt[A]),j=En($,I,x,bt,Ur[A],pt[A]),Et=$|0,It=Ut(r,o,28)^Zt(r,o,34)^Zt(r,o,39),Ct=Kt(r,o,28)^Gt(r,o,34)^Gt(r,o,39),At=r&s^r&c^s&c,Ie=o&a^o&i^a&i;I=h|0,L=p|0,h=w|0,p=b|0,w=u|0,b=d|0,{h:u,l:d}=st(l|0,f|0,j|0,Et|0),l=c|0,f=i|0,c=s|0,i=a|0,s=r|0,a=o|0;let oe=wn(Et,Ct,Ie);r=yn(oe,j,It,At),o=oe|0}({h:r,l:o}=st(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:a}=st(this.Bh|0,this.Bl|0,s|0,a|0),{h:c,l:i}=st(this.Ch|0,this.Cl|0,c|0,i|0),{h:l,l:f}=st(this.Dh|0,this.Dl|0,l|0,f|0),{h:u,l:d}=st(this.Eh|0,this.El|0,u|0,d|0),{h:w,l:b}=st(this.Fh|0,this.Fl|0,w|0,b|0),{h,l:p}=st(this.Gh|0,this.Gl|0,h|0,p|0),{h:I,l:L}=st(this.Hh|0,this.Hl|0,I|0,L|0),this.set(r,o,s,a,c,i,l,f,u,d,w,b,h,p,I,L)}roundClean(){Lt(pt,wt)}destroy(){Lt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Le=ve(()=>new Te);var An=ve(()=>new ke);var Oe=BigInt(0),Ke=BigInt(1);function Ne(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Re(t){if(!Ne(t))throw new Error("Uint8Array expected")}function fe(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function vn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Oe:BigInt("0x"+t)}var Bn=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Or=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function de(t){if(Re(t),Bn)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Or[t[n]];return e}var lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Sn(t){if(t>=lt._0&&t<=lt._9)return t-lt._0;if(t>=lt.A&&t<=lt.F)return t-(lt.A-10);if(t>=lt.a&&t<=lt.f)return t-(lt.a-10)}function _n(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Bn)return Uint8Array.fromHex(t);let e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let a=Sn(t.charCodeAt(s)),c=Sn(t.charCodeAt(s+1));if(a===void 0||c===void 0){let i=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+i+'" at index '+s)}r[o]=a*16+c}return r}function Tn(t){return vn(de(t))}function Pt(t){return Re(t),vn(de(Uint8Array.from(t).reverse()))}function He(t,e){return _n(t.toString(16).padStart(e*2,"0"))}function $t(t,e){return He(t,e).reverse()}function tt(t,e,n){let r;if(typeof e=="string")try{r=_n(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ne(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return r}function Ce(...t){let e=0;for(let r=0;r<t.length;r++){let o=t[r];Re(o),e+=o.length}let n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){let s=t[r];n.set(s,o),o+=s.length}return n}var Ue=t=>typeof t=="bigint"&&Oe<=t;function Nr(t,e,n){return Ue(t)&&Ue(e)&&Ue(n)&&e<=t&&t<n}function Dt(t,e,n,r){if(!Nr(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function kn(t){let e;for(e=0;t>Oe;t>>=Ke,e+=1);return e}var jt=t=>(Ke<<BigInt(t))-Ke;var Rr={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ne(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Mt(t,e,n={}){let r=(o,s,a)=>{let c=Rr[s];if(typeof c!="function")throw new Error("invalid validator function");let i=t[o];if(!(a&&i===void 0)&&!c(i,t))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+i)};for(let[o,s]of Object.entries(e))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return t}function Pe(t){let e=new WeakMap;return(n,...r)=>{let o=e.get(n);if(o!==void 0)return o;let s=t(n,...r);return e.set(n,s),s}}var q=BigInt(0),P=BigInt(1),Ot=BigInt(2),Hr=BigInt(3),Kn=BigInt(4),On=BigInt(5),Nn=BigInt(8);function U(t,e){let n=t%e;return n>=q?n:e+n}function et(t,e,n){let r=t;for(;e-- >q;)r*=r,r%=n;return r}function Ln(t,e){if(t===q)throw new Error("invert: expected non-zero number");if(e<=q)throw new Error("invert: expected positive modulus, got "+e);let n=U(t,e),r=e,o=q,s=P,a=P,c=q;for(;n!==q;){let l=r/n,f=r%n,u=o-a*l,d=s-c*l;r=n,n=f,o=a,s=c,a=u,c=d}if(r!==P)throw new Error("invert: does not exist");return U(o,e)}function Rn(t,e){let n=(t.ORDER+P)/Kn,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function Cr(t,e){let n=(t.ORDER-On)/Nn,r=t.mul(e,Ot),o=t.pow(r,n),s=t.mul(e,o),a=t.mul(t.mul(s,Ot),o),c=t.mul(s,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),e))throw new Error("Cannot find square root");return c}function Pr(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-P,n=0;for(;e%Ot===q;)e/=Ot,n++;let r=Ot,o=Yt(t);for(;Un(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Rn;let s=o.pow(r,e),a=(e+P)/Ot;return function(i,l){if(i.is0(l))return l;if(Un(i,l)!==1)throw new Error("Cannot find square root");let f=n,u=i.mul(i.ONE,s),d=i.pow(l,e),w=i.pow(l,a);for(;!i.eql(d,i.ONE);){if(i.is0(d))return i.ZERO;let b=1,h=i.sqr(d);for(;!i.eql(h,i.ONE);)if(b++,h=i.sqr(h),b===f)throw new Error("Cannot find square root");let p=P<<BigInt(f-b-1),I=i.pow(u,p);f=b,u=i.sqr(I),d=i.mul(d,u),w=i.mul(w,I)}return w}}function Dr(t){return t%Kn===Hr?Rn:t%Nn===On?Cr:Pr(t)}var Hn=(t,e)=>(U(t,e)&P)===P,Mr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Cn(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Mr.reduce((r,o)=>(r[o]="function",r),e);return Mt(t,n)}function Wr(t,e,n){if(n<q)throw new Error("invalid exponent, negatives unsupported");if(n===q)return t.ONE;if(n===P)return e;let r=t.ONE,o=e;for(;n>q;)n&P&&(r=t.mul(r,o)),o=t.sqr(o),n>>=P;return r}function he(t,e,n=!1){let r=new Array(e.length).fill(n?t.ZERO:void 0),o=e.reduce((a,c,i)=>t.is0(c)?a:(r[i]=a,t.mul(a,c)),t.ONE),s=t.inv(o);return e.reduceRight((a,c,i)=>t.is0(c)?a:(r[i]=t.mul(a,r[i]),t.mul(a,c)),s),r}function Un(t,e){let n=(t.ORDER-P)/Ot,r=t.pow(e,n),o=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),a=t.eql(r,t.neg(t.ONE));if(!o&&!s&&!a)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function De(t,e){e!==void 0&&an(e);let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Yt(t,e,n=!1,r={}){if(t<=q)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:o,nByteLength:s}=De(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a,c=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:s,MASK:jt(o),ZERO:q,ONE:P,create:i=>U(i,t),isValid:i=>{if(typeof i!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof i);return q<=i&&i<t},is0:i=>i===q,isOdd:i=>(i&P)===P,neg:i=>U(-i,t),eql:(i,l)=>i===l,sqr:i=>U(i*i,t),add:(i,l)=>U(i+l,t),sub:(i,l)=>U(i-l,t),mul:(i,l)=>U(i*l,t),pow:(i,l)=>Wr(c,i,l),div:(i,l)=>U(i*Ln(l,t),t),sqrN:i=>i*i,addN:(i,l)=>i+l,subN:(i,l)=>i-l,mulN:(i,l)=>i*l,inv:i=>Ln(i,t),sqrt:r.sqrt||(i=>(a||(a=Dr(t)),a(c,i))),toBytes:i=>n?$t(i,s):He(i,s),fromBytes:i=>{if(i.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+i.length);return n?Pt(i):Tn(i)},invertBatch:i=>he(c,i),cmov:(i,l,f)=>f?l:i});return Object.freeze(c)}var Pn=BigInt(0),Fe=BigInt(1);function Me(t,e){let n=e.negate();return t?n:e}function Mn(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function We(t,e){Mn(t,e);let n=Math.ceil(e/t)+1,r=2**(t-1),o=2**t,s=jt(t),a=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:a}}function Dn(t,e,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:a}=n,c=Number(t&o),i=t>>a;c>r&&(c-=s,i+=Fe);let l=e*r,f=l+Math.abs(c)-1,u=c===0,d=c<0,w=e%2!==0;return{nextN:i,offset:f,isZero:u,isNeg:d,isNegF:w,offsetF:l}}function qr(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function Vr(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}var qe=new WeakMap,Wn=new WeakMap;function Ve(t){return Wn.get(t)||1}function qn(t,e){return{constTimeNegate:Me,hasPrecomputes(n){return Ve(n)!==1},unsafeLadder(n,r,o=t.ZERO){let s=n;for(;r>Pn;)r&Fe&&(o=o.add(s)),s=s.double(),r>>=Fe;return o},precomputeWindow(n,r){let{windows:o,windowSize:s}=We(r,e),a=[],c=n,i=c;for(let l=0;l<o;l++){i=c,a.push(i);for(let f=1;f<s;f++)i=i.add(c),a.push(i);c=i.double()}return a},wNAF(n,r,o){let s=t.ZERO,a=t.BASE,c=We(n,e);for(let i=0;i<c.windows;i++){let{nextN:l,offset:f,isZero:u,isNeg:d,isNegF:w,offsetF:b}=Dn(o,i,c);o=l,u?a=a.add(Me(w,r[b])):s=s.add(Me(d,r[f]))}return{p:s,f:a}},wNAFUnsafe(n,r,o,s=t.ZERO){let a=We(n,e);for(let c=0;c<a.windows&&o!==Pn;c++){let{nextN:i,offset:l,isZero:f,isNeg:u}=Dn(o,c,a);if(o=i,!f){let d=r[l];s=s.add(u?d.negate():d)}}return s},getPrecomputes(n,r,o){let s=qe.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&qe.set(r,o(s))),s},wNAFCached(n,r,o){let s=Ve(n);return this.wNAF(s,this.getPrecomputes(s,n,o),r)},wNAFCachedUnsafe(n,r,o,s){let a=Ve(n);return a===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(a,this.getPrecomputes(a,n,o),r,s)},setWindowSize(n,r){Mn(r,e),Wn.set(n,r),qe.delete(n)}}}function Vn(t,e,n,r){qr(n,t),Vr(r,e);let o=n.length,s=r.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let a=t.ZERO,c=kn(BigInt(o)),i=1;c>12?i=c-3:c>4?i=c-2:c>0&&(i=2);let l=jt(i),f=new Array(Number(l)+1).fill(a),u=Math.floor((e.BITS-1)/i)*i,d=a;for(let w=u;w>=0;w-=i){f.fill(a);for(let h=0;h<s;h++){let p=r[h],I=Number(p>>BigInt(w)&l);f[I]=f[I].add(n[h])}let b=a;for(let h=f.length-1,p=a;h>0;h--)p=p.add(f[h]),b=b.add(p);if(d=d.add(b),w!==0)for(let h=0;h<i;h++)d=d.double()}return d}function Fn(t){return Cn(t.Fp),Mt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...De(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}var it=BigInt(0),V=BigInt(1),zn=BigInt(2),Fr=BigInt(8),zr={zip215:!0};function Zr(t){let e=Fn(t);return Mt(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Zn(t){let e=Zr(t),{Fp:n,n:r,prehash:o,hash:s,randomBytes:a,nByteLength:c,h:i}=e,l=zn<<BigInt(c*8)-V,f=n.create,u=Yt(e.n,e.nBitLength);function d(E,g){let y=n.sqr(E),m=n.sqr(g),S=n.add(n.mul(e.a,y),m),v=n.add(n.ONE,n.mul(e.d,n.mul(y,m)));return n.eql(S,v)}if(!d(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let w=e.uvRatio||((E,g)=>{try{return{isValid:!0,value:n.sqrt(E*n.inv(g))}}catch{return{isValid:!1,value:it}}}),b=e.adjustScalarBytes||(E=>E),h=e.domain||((E,g,y)=>{if(fe("phflag",y),g.length||y)throw new Error("Contexts/pre-hash are not supported");return E});function p(E,g,y=!1){let m=y?V:it;Dt("coordinate "+E,g,m,l)}function I(E){if(!(E instanceof x))throw new Error("ExtendedPoint expected")}let L=Pe((E,g)=>{let{ex:y,ey:m,ez:S}=E,v=E.is0();g==null&&(g=v?Fr:n.inv(S));let k=f(y*g),N=f(m*g),T=f(S*g);if(v)return{x:it,y:V};if(T!==V)throw new Error("invZ was invalid");return{x:k,y:N}}),A=Pe(E=>{let{a:g,d:y}=e;if(E.is0())throw new Error("bad point: ZERO");let{ex:m,ey:S,ez:v,et:k}=E,N=f(m*m),T=f(S*S),O=f(v*v),C=f(O*O),z=f(N*g),nt=f(O*f(z+T)),rt=f(C+f(y*f(N*T)));if(nt!==rt)throw new Error("bad point: equation left != right (1)");let Y=f(m*S),ht=f(v*k);if(Y!==ht)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(g,y,m,S){p("x",g),p("y",y),p("z",m,!0),p("t",S),this.ex=g,this.ey=y,this.ez=m,this.et=S,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(g){if(g instanceof x)throw new Error("extended point not allowed");let{x:y,y:m}=g||{};return p("x",y),p("y",m),new x(y,m,V,f(y*m))}static normalizeZ(g){let y=he(n,g.map(m=>m.ez));return g.map((m,S)=>m.toAffine(y[S])).map(x.fromAffine)}static msm(g,y){return Vn(x,u,g,y)}_setWindowSize(g){dt.setWindowSize(this,g)}assertValidity(){A(this)}equals(g){I(g);let{ex:y,ey:m,ez:S}=this,{ex:v,ey:k,ez:N}=g,T=f(y*N),O=f(v*S),C=f(m*N),z=f(k*S);return T===O&&C===z}is0(){return this.equals(x.ZERO)}negate(){return new x(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){let{a:g}=e,{ex:y,ey:m,ez:S}=this,v=f(y*y),k=f(m*m),N=f(zn*f(S*S)),T=f(g*v),O=y+m,C=f(f(O*O)-v-k),z=T+k,nt=z-N,rt=T-k,Y=f(C*nt),ht=f(z*rt),St=f(C*rt),se=f(nt*z);return new x(Y,ht,se,St)}add(g){I(g);let{a:y,d:m}=e,{ex:S,ey:v,ez:k,et:N}=this,{ex:T,ey:O,ez:C,et:z}=g,nt=f(S*T),rt=f(v*O),Y=f(N*m*z),ht=f(k*C),St=f((S+v)*(T+O)-nt-rt),se=ht-Y,en=ht+Y,nn=f(rt-y*nt),fr=f(St*se),dr=f(en*nn),hr=f(St*nn),gr=f(se*en);return new x(fr,dr,gr,hr)}subtract(g){return this.add(g.negate())}wNAF(g){return dt.wNAFCached(this,g,x.normalizeZ)}multiply(g){let y=g;Dt("scalar",y,V,r);let{p:m,f:S}=this.wNAF(y);return x.normalizeZ([m,S])[0]}multiplyUnsafe(g,y=x.ZERO){let m=g;return Dt("scalar",m,it,r),m===it?bt:this.is0()||m===V?this:dt.wNAFCachedUnsafe(this,m,x.normalizeZ,y)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return dt.unsafeLadder(this,r).is0()}toAffine(g){return L(this,g)}clearCofactor(){let{h:g}=e;return g===V?this:this.multiplyUnsafe(g)}static fromHex(g,y=!1){let{d:m,a:S}=e,v=n.BYTES;g=tt("pointHex",g,v),fe("zip215",y);let k=g.slice(),N=g[v-1];k[v-1]=N&-129;let T=Pt(k),O=y?l:n.ORDER;Dt("pointHex.y",T,it,O);let C=f(T*T),z=f(C-V),nt=f(m*C-S),{isValid:rt,value:Y}=w(z,nt);if(!rt)throw new Error("Point.fromHex: invalid y coordinate");let ht=(Y&V)===V,St=(N&128)!==0;if(!y&&Y===it&&St)throw new Error("Point.fromHex: x=0 and x_0=1");return St!==ht&&(Y=f(-Y)),x.fromAffine({x:Y,y:T})}static fromPrivateKey(g){let{scalar:y}=Et(g);return H.multiply(y)}toRawBytes(){let{x:g,y}=this.toAffine(),m=$t(y,n.BYTES);return m[m.length-1]|=g&V?128:0,m}toHex(){return de(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,V,f(e.Gx*e.Gy)),x.ZERO=new x(it,V,V,it);let{BASE:H,ZERO:bt}=x,dt=qn(x,c*8);function $(E){return U(E,r)}function j(E){return $(Pt(E))}function Et(E){let g=n.BYTES;E=tt("private key",E,g);let y=tt("hashed private key",s(E),2*g),m=b(y.slice(0,g)),S=y.slice(g,2*g),v=j(m);return{head:m,prefix:S,scalar:v}}function It(E){let{head:g,prefix:y,scalar:m}=Et(E),S=H.multiply(m),v=S.toRawBytes();return{head:g,prefix:y,scalar:m,point:S,pointBytes:v}}function Ct(E){return It(E).pointBytes}function At(E=Uint8Array.of(),...g){let y=Ce(...g);return j(s(h(y,tt("context",E),!!o)))}function Ie(E,g,y={}){E=tt("message",E),o&&(E=o(E));let{prefix:m,scalar:S,pointBytes:v}=It(g),k=At(y.context,m,E),N=H.multiply(k).toRawBytes(),T=At(y.context,N,v,E),O=$(k+T*S);Dt("signature.s",O,it,r);let C=Ce(N,$t(O,n.BYTES));return tt("result",C,n.BYTES*2)}let oe=zr;function ur(E,g,y,m=oe){let{context:S,zip215:v}=m,k=n.BYTES;E=tt("signature",E,2*k),g=tt("message",g),y=tt("publicKey",y,k),v!==void 0&&fe("zip215",v),o&&(g=o(g));let N=Pt(E.slice(k,2*k)),T,O,C;try{T=x.fromHex(y,v),O=x.fromHex(E.slice(0,k),v),C=H.multiplyUnsafe(N)}catch{return!1}if(!v&&T.isSmallOrder())return!1;let z=At(S,O.toRawBytes(),T.toRawBytes(),g);return O.add(T.multiplyUnsafe(z)).subtract(C).clearCofactor().equals(x.ZERO)}return H._setWindowSize(8),{CURVE:e,getPublicKey:Ct,sign:Ie,verify:ur,ExtendedPoint:x,utils:{getExtendedPublicKey:It,randomPrivateKey:()=>a(n.BYTES),precompute(E=8,g=x.BASE){return g._setWindowSize(E),g.multiply(BigInt(3)),g}}}}var ze=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Gn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),vs=BigInt(0),Gr=BigInt(1),$n=BigInt(2),Bs=BigInt(3),$r=BigInt(5),jr=BigInt(8);function Yr(t){let e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=ze,c=t*t%s*t%s,i=et(c,$n,s)*c%s,l=et(i,Gr,s)*t%s,f=et(l,$r,s)*l%s,u=et(f,e,s)*f%s,d=et(u,n,s)*u%s,w=et(d,r,s)*d%s,b=et(w,o,s)*w%s,h=et(b,o,s)*w%s,p=et(h,e,s)*f%s;return{pow_p_5_8:et(p,$n,s)*t%s,b2:c}}function Jr(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Xr(t,e){let n=ze,r=U(e*e*e,n),o=U(r*r*e,n),s=Yr(t*o).pow_p_5_8,a=U(t*r*s,n),c=U(e*a*a,n),i=a,l=U(a*Gn,n),f=c===t,u=c===U(-t,n),d=c===U(-t*Gn,n);return f&&(a=i),(u||d)&&(a=l),Hn(a,n)&&(a=U(-a,n)),{isValid:f||u,value:a}}var jn=Yt(ze,void 0,!0),Qr={a:jn.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:jn,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:jr,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:An,randomBytes:fn,adjustScalarBytes:Jr,uvRatio:Xr},Ze=Zn(Qr);var eo=Object.defineProperty,X=(t,e)=>eo(t,"name",{value:e,configurable:!0}),no="https://wallet.intear.tech",ro="https://logout-bridge-service.intear.tech",Qt="_intear_wallet_connected_account",Yn="width=400,height=700",Jn=!1,Jt=null,Ge=!1,K=class extends Error{constructor(e,n){super(e),this.cause=n,this.name="IntearAdapterError",n&&(this.stack+=`
Caused by: ${n instanceof Error?n.stack:String(n)}`)}static{X(this,"IntearAdapterError")}},ut=class t{static{X(this,"LogoutWebSocket")}static instance=null;ws=null;network;accountId;appPrivateKey;userLogoutPublicKey;logoutBridgeServiceUrl;intentionallyClosed=!1;reconnectAttempts=0;maxReconnectAttempts=3;logger;constructor(e,n,r,o,s,a){this.network=e,this.accountId=n,this.appPrivateKey=r,this.userLogoutPublicKey=o,this.logoutBridgeServiceUrl=s,this.logger=a,this.connect()}async connect(){try{let e=this.logoutBridgeServiceUrl.replace("https://","wss://").replace("http://","ws://");this.ws=new WebSocket(`${e}/api/subscribe`),this.ws.onopen=async()=>{if(!this.ws)return;let n=Date.now(),r=`subscribe|${n}`,o=new TextEncoder().encode(r),s=J(this.appPrivateKey),c=`ed25519:${ye(o,this.appPrivateKey,{returnBase58:!0})}`,i={Auth:{network:this.network,account_id:this.accountId,app_public_key:s,nonce:n,signature:c}};this.ws.send(JSON.stringify(i))},this.ws.onmessage=async n=>{let r=JSON.parse(n.data);if("Success"in r)this.logger.log("LogoutWebSocket:",r.Success.message),this.reconnectAttempts=0;else if("Error"in r)this.logger.error("LogoutWebSocket error:",r.Error.message),this.ws?.close();else if("LoggedOut"in r){let{logout_info:o}=r.LoggedOut;if(this.logger.log("LogoutWebSocket: Received logout notification:",o),o.nonce>Date.now()||o.nonce<Date.now()-1e3*60*5){this.logger.error("LogoutWebSocket: Invalid logout nonce:",o.nonce);return}let s=J(this.appPrivateKey),a=`logout|${o.nonce}|${this.accountId}|${s}`,c=new TextEncoder().encode(a),i=o.signature.split(":");if(i.length!==2||i[0]!=="ed25519"&&i[0]!=="secp256k1"){this.logger.error("LogoutWebSocket: Invalid signature format:",o.signature);return}let l=i[1],f=ge(l),u;if(o.caused_by==="User")u=this.userLogoutPublicKey;else if(o.caused_by==="App")u=s;else{this.logger.error("LogoutWebSocket: Unknown logout cause:",o.caused_by);return}let d,w=u.substring(8);if(d=ge(w),!Ze.verify(f,c,d)){this.logger.error("LogoutWebSocket: Invalid logout signature");return}this.logger.log("LogoutWebSocket: Valid logout message received. Calling signOut and reloading."),xe(),this.intentionallyClosed=!0,this.close(),window.location.reload()}},this.ws.onclose=()=>{this.logger.log("LogoutWebSocket: Connection closed."),this.intentionallyClosed?t.instance===this&&(t.instance=null):this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,this.logger.log(`LogoutWebSocket: Attempting to reconnect in 500ms... (Attempt ${this.reconnectAttempts} of ${this.maxReconnectAttempts})`),setTimeout(()=>this.connect(),500)):(this.logger.warn(`LogoutWebSocket: Maximum reconnection attempts (${this.maxReconnectAttempts}) reached. Giving up.`),t.instance===this&&(t.instance=null))},this.ws.onerror=n=>{this.logger.warn("LogoutWebSocket: Error:",n),this.intentionallyClosed?t.instance=null:this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,this.logger.log(`LogoutWebSocket: Attempting to reconnect in 500ms... (Attempt ${this.reconnectAttempts} of ${this.maxReconnectAttempts})`),setTimeout(()=>this.connect(),500)):(this.logger.warn(`LogoutWebSocket: Maximum reconnection attempts (${this.maxReconnectAttempts}) reached. Giving up.`),t.instance===this&&(t.instance=null))}}catch(e){this.logger.warn("LogoutWebSocket: Error creating WebSocket connection:",e)}}static initialize(e,n,r,o,s,a){try{return t.instance||(t.instance=new t(e,n,r,o,s,a)),t.instance}catch(c){return a.warn("LogoutWebSocket: Failed to initialize:",c),null}}static getInstance(){return t.instance}close(){this.ws&&(this.intentionallyClosed=!0,this.ws.close()),t.instance=null}};async function Wt(t,e,n){let r=n.toString()+"|"+e,o=new TextEncoder().encode(r),s=Le(o);return`ed25519:${ye(s,t,{returnBase58:!0})}`}X(Wt,"generateAuthSignature");function pe(){if(typeof window>"u")throw new K("Cannot access localStorage in this environment.");let t=window.localStorage.getItem(Qt);if(!t)throw new K("Not signed in (no data found)");try{let e=JSON.parse(t);if(!e||!e.accounts||e.accounts.length===0||!e.key)throw new Error("Invalid saved data structure");return e}catch(e){throw console.error("Error parsing saved login data, clearing storage.",e),window.localStorage.removeItem(Qt),new K("Failed to parse login data, please sign in again.",e)}}X(pe,"assertLoggedIn");function Xt(){try{return pe()}catch{return null}}X(Xt,"getSavedData");function Xn(t,e,n,r){try{let o=`logout|${t.nonce}|${e}|${n}`,s=t.signature.split(":");if(s.length!==2||s[0]!=="ed25519"&&s[0]!=="secp256k1")return console.error("WalletAdapter: Invalid signature format:",t.signature),!1;let a=s[1],c=ge(a),i;if(t.caused_by==="User")i=r;else if(t.caused_by==="App")i=n;else return console.error("WalletAdapter: Unknown logout cause:",t.caused_by),!1;let l=i.substring(8),f=ge(l);return Ze.verify(c,new TextEncoder().encode(o),f)}catch(o){return console.error("WalletAdapter: Error verifying logout signature:",o),!1}}X(Xn,"verifyLogoutSignature");async function $e(t,e,n){try{let r=t.accounts[0],o=t.networkId,s=t.key,a=J(s);ut.initialize(o,r.accountId,s,t.logoutKey,e,console);let c=Date.now(),i=`check|${c}`,l=new TextEncoder().encode(i),u=`ed25519:${ye(l,s,{returnBase58:!0})}`,d=await fetch(`${e}/api/check_logout/${o}/${r.accountId}/${a}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({nonce:c,signature:u})});if(!d.ok)return console.warn("WalletAdapter: Failed to check logout status:",await d.text()),{isActive:!0,accounts:t.accounts};let w=await d.json();if(console.debug("WalletAdapter: Logout check response:",w),w==="Active")return{isActive:!0,accounts:t.accounts};{let b=w.LoggedOut;return console.debug("WalletAdapter: User was logged out:",b),Xn(b,r.accountId,a,t.logoutKey)?(console.debug("WalletAdapter: Valid remote logout. Clearing local session."),window.localStorage.removeItem(Qt),ut.getInstance()?.close(),n?.({accountId:null,networkId:null,publicKey:null}),{isActive:!1,accounts:[]}):(console.error("WalletAdapter: Invalid logout signature"),{isActive:!0,accounts:t.accounts})}}catch(r){return console.error("WalletAdapter: Error verifying session status:",r),{isActive:!0,accounts:t.accounts}}}X($e,"verifySessionStatus");var we=class{static{X(this,"WalletAdapter")}#t;#e;#n;constructor({walletUrl:e=no,targetOrigin:n,onStateUpdate:r,lastState:o,callbackUrl:s,logoutBridgeService:a=ro}){this.#t=e,this.#e=a,this.#n=r,console.debug("Intear Popup WalletAdapter initialized. URL:",this.#t),typeof window<"u"&&this.initializeSession().catch(c=>{console.error("Error during initial session initialization:",c)})}async signIn({contractId:e,methodNames:n,networkId:r,callbacks:o}){console.debug("WalletAdapter: signIn",{contractId:e,methodNames:n,networkId:r});let{onPending:s,onError:a,timeout:c=6e4}=o||{},i=to();return new Promise((l,f)=>{s?.({step:"popup_opening",networkId:r,contractId:e});let u=new Promise(h=>{let p=null,I=setInterval(()=>{p&&(clearInterval(I),h(p))},100),L=X(A=>{A.data.origin&&(p=A.data.origin,window.removeEventListener("message",L))},"listener");window.addEventListener("message",L)}),d=document.createElement("iframe");d.src=`${this.#t}/wallet-connector-iframe.html`,d.style.position="fixed",d.style.inset="0",d.style.width="100vw",d.style.height="100vh",d.style.border="none",d.style.zIndex="100000",document.body.appendChild(d),d.onload=()=>{u.then(h=>{d.contentWindow?.postMessage({type:"hotConnectorData",origin:h,location:window.selector.location},"*")})};let w=null,b=X(async h=>{if(h.data.status){d.contentWindow?.postMessage(h.data,"*");return}switch(console.debug("Message from connect popup",h.data),h.data.type){case"ready":{let p=location.origin||"file://local-html-file",I=JSON.stringify({origin:p}),L=Date.now(),A=await Wt(i,I,L),x=J(i);d.contentWindow?.postMessage({type:"signIn",data:{contractId:e,methodNames:n,publicKey:x,networkId:r,nonce:L,message:I,signature:A,version:"V2"}},"*");break}case"connected":{s?.({step:"processing_result",networkId:r,contractId:e});let p=h.data.accounts;if(!p||p.length===0){let bt={type:"wallet_error",message:"No accounts returned from wallet",retryable:!0,suggestedAction:"retry",timestamp:Date.now()};return a?.(bt),f(new K("No accounts returned from wallet"))}let I=h.data.functionCallKeyAdded,L=h.data.logoutKey,A=h.data.useBridge,x={accounts:p,key:i,contractId:I&&e?e:"",methodNames:I?n??[]:[],logoutKey:L,networkId:r,walletUrl:h.data.walletUrl,useBridge:A};console.log("dataToSave",x,"event.data",h.data),window.localStorage.setItem(Qt,JSON.stringify(x)),w={accountId:p[0].accountId,accounts:p,privateKey:x.key,publicKey:J(x.key)},d.contentWindow?.postMessage({type:"close"},"*");let H={accountId:p[0].accountId,networkId:r,privateKey:x.key,publicKey:J(x.key)};this.#n?.(H),ut.getInstance()?.close(),ut.initialize(x.networkId,x.accounts[0].accountId,x.key,x.logoutKey,this.#e,console);break}case"error":{console.error("Error from connect popup",h.data.message),d.contentWindow?.postMessage({type:"close",message:h.data.message},this.#t);break}case"close":if(window.removeEventListener("message",b),d.remove(),h.data.message){let p=h.data.message||"Unknown error from wallet popup",I={type:"wallet_error",message:p,retryable:!0,suggestedAction:"contact_support",originalError:h.data,timestamp:Date.now()};a?.(I),f(new K(p));break}else w?l(w):(console.error("No result and no error"),f(new K("No result and no error")))}},"listener");window.addEventListener("message",b),s?.({step:"waiting_for_user",networkId:r,contractId:e})})}async signOut(){console.debug("WalletAdapter: signOut");let e=Xt();if(ut.getInstance()?.close(),e)try{let n=e.accounts[0].accountId,r=e.key,o=J(r),s=e.networkId,a=Date.now(),c=`logout|${a}|${n}|${o}`,i=new TextEncoder().encode(c),l=Le(i),u=`ed25519:${ye(l,r,{returnBase58:!0})}`,d=await fetch(`${this.#e}/api/logout_app/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:n,app_public_key:o,nonce:a,signature:u})});d.ok?console.debug("WalletAdapter: Successfully notified bridge service of logout"):console.error("WalletAdapter: Failed to notify bridge service of logout:",await d.text())}catch(n){console.error("WalletAdapter: Error during bridge service logout notification:",n)}window.localStorage.removeItem(Qt),this.#n?.({accountId:null,networkId:null,publicKey:null})}async initializeSession(){if(!Ge){Ge=!0;try{let e=Xt();if(!e){ut.getInstance()?.close();return}await $e(e,this.#e,this.#n)}catch(e){console.error("WalletAdapter: Unexpected error during session initialization:",e),ut.getInstance()?.close()}finally{Ge=!1}}}getState(){let e=Xt();return e?{accountId:e.accounts[0].accountId,networkId:e.networkId,publicKey:J(e.key)}:{accountId:null,networkId:null,publicKey:null}}setState(e){this.#n?.(e)}async getAccounts(){console.debug("WalletAdapter: getAccounts");let e=Xt();return e?Jn?(console.debug("WalletAdapter: Accounts:",e.accounts),e.accounts):Jt?await Jt:(Jt=new Promise(async n=>{try{let r=await $e(e,this.#e,this.#n);n(r.accounts)}catch(r){console.error("WalletAdapter: Error in getAccounts:",r),n(e.accounts)}}).finally(()=>{Jt=null,Jn=!0}),await Jt):[]}async sendTransactions({transactions:e}){console.debug("WalletAdapter: sendTransactions",{transactions:e});let n=pe(),r=n.key,o=n.accounts[0].accountId;return n.useBridge?new Promise((s,a)=>{let c=this.#e.replace("https://","wss://").replace("http://","ws://"),i=new WebSocket(`${c}/api/session/create`);i.onopen=async()=>{console.debug("WebSocket connected for transactions");let f=JSON.stringify(e),u=Date.now(),d=await Wt(n.key,f,u);i.send(JSON.stringify({type:"signAndSendTransactions",data:{transactions:f,accountId:n.accounts[0].accountId,publicKey:J(n.key),nonce:u,signature:d}}))};let l=null;i.onmessage=f=>{try{let u=JSON.parse(f.data);if(u.session_id)l=u.session_id,console.debug("Received session ID for send-transactions:",l);else if(console.debug("Received send-transactions response:",u),i.close(),u.type==="error"){let d=u.message||"Unknown error from wallet popup";a(new K(d))}else s({outcomes:u.outcomes})}catch(u){console.error("Error parsing WebSocket message:",u),a(new K("Error parsing WebSocket message",u))}},i.onerror=f=>{console.error("WebSocket error:",f),a(new K("WebSocket error",f))},i.onclose=()=>{console.debug("WebSocket closed for send-transactions")},(async()=>{let u=`intear://send-transactions?session_id=${await new Promise(d=>{setInterval(()=>{l&&d(l)},100)})}`;console.debug("Opening wallet with URL:",u),window.open(u)})()}):new Promise(async(s,a)=>{let c=window.open(`${n.walletUrl??this.#t}/send-transactions`,"_blank",Yn);if(!c)return a(new K("Popup was blocked"));let i=!1,l=X(async u=>{if(!(!u.data||!u.data.type))switch(console.debug("Message from send-transactions popup",u.data),u.data.type){case"ready":{let d=JSON.stringify(e),w=Date.now(),b=await Wt(r,d,w),h=J(r);c.postMessage({type:"signAndSendTransactions",data:{transactions:d,accountId:o,publicKey:h,nonce:w,signature:b}},n.walletUrl??this.#t);break}case"sent":{i=!0,c.close(),window.removeEventListener("message",l),s({outcomes:u.data.outcomes});break}case"error":{i=!0,c.close(),window.removeEventListener("message",l),a(new K(u.data.message||"Unknown error from send-transactions popup"));break}}},"listener");window.addEventListener("message",l);let f=setInterval(()=>{c.closed&&(window.removeEventListener("message",l),clearInterval(f),i||a(new K("Transaction canceled - popup closed by user")))},100)})}async signMessage({message:e,nonce:n,recipient:r,callbackUrl:o,state:s}){console.debug("WalletAdapter: signMessage",{message:e,nonce:n,recipient:r});let a=pe(),c=a.key,i=a.accounts[0].accountId;return a.useBridge?new Promise((l,f)=>{let u=this.#e.replace("https://","wss://").replace("http://","ws://"),d=new WebSocket(`${u}/api/session/create`);d.onopen=async()=>{console.debug("WebSocket connected for sign-message");let b=JSON.stringify({message:e,recipient:r,nonce:Array.from(n),callbackUrl:o,state:s}),h=Date.now(),p=await Wt(c,b,h);d.send(JSON.stringify({type:"signMessage",data:{message:b,accountId:a.accounts[0].accountId,publicKey:J(c),nonce:h,signature:p}}))};let w=null;d.onmessage=b=>{try{let h=JSON.parse(b.data);if(h.session_id)w=h.session_id,console.debug("Received session ID for sign-message:",w);else if(console.debug("Received sign-message response:",h),d.close(),h.type==="error")f(new Error(h.message));else{console.log(JSON.stringify(h));let p=h.signature;try{l({accountId:p.accountId,publicKey:p.publicKey,signature:p.signature})}catch(I){f(new K("Failed to process signature from wallet",I))}}}catch(h){console.error("Error parsing WebSocket message:",h),f(new K("Error parsing WebSocket message",h))}},d.onerror=b=>{console.error("WebSocket error:",b),f(new K("WebSocket error",b))},d.onclose=()=>{console.debug("WebSocket closed for sign-message")},(async()=>{let h=`intear://sign-message?session_id=${await new Promise(p=>{setInterval(()=>{w&&p(w)},100)})}`;console.debug("Opening wallet with URL:",h),window.open(h,"_blank")})()}):new Promise(async(l,f)=>{let u=window.open(`${a.walletUrl??this.#t}/sign-message`,"_blank",Yn);if(!u)return f(new K("Popup was blocked"));let d=!1,w=X(async h=>{if(!(!h.data||!h.data.type))switch(console.debug("Message from sign-message popup",h.data),h.data.type){case"ready":{let p=JSON.stringify({message:e,recipient:r,nonce:Array.from(n),callbackUrl:o,state:s}),I=Date.now(),L=await Wt(c,p,I),A=J(c);u.postMessage({type:"signMessage",data:{message:p,accountId:i,publicKey:A,nonce:I,signature:L}},a.walletUrl??this.#t);break}case"signed":{d=!0,u.close(),window.removeEventListener("message",w);let p=h.data.signature;try{l({accountId:p.accountId,publicKey:p.publicKey,signature:p.signature})}catch(I){f(new K("Failed to process signature from wallet",I))}break}case"error":{d=!0,u.close(),window.removeEventListener("message",w),f(new K(h.data.message||"Unknown error from sign-message popup"));break}}},"listener");window.addEventListener("message",w);let b=setInterval(()=>{u.closed&&(window.removeEventListener("message",w),clearInterval(b),d||f(new K("Message signing canceled - popup closed by user")))},100)})}destroy(){console.debug("Intear Popup WalletAdapter destroyed.")}};var oo=Object.defineProperty,F=(t,e)=>oo(t,"name",{value:e,configurable:!0}),tr="https://wallet.intear.tech",er="mainnet",ee={testnet:{networkId:"testnet",nodeUrl:"https://rpc.testnet.fastnear.com/"},mainnet:{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.fastnear.com/"}},te=je("config")||{...ee[er]},_=je("state")||{},nr=F(t=>{let{accountId:e,lastWalletId:n,privateKey:r}=t,o=e||null;o!==_.accountId&&ct({accountId:o,lastWalletId:n||void 0,...r?{privateKey:r}:{}})},"onAdapterStateUpdate"),rr=F(()=>({publicKey:_.publicKey,accountId:_.accountId,lastWalletId:_.lastWalletId,networkId:te.networkId}),"getWalletAdapterState"),Nt=new we({onStateUpdate:nr,walletUrl:tr});try{_.publicKey=_.privateKey?Qn(_.privateKey):null}catch(t){console.error("Error parsing private key:",t),_.privateKey=null,qt("nonce",null)}var yt=je("txHistory")||{},ft={account:[],tx:[]},Z={_eventListeners:{account:new Set,tx:new Set},notifyAccountListeners:F(t=>{if(Z._eventListeners.account.size===0){ft.account.push(t);return}Z._eventListeners.account.forEach(e=>{try{e(t)}catch(n){console.error(n)}})},"notifyAccountListeners"),notifyTxListeners:F(t=>{if(Z._eventListeners.tx.size===0){ft.tx.push(t);return}Z._eventListeners.tx.forEach(e=>{try{e(t)}catch(n){console.error(n)}})},"notifyTxListeners"),onAccount:F(t=>{if(Z._eventListeners.account.add(t),ft.account.length>0){let e=ft.account;ft.account=[],e.forEach(Z.notifyAccountListeners)}return t},"onAccount"),onTx:F(t=>{if(Z._eventListeners.tx.add(t),ft.tx.length>0){let e=ft.tx;ft.tx=[],e.forEach(Z.notifyTxListeners)}return t},"onTx"),offAccount:F(t=>{Z._eventListeners.account.delete(t)},"offAccount"),offTx:F(t=>{Z._eventListeners.tx.delete(t)},"offTx")},ct=F(t=>{let e=_;_={..._,...t},qt("state",{accountId:_.accountId,privateKey:_.privateKey,lastWalletId:_.lastWalletId,accessKeyContractId:_.accessKeyContractId}),t.hasOwnProperty("privateKey")&&t.privateKey!==e.privateKey&&(_.publicKey=t.privateKey?Qn(t.privateKey):null,qt("nonce",null)),t.hasOwnProperty("accountId")&&t.accountId!==e.accountId&&Z.notifyAccountListeners(t.accountId),(t.hasOwnProperty("lastWalletId")&&t.lastWalletId!==e.lastWalletId||t.hasOwnProperty("accountId")&&t.accountId!==e.accountId||t.hasOwnProperty("privateKey")&&t.privateKey!==e.privateKey)&&Nt.setState(rr())},"update"),xt=F(t=>{let e=t.txId;yt[e]={...yt[e]||{},...t,updateTimestamp:Date.now()},qt("txHistory",yt),Z.notifyTxListeners(yt[e])},"updateTxHistory"),Rt=F(()=>te,"getConfig"),Ye=F(()=>yt,"getTxHistory"),me=F(t=>{te={...ee[t.networkId],...t},qt("config",te)},"setConfig"),Je=F(()=>{yt={},qt("txHistory",yt)},"resetTxHistory");var ao=Object.defineProperty,G=(t,e)=>ao(t,"name",{value:e,configurable:!0});cn.DP=27;var ei=1e3*60*60*6;function lo(t,e){return e==="final"||e==="optimistic"?{...t,finality:e}:e?{...t,block_id:e}:{...t,finality:"optimistic"}}G(lo,"withBlockId");async function Qe(t,e){let n=Rt();if(!n?.nodeUrl)throw new Error("fastnear: getConfig() returned invalid config: missing nodeUrl.");let o=await(await fetch(n.nodeUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:`fastnear-${Date.now()}`,method:t,params:e})})).json();if(o.error)throw new Error(JSON.stringify(o.error));return o}G(Qe,"sendRpc");function tn(t){let e=Ye();Qe("tx",{tx_hash:e[t]?.txHash,sender_account_id:e[t]?.tx?.signerId,wait_until:"EXECUTED_OPTIMISTIC"}).then(n=>{let r=n?.result?.status?.SuccessValue;xt({txId:t,status:"Executed",result:n,successValue:r?Xe(so(r)):void 0,finalState:!0})}).catch(n=>{xt({txId:t,status:"ErrorAfterIncluded",error:Xe(n.message)??n.message,finalState:!0})})}G(tn,"afterTxSent");async function uo(t,e,n){e=e||"INCLUDED";try{let r=await Qe("send_tx",{signed_tx_base64:t,wait_until:e});return xt({txId:n,status:"Included",finalState:!1}),tn(n),r}catch(r){let o=r instanceof Error?r.message:"Unknown error";throw xt({txId:n,status:"Error",error:Xe(o)??o,finalState:!1}),new Error(o)}}G(uo,"sendTxToRpc");function fo(){let t=crypto.getRandomValues(new Uint32Array(2)).join("");return`tx-${Date.now()}-${parseInt(t,10).toString(36)}`}G(fo,"generateTxId");var or=0,ho=6e4,Ht=G(()=>{let t=Date.now();return _.accountId&&t-or>ho&&(or=t,Nt.getAccounts().then(e=>{e.length===0&&_.accountId&&ct({accountId:null,privateKey:null,lastWalletId:null})}).catch(e=>{console.error("Error checking account status:",e)})),_.accountId},"accountId"),re=G(()=>_.publicKey,"publicKey"),mt=G(t=>{let e=Rt();return t&&(t.networkId&&e.networkId!==t.networkId&&(me({...ee[t.networkId],networkId:t.networkId}),ct({accountId:null,privateKey:null,lastWalletId:null}),ir("block",null),Je()),me({...Rt(),...t})),Rt()},"config"),sr=G(()=>_.accountId?"SignedIn":"SignedOut","authStatus");var cr=G(async(t={},e={})=>{let{contractId:n,methodNames:r}=t,{onSuccess:o,onError:s,timeout:a=6e4}=e,c=Rt().networkId,i=io("lastSignedInAccount"),l=!!i&&i!==_.accountId,f=co();ct({accessKeyContractId:n,privateKey:f});try{let u=await Nt.signIn({networkId:c,contractId:n,methodNames:r,callbacks:{onError:s?d=>{s(d)}:void 0,timeout:a}});if(u.error){let d={type:"wallet_error",message:u.error,retryable:!0,suggestedAction:"contact_support",originalError:u.error,timestamp:Date.now()};throw s?.(d),new Error(`Wallet error: ${u.error}`)}if(u.accountId){ir("lastSignedInAccount",u.accountId),ct({accountId:u.accountId,privateKey:u.privateKey,publicKey:u.publicKey,accessKeyContractId:n});let d={accountId:u.accountId,publicKey:u.publicKey,networkId:c,contractId:n,methodNames:r,accounts:u.accounts||[{accountId:u.accountId,publicKey:u.publicKey}],isReconnection:l};return o?.(d),d}else{console.warn("@fastnear: signIn resolved without accountId or error."),ct({accountId:null,privateKey:null,publicKey:null,accessKeyContractId:null});let d={type:"unknown",message:"Sign-in completed but no account information was returned",retryable:!0,suggestedAction:"retry",originalError:null,timestamp:Date.now()};throw s?.(d),new Error("Sign-in completed but no account information was returned")}}catch(u){let d={type:"unknown",message:u instanceof Error?u.message:"Unknown error occurred",retryable:!0,suggestedAction:"contact_support",originalError:u,timestamp:Date.now()};throw s?.(d),u}},"requestSignIn");var xe=G(async()=>{await Nt.signOut(),ct({accountId:null,privateKey:null,accessKeyContractId:null,lastWalletId:null})},"signOut"),ar=G(async({message:t,recipient:e,nonce:n,callbackUrl:r,state:o})=>{if(!_.accountId)throw new Error("Must sign in");let a=n||crypto.getRandomValues(new Uint8Array(32));try{let c=await Nt.signMessage({message:t,recipient:e,nonce:a,callbackUrl:r,state:o});return{accountId:c.accountId,publicKey:c.publicKey,signature:c.signature}}catch(c){throw console.error("fastnear: error signing message using adapter:",c),c}},"signMessage");function go(t){for(let e of t)if((e.type==="FunctionCall"||e.type==="Transfer")&&e.params.deposit&&e.params.deposit!=="0")return!0;return!1}G(go,"hasNonZeroDeposit");var lr={utils:{},borsh:ne.exp.borsh,borshSchema:ne.exp.borshSchema.getBorshSchema()};for(let t in ne)lr.utils[t]=ne[t];var ni=lr.utils,Vt={};for(let t in be)Vt[t]=be[t];var ri=Vt.events;delete Vt.events;try{if(typeof window<"u"){let t=new URL(window.location.href),e=t.searchParams.get("account_id"),n=t.searchParams.get("public_key"),r=t.searchParams.get("errorCode"),o=t.searchParams.get("errorMessage"),s=o?decodeURIComponent(o):null,a=t.searchParams.get("transactionHashes"),c=t.searchParams.get("txIds");if((r||o)&&console.warn(new Error(`Wallet raises:
code: ${r}
message: ${s}`)),e&&n&&(n===_.publicKey?ct({accountId:e}):(sr()==="SignedIn"&&console.warn("Public key mismatch from wallet redirect",n,_.publicKey),t.searchParams.delete("public_key"))),a||c){let i=a?a.split(","):[],l=c?c.split(","):[];l.length>i.length?l.forEach(f=>{xt({txId:f,status:"RejectedByUser",finalState:!0})}):l.length===i.length?l.forEach((f,u)=>{xt({txId:f,status:"PendingGotTxHash",txHash:i[u],finalState:!1}),tn(f)}):console.error(new Error("Transaction hash mismatch from wallet redirect"),l,i)}t.searchParams.delete("txIds"),sr()==="SignedOut"&&(t.searchParams.delete("errorCode"),t.searchParams.delete("errorMessage"))}}catch(t){console.error("Error handling wallet redirect:",t)}function Ee(t){return t instanceof Map?Object.fromEntries(Array.from(t,([e,n])=>[e,n instanceof Map?Ee(n):Array.isArray(n)?n.map(r=>r instanceof Map?Ee(r):r):n])):t}async function po(){return{async signIn({network:t,contractId:e,methodNames:n,successUrl:r,failureUrl:o}){if(mt({networkId:t}),window.selector.ui.showIframe(),await cr(),Ht()&&re())return[{accountId:Ht(),publicKey:re()}];throw new Error("Connection failed")},async signOut({network:t}){console.log("signOut"),mt().networkId===t&&xe()},async getAccounts({network:t}){if(console.log("getAccounts"),mt().networkId&&mt().networkId!==t)throw new Error("Network mismatch");return Ht()&&re()?[{accountId:Ht(),publicKey:re()}]:[]},async signMessage({network:t,message:e,nonce:n,recipient:r}){if(console.log("signMessage"),mt().networkId!==t)throw new Error("Network mismatch");return await ar({message:e,nonce:n,recipient:r})},async signAndSendTransaction({network:t,signerId:e,receiverId:n,actions:r}){if(console.log("signAndSendTransaction"),mt().networkId!==t)throw new Error("Network mismatch");e=e??Ht();let o=await Vt._adapter.sendTransactions({transactions:[{signerId:e,receiverId:n,actions:r}]});return Ee(o.outcomes[0])},async signAndSendTransactions({network:t,transactions:e}){if(console.log("signAndSendTransactions"),mt().networkId!==t)throw new Error("Network mismatch");return e=e.map(r=>({signerId:r.signerId??Ht(),receiverId:r.receiverId,actions:r.actions})),(await Vt._adapter.sendTransactions({transactions:e})).outcomes.map(Ee)}}}po().then(t=>{window.selector.ready(t)});
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
